<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>KLMZ MUSIC</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#1DB954">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <style>
        /* ‚úÖ ESTILOS BASE (mantener todo igual hasta los temas) */
        * { box-sizing: border-box; }
        body { margin: 0; font-family: -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif; background: #181818; color: #fff; padding-bottom: 84px; transition: all 0.3s ease;}
        header { background: #121212; padding: 1rem 1.5rem; display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 100; transition: all 0.3s ease;}
        .logo { font-weight: bold; font-size: 1.4rem; letter-spacing: 1px; transition: all 0.3s ease; }
        .user-actions { display:flex; align-items: center; gap:.5rem; }
        .lock-icon { cursor:pointer; font-size:1.4rem; color:#fff; user-select:none; transition:opacity .3s;}
        .lock-icon:hover { opacity:.7;}
        .theme-selector { margin-right: 1rem; }
        .theme-selector select { background: #333; color: #fff; border: 1px solid #555; border-radius: 4px; padding: 0.3rem 0.5rem; font-size: 0.8rem; cursor: pointer; }
        
        /* ... (mantener todos los estilos base igual) ... */
        
        /* üîß TEMAS CORREGIDOS - ASEGURAR QUE TENGAN PREFIJO CORRECTO */
        
        /* üé® NEON CYBERPUNK - CORREGIDO */
        body.theme-neon {
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #0a0a0a 100%) !important;
            color: #00ff88 !important;
        }
        body.theme-neon header {
            background: linear-gradient(135deg, #1a1a2e, #16213e) !important;
            border-bottom: 2px solid #00ff88 !important;
            box-shadow: 0 4px 20px rgba(0,255,136,0.3) !important;
        }
        body.theme-neon .logo {
            color: #00ff88 !important;
            text-shadow: 0 0 15px #00ff88, 0 0 30px #00ff88 !important;
            animation: neonPulse 2s ease-in-out infinite alternate !important;
        }
        body.theme-neon .album-img {
            border: 3px solid #ff0080 !important;
            box-shadow: 0 0 20px rgba(255,0,128,0.6) !important;
        }
        body.theme-neon .album-title { color: #00ff88 !important; }
        body.theme-neon .album-artist { color: #ff0080 !important; }
        body.theme-neon .btn-primary,
        body.theme-neon .play-btn-inline,
        body.theme-neon .full-play-btn {
            background: linear-gradient(45deg, #00ff88, #00ccff) !important;
            box-shadow: 0 0 25px rgba(0,255,136,0.5) !important;
        }
        body.theme-neon .bottom-nav {
            background: linear-gradient(180deg, rgba(26,26,46,0.95), rgba(10,10,10,0.95)) !important;
            border-top: 2px solid #00ff88 !important;
        }
        body.theme-neon .bottom-nav-item.active {
            color: #00ff88 !important;
            background: rgba(0,255,136,0.15) !important;
        }
        body.theme-neon .mode-btn.active {
            color: #00ff88 !important;
            border-color: #00ff88 !important;
            background: rgba(0,255,136,0.1) !important;
        }
        
        /* üé® ELEGANCIA MINIMAL - CORREGIDO */
        body.theme-minimal {
            background: linear-gradient(135deg, #0f0f0f 0%, #1c1c1c 50%, #0f0f0f 100%) !important;
            font-family: 'SF Pro Display', -apple-system, sans-serif !important;
            color: #f5f5f5 !important;
        }
        body.theme-minimal header {
            background: rgba(28,28,28,0.95) !important;
            backdrop-filter: blur(20px) !important;
            border-bottom: 1px solid rgba(245,245,245,0.1) !important;
        }
        body.theme-minimal .logo {
            font-weight: 200 !important;
            letter-spacing: 4px !important;
            color: #f5f5f5 !important;
        }
        body.theme-minimal .album-img {
            border-radius: 12px !important;
            border: 1px solid rgba(245,245,245,0.1) !important;
        }
        body.theme-minimal .album-title { color: #f5f5f5 !important; }
        body.theme-minimal .album-artist { color: #a0a0a0 !important; }
        body.theme-minimal .btn-primary,
        body.theme-minimal .play-btn-inline,
        body.theme-minimal .full-play-btn {
            background: #f5f5f5 !important;
            color: #0f0f0f !important;
        }
        body.theme-minimal .bottom-nav {
            background: rgba(28,28,28,0.95) !important;
            backdrop-filter: blur(20px) !important;
        }
        body.theme-minimal .bottom-nav-item.active {
            color: #f5f5f5 !important;
            background: rgba(245,245,245,0.08) !important;
        }
        body.theme-minimal .mode-btn.active {
            color: #f5f5f5 !important;
            border-color: #f5f5f5 !important;
        }
        
        /* üé® SUNSET VIBES - CORREGIDO */
        body.theme-sunset {
            background: linear-gradient(135deg, #2c1810 0%, #4a2c2a 30%, #1a1a1a 100%) !important;
            color: #ffab91 !important;
        }
        body.theme-sunset header {
            background: linear-gradient(135deg, #4a2c2a, #6d4c41) !important;
            border-bottom: 2px solid #ff8a65 !important;
        }
        body.theme-sunset .logo { color: #ff8a65 !important; }
        body.theme-sunset .album-img {
            border: 3px solid #ff8a65 !important;
            box-shadow: 0 8px 25px rgba(255,138,101,0.4) !important;
        }
        body.theme-sunset .album-title { color: #ffab91 !important; }
        body.theme-sunset .album-artist { color: #ff8a65 !important; }
        body.theme-sunset .btn-primary,
        body.theme-sunset .play-btn-inline,
        body.theme-sunset .full-play-btn {
            background: linear-gradient(45deg, #ff8a65, #ff6f00) !important;
        }
        body.theme-sunset .bottom-nav {
            background: linear-gradient(180deg, rgba(76,44,42,0.95), rgba(26,26,26,0.95)) !important;
            border-top: 2px solid #ff8a65 !important;
        }
        body.theme-sunset .bottom-nav-item.active {
            color: #ff8a65 !important;
            background: rgba(255,138,101,0.15) !important;
        }
        body.theme-sunset .mode-btn.active {
            color: #ff8a65 !important;
            border-color: #ff8a65 !important;
        }
        
        /* üé® PASTEL DREAMS - CORREGIDO */
        body.theme-pastel {
            background: linear-gradient(135deg, #1a1625 0%, #2d2438 50%, #3d2f47 100%) !important;
            color: #d4c5f9 !important;
        }
        body.theme-pastel header {
            background: rgba(139,130,176,0.15) !important;
            backdrop-filter: blur(20px) !important;
            border-bottom: 2px solid rgba(184,169,232,0.4) !important;
        }
        body.theme-pastel .logo { color: #b8a9e8 !important; }
        body.theme-pastel .album-img {
            border-radius: 20px !important;
            border: 2px solid rgba(184,169,232,0.5) !important;
            box-shadow: 0 12px 40px rgba(184,169,232,0.3) !important;
        }
        body.theme-pastel .album-title { color: #d4c5f9 !important; }
        body.theme-pastel .album-artist { color: #b8a9e8 !important; }
        body.theme-pastel .btn-primary,
        body.theme-pastel .play-btn-inline,
        body.theme-pastel .full-play-btn {
            background: linear-gradient(45deg, #b8a9e8, #d4c5f9) !important;
            color: #1a1625 !important;
        }
        body.theme-pastel .bottom-nav {
            background: rgba(45,36,56,0.9) !important;
            backdrop-filter: blur(25px) !important;
            border-top: 2px solid rgba(184,169,232,0.4) !important;
        }
        body.theme-pastel .bottom-nav-item.active {
            color: #d4c5f9 !important;
            background: rgba(184,169,232,0.15) !important;
        }
        body.theme-pastel .mode-btn.active {
            color: #b8a9e8 !important;
            border-color: #b8a9e8 !important;
        }
        
        /* üé® LUXURY JEWELS - CORREGIDO */
        body.theme-luxury {
            background: linear-gradient(135deg, #0f1419 0%, #1a252f 50%, #2c3e50 100%) !important;
            color: #f0f8ff !important;
        }
        body.theme-luxury header {
            background: linear-gradient(135deg, #1e3a5f, #34495e) !important;
            border-bottom: 3px solid #d4af37 !important;
        }
        body.theme-luxury .logo {
            color: #d4af37 !important;
            font-weight: 700 !important;
            text-shadow: 0 3px 10px rgba(212,175,55,0.5) !important;
        }
        body.theme-luxury .album-img {
            border: 3px solid #d4af37 !important;
            box-shadow: 0 10px 30px rgba(212,175,55,0.4) !important;
        }
        body.theme-luxury .album-title { color: #f0f8ff !important; }
        body.theme-luxury .album-artist { color: #4a9eff !important; }
        body.theme-luxury .btn-primary,
        body.theme-luxury .play-btn-inline,
        body.theme-luxury .full-play-btn {
            background: linear-gradient(45deg, #d4af37, #b8860b) !important;
            color: #0f1419 !important;
        }
        body.theme-luxury .bottom-nav {
            background: linear-gradient(180deg, rgba(30,58,95,0.95), rgba(15,20,25,0.95)) !important;
            border-top: 3px solid #d4af37 !important;
        }
        body.theme-luxury .bottom-nav-item.active {
            color: #d4af37 !important;
            background: rgba(212,175,55,0.15) !important;
        }
        body.theme-luxury .mode-btn.active {
            color: #d4af37 !important;
            border-color: #d4af37 !important;
        }
        
        /* üé® ANIMACIONES */
        @keyframes neonPulse {
            0% { text-shadow: 0 0 15px #00ff88, 0 0 30px #00ff88; }
            100% { text-shadow: 0 0 20px #00ff88, 0 0 40px #00ff88, 0 0 60px #00ff88; }
        }
        
        /* ... resto de estilos base ... */
        
        @media (min-width:900px) { aside { display:block;} main{margin-left:220px; max-width:none;}}
        @media (max-width: 768px) {
            .full-player-cover { width: 150px; height: 150px; }
            .full-player-title { font-size: 1.4rem; }
            .full-control-buttons { gap: 2rem; }
        }
    </style>
</head>
<body>
<!-- ... HTML anterior igual ... -->

<script>
// üîß VARIABLES GLOBALES
let supabase = null;
let currentSong = null;
let currentAlbum = null;
let currentPlaylist = [];
let currentIndex = 0;
let isPlaying = false;
let allAlbums = [];
let allSongs = [];
let currentUser = null;
let songsWithAlbumInfo = [];
let repeatMode = 'off';
let shuffleMode = false;
let originalPlaylist = [];
let keyboardHintTimeout = null;

const supabaseUrl = 'https://nqbldvpnqhngdtalvzov.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5xYmxkdnBucWhuZ2R0YWx2em92Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUyMjY0NjUsImV4cCI6MjA3MDgwMjQ2NX0.Zzg5D219sW7bhvl0_R5ypX9MF6nRzBSDIeo2Lvebab0';
const ADMIN_EMAIL = 'klmzr@gmail.com';

// üé® FUNCI√ìN DE TEMAS CORREGIDA
window.changeTheme = function(theme) {
    console.log('üé® Cambiando tema a:', theme);
    
    // Remover todas las clases de tema existentes
    document.body.className = document.body.className
        .split(' ')
        .filter(className => !className.startsWith('theme-'))
        .join(' ');
    
    // Aplicar nuevo tema si no es default
    if (theme && theme !== 'default') {
        document.body.classList.add(`theme-${theme}`);
        console.log('‚úÖ Tema aplicado:', `theme-${theme}`);
    }
    
    // Guardar tema
    localStorage.setItem('klmz_theme', theme);
    
    // Verificar que se aplic√≥ correctamente
    setTimeout(() => {
        const appliedTheme = document.body.className.includes(`theme-${theme}`);
        console.log('üîç Verificaci√≥n tema:', appliedTheme ? 'APLICADO' : 'NO APLICADO');
    }, 100);
}

function loadSavedTheme() {
    const savedTheme = localStorage.getItem('klmz_theme') || 'default';
    console.log('üìÇ Cargando tema guardado:', savedTheme);
    
    // Aplicar tema
    changeTheme(savedTheme);
    
    // Actualizar selector
    const themeSelector = document.querySelector('.theme-selector select');
    if (themeSelector) {
        themeSelector.value = savedTheme;
        console.log('‚úÖ Selector actualizado');
    }
}

// üîê SISTEMA DE AUTENTICACI√ìN CORREGIDO
window.login = async function(event) {
    event.preventDefault();
    
    const email = document.getElementById('login-email').value;
    const password = document.getElementById('login-password').value;
    
    if (!email || !password) {
        alert('Por favor, completa todos los campos');
        return;
    }
    
    try {
        console.log('üîê Intentando login...');
        const { data, error } = await supabase.auth.signInWithPassword({
            email: email,
            password: password,
        });
        
        if (error) {
            console.error('‚ùå Error login:', error);
            alert(`Error de login: ${error.message}`);
            return;
        }
        
        console.log('‚úÖ Login exitoso:', data.user.email);
        alert(`¬°Bienvenido${data.user.email === ADMIN_EMAIL ? ' Admin' : ''}!`);
        closeAuth();
        
    } catch (error) {
        console.error('‚ùå Error inesperado:', error);
        alert('Error de conexi√≥n. Verifica tu internet.');
    }
}

window.register = async function(event) {
    event.preventDefault();
    
    const email = document.getElementById('register-email').value;
    const password = document.getElementById('register-password').value;
    const confirm = document.getElementById('register-confirm').value;
    
    if (!email || !password || !confirm) {
        alert('Por favor, completa todos los campos');
        return;
    }
    
    if (password !== confirm) {
        alert('Las contrase√±as no coinciden');
        return;
    }
    
    if (password.length < 6) {
        alert('La contrase√±a debe tener al menos 6 caracteres');
        return;
    }
    
    try {
        console.log('üìù Intentando registro...');
        const { data, error } = await supabase.auth.signUp({
            email: email,
            password: password,
        });
        
        if (error) {
            console.error('‚ùå Error registro:', error);
            alert(`Error de registro: ${error.message}`);
            return;
        }
        
        console.log('‚úÖ Registro exitoso');
        alert('Registro exitoso. Revisa tu correo para confirmar tu cuenta.');
        closeAuth();
        
    } catch (error) {
        console.error('‚ùå Error inesperado:', error);
        alert('Error de conexi√≥n. Verifica tu internet.');
    }
}

async function logout() {
    try {
        console.log('üö™ Cerrando sesi√≥n...');
        const { error } = await supabase.auth.signOut();
        
        if (error) {
            console.error('‚ùå Error logout:', error);
            alert('Error cerrando sesi√≥n');
            return;
        }
        
        console.log('‚úÖ Sesi√≥n cerrada');
        alert('Sesi√≥n cerrada correctamente');
        showSection('home');
        
    } catch (error) {
        console.error('‚ùå Error inesperado logout:', error);
        alert('Error de conexi√≥n');
    }
}

function updateAuthUI() {
    const navLogin = document.getElementById('nav-login');
    
    if (!navLogin) return;
    
    if (currentUser) {
        if (isAdmin()) {
            // Usuario administrador
            navLogin.innerHTML = '<span class="icon">‚öô</span><small>Admin</small>';
            navLogin.onclick = () => showSection('admin');
            console.log('üîß UI Admin configurada');
        } else {
            // Usuario normal
            navLogin.innerHTML = '<span class="icon">üë§</span><small>Logout</small>';
            navLogin.onclick = logout;
            console.log('üë§ UI Usuario configurada');
        }
    } else {
        // Sin usuario
        navLogin.innerHTML = '<span class="icon">üîí</span><small>Acceso</small>';
        navLogin.onclick = () => showAuth('login');
        console.log('üîí UI Login configurada');
    }
}

function isAdmin() {
    return currentUser && currentUser.email === ADMIN_EMAIL;
}

// üîß AUTH MODALS
window.showAuth = function(type) {
    const modal = document.getElementById('auth-modal');
    const loginForm = document.getElementById('login-form');
    const registerForm = document.getElementById('register-form');
    
    modal.style.display = 'flex';
    
    if (type === 'register') {
        loginForm.style.display = 'none';
        registerForm.style.display = 'block';
    } else {
        loginForm.style.display = 'block';
        registerForm.style.display = 'none';
    }
}

window.closeAuth = function() {
    document.getElementById('auth-modal').style.display = 'none';
}

// üîß SUPABASE INICIALIZACI√ìN CORREGIDA
async function loadSupabase() {
    showLoadingIndicator(true);
    try {
        console.log('üåê Cargando Supabase...');
        const module = await import('https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm');
        const { createClient } = module;
        supabase = createClient(supabaseUrl, supabaseKey);
        
        // üîß LISTENER DE ESTADO DE AUTH CORREGIDO
        supabase.auth.onAuthStateChange((event, session) => {
            console.log('üîÑ Auth state change:', event, session?.user?.email);
            
            if (session?.user) {
                currentUser = session.user;
                console.log('‚úÖ Usuario autenticado:', currentUser.email);
            } else {
                currentUser = null;
                console.log('‚ùå Usuario no autenticado');
            }
            
            updateAuthUI();
        });
        
        // Verificar sesi√≥n actual
        const { data: { session } } = await supabase.auth.getSession();
        if (session?.user) {
            currentUser = session.user;
            console.log('üîç Sesi√≥n existente encontrada:', currentUser.email);
            updateAuthUI();
        }
        
        console.log('‚úÖ Supabase cargado correctamente');
        showLoadingIndicator(false);
        await loadAllData();
        
    } catch (error) {
        console.error('‚ùå Error cargando Supabase:', error);
        showLoadingIndicator(false);
        showErrorMessage('Error de conexi√≥n. Verifica tu internet.');
    }
}

// üîß RESTO DE FUNCIONES (mantener todas las anteriores igual)
// ... (todas las funciones de reproducci√≥n, favoritos, etc. mantener igual) ...

// üîß CONTROLES DE TECLADO (mantener igual)
function setupKeyboardControls() {
    document.addEventListener('keydown', function(e) {
        if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
            return;
        }
        
        const audio = document.getElementById('audio-player');
        
        switch(e.code) {
            case 'Space':
                e.preventDefault();
                togglePlay();
                showKeyboardHint('Play/Pause');
                break;
            case 'ArrowRight':
                e.preventDefault();
                nextSong();
                showKeyboardHint('Siguiente canci√≥n');
                break;
            case 'ArrowLeft':
                e.preventDefault();
                previousSong();
                showKeyboardHint('Anterior canci√≥n');
                break;
            case 'ArrowUp':
                e.preventDefault();
                const currentVol = Math.round(audio.volume * 100);
                const newVol = Math.min(100, currentVol + 10);
                setVolume(newVol);
                updateVolumeSlider(newVol);
                showKeyboardHint(`Volumen: ${newVol}%`);
                break;
            case 'ArrowDown':
                e.preventDefault();
                const currentVolDown = Math.round(audio.volume * 100);
                const newVolDown = Math.max(0, currentVolDown - 10);
                setVolume(newVolDown);
                updateVolumeSlider(newVolDown);
                showKeyboardHint(`Volumen: ${newVolDown}%`);
                break;
            case 'KeyR':
                if (e.ctrlKey || e.metaKey) return;
                e.preventDefault();
                toggleRepeatMode();
                break;
            case 'KeyS':
                if (e.ctrlKey || e.metaKey) return;
                e.preventDefault();
                toggleShuffleMode();
                break;
            case 'Digit1':
                e.preventDefault();
                toggleRepeatOneMode();
                break;
            case 'KeyM':
                e.preventDefault();
                const isMuted = audio.muted;
                audio.muted = !isMuted;
                showKeyboardHint(isMuted ? 'Audio activado' : 'Audio silenciado');
                break;
        }
    });
}

function showKeyboardHint(message) {
    const hint = document.getElementById('keyboard-hint');
    if (!hint) return;
    
    hint.textContent = message;
    hint.classList.add('show');
    
    if (keyboardHintTimeout) {
        clearTimeout(keyboardHintTimeout);
    }
    
    keyboardHintTimeout = setTimeout(() => {
        hint.classList.remove('show');
    }, 1500);
}

// üîß MODOS DE REPRODUCCI√ìN (mantener igual)
window.toggleRepeatMode = function() {
    const repeatBtn = document.getElementById('repeat-btn');
    const repeatOneBtn = document.getElementById('repeat-one-btn');
    
    if (repeatMode === 'off') {
        repeatMode = 'all';
        repeatBtn.classList.add('active');
        repeatOneBtn.classList.remove('active');
        showKeyboardHint('Repetir √°lbum activado');
    } else {
        repeatMode = 'off';
        repeatBtn.classList.remove('active');
        showKeyboardHint('Repetir desactivado');
    }
    
    savePlaybackSettings();
}

window.toggleRepeatOneMode = function() {
    const repeatBtn = document.getElementById('repeat-btn');
    const repeatOneBtn = document.getElementById('repeat-one-btn');
    
    if (repeatMode === 'one') {
        repeatMode = 'off';
        repeatOneBtn.classList.remove('active');
        showKeyboardHint('Repetir canci√≥n desactivado');
    } else {
        repeatMode = 'one';
        repeatBtn.classList.remove('active');
        repeatOneBtn.classList.add('active');
        showKeyboardHint('Repetir canci√≥n activado');
    }
    
    savePlaybackSettings();
}

window.toggleShuffleMode = function() {
    const shuffleBtn = document.getElementById('shuffle-btn');
    
    shuffleMode = !shuffleMode;
    
    if (shuffleMode) {
        shuffleBtn.classList.add('active');
        originalPlaylist = [...currentPlaylist];
        shufflePlaylist();
        showKeyboardHint('Modo aleatorio activado');
    } else {
        shuffleBtn.classList.remove('active');
        if (originalPlaylist.length > 0) {
            currentPlaylist = [...originalPlaylist];
            currentIndex = currentPlaylist.findIndex(song => song.id === currentSong.id);
        }
        showKeyboardHint('Modo aleatorio desactivado');
    }
    
    savePlaybackSettings();
}

function shufflePlaylist() {
    if (currentPlaylist.length <= 1) return;
    
    const otherSongs = currentPlaylist.filter((song, index) => index !== currentIndex);
    
    for (let i = otherSongs.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [otherSongs[i], otherSongs[j]] = [otherSongs[j], otherSongs[i]];
    }
    
    currentPlaylist = [currentSong, ...otherSongs];
    currentIndex = 0;
}

function savePlaybackSettings() {
    const settings = {
        repeatMode: repeatMode,
        shuffleMode: shuffleMode
    };
    localStorage.setItem('klmz_playback_settings', JSON.stringify(settings));
}

function loadPlaybackSettings() {
    try {
        const settings = JSON.parse(localStorage.getItem('klmz_playback_settings') || '{}');
        
        if (settings.repeatMode) {
            repeatMode = settings.repeatMode;
        }
        if (settings.shuffleMode !== undefined) {
            shuffleMode = settings.shuffleMode;
        }
        
        updateModeButtons();
    } catch (error) {
        console.error('Error loading playback settings:', error);
    }
}

function updateModeButtons() {
    const repeatBtn = document.getElementById('repeat-btn');
    const repeatOneBtn = document.getElementById('repeat-one-btn');
    const shuffleBtn = document.getElementById('shuffle-btn');
    
    if (repeatBtn) {
        repeatBtn.classList.toggle('active', repeatMode === 'all');
    }
    if (repeatOneBtn) {
        repeatOneBtn.classList.toggle('active', repeatMode === 'one');
    }
    if (shuffleBtn) {
        shuffleBtn.classList.toggle('active', shuffleMode);
    }
}

// ... (MANTENER TODAS LAS DEM√ÅS FUNCIONES IGUAL: playSong, favoritos, b√∫squeda, etc.) ...

// üîß INICIALIZACI√ìN PRINCIPAL
document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ Iniciando KLMZ Music...');
    
    const audio = document.getElementById('audio-player');
    
    // Audio events
    audio.addEventListener('ended', () => handleSongEnded());
    audio.addEventListener('timeupdate', () => updateProgressBar());
    audio.addEventListener('play', () => { isPlaying = true; updatePlayButtons(); });
    audio.addEventListener('pause', () => { isPlaying = false; updatePlayButtons(); });
    audio.addEventListener('loadstart', () => console.log('üéµ Cargando audio...'));
    audio.addEventListener('canplay', () => console.log('üéµ Audio listo'));
    audio.addEventListener('error', (e) => {
        console.error('‚ùå Error audio:', e);
        alert('‚ùå Error cargando audio. Verifica la conexi√≥n.');
    });
    
    // Mini player click
    const miniPlayer = document.getElementById('mini-player');
    if (miniPlayer) {
        miniPlayer.addEventListener('click', function(e) {
            if (!e.target.closest('.player-controls-inline')) {
                openFullPlayer();
            }
        });
    }
    
    // üîß INICIALIZAR FUNCIONALIDADES
    setupKeyboardControls();
    loadPlaybackSettings();
    loadSavedTheme(); // ‚úÖ CARGAR TEMA GUARDADO
    loadSupabase(); // ‚úÖ CARGAR SUPABASE CON AUTH
    
    console.log('‚úÖ KLMZ Music iniciado correctamente');
});

// ... (resto de funciones mantener igual) ...
</script>
</body>
</html>
