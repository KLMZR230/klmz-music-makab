<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>KLMZ MUSIC</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#1DB954">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/appwrite@13.0.0"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { 
            box-sizing: border-box; 
            margin: 0; 
            padding: 0; 
        }
        
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; 
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%); 
            color: #ffffff; 
            min-height: 100vh;
            padding-bottom: 100px;
            overflow-x: hidden;
        }

        /* ===== HEADER MODERNO ===== */
        header { 
            background: rgba(15, 15, 35, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1.2rem 2rem; 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            position: sticky; 
            top: 0; 
            z-index: 100;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .logo { 
            font-weight: 800; 
            font-size: 1.6rem; 
            background: linear-gradient(135deg, #1DB954, #00ff88);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
        }
        
        .user-actions { 
            display: flex; 
            align-items: center; 
            gap: 1rem; 
        }
        
        .theme-selector select { 
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            color: #fff; 
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px; 
            padding: 0.5rem 1rem; 
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .theme-selector select:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: #1DB954;
        }
        
        .lock-icon { 
            cursor: pointer; 
            font-size: 1.5rem; 
            padding: 0.8rem;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .lock-icon:hover {
            background: rgba(29, 185, 84, 0.2);
            border-color: #1DB954;
            transform: scale(1.05);
        }
        
        /* ===== MAIN CONTAINER ===== */
        main { 
            padding: 2rem; 
            max-width: 1200px; 
            margin: 0 auto;
        }
        
        .section-title { 
            font-size: 2.5rem; 
            font-weight: 700; 
            margin-bottom: 2rem;
            background: linear-gradient(135deg, #ffffff, #b3b3b3);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -1px;
        }
        
        /* ===== GRID DE √ÅLBUMES MODERNO ===== */
        .album-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); 
            gap: 2rem;
            margin-bottom: 3rem;
        }
        
        .album-card { 
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px; 
            padding: 1.5rem; 
            cursor: pointer; 
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }
        
        .album-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(29, 185, 84, 0.1), rgba(0, 255, 136, 0.05));
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1;
        }
        
        .album-card:hover::before {
            opacity: 1;
        }
        
        .album-card:hover { 
            transform: translateY(-8px) scale(1.02);
            border-color: rgba(29, 185, 84, 0.3);
            box-shadow: 0 20px 60px rgba(29, 185, 84, 0.2);
        }
        
        .album-img { 
            width: 100%; 
            aspect-ratio: 1;
            border-radius: 16px; 
            object-fit: cover; 
            margin-bottom: 1rem; 
            background: linear-gradient(135deg, #333, #555);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 2;
        }
        
        .album-title { 
            font-size: 1.1rem; 
            font-weight: 600; 
            margin-bottom: 0.5rem;
            color: #ffffff;
            position: relative;
            z-index: 2;
        }
        
        .album-artist { 
            font-size: 0.9rem; 
            color: rgba(255, 255, 255, 0.7);
            position: relative;
            z-index: 2;
        }
        
        /* ===== LISTA DE CANCIONES MODERNA ===== */
        .song-list ul { 
            list-style: none; 
            padding: 0; 
            margin: 0;
        }
        
        .song-list li { 
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 1rem 1.5rem; 
            margin-bottom: 0.8rem;
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .song-list li::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 0;
            background: linear-gradient(90deg, rgba(29, 185, 84, 0.2), transparent);
            transition: width 0.3s ease;
        }
        
        .song-list li:hover::before {
            width: 100%;
        }
        
        .song-list li:hover { 
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(29, 185, 84, 0.3);
            transform: translateX(8px);
        }
        
        .song-title {
            font-weight: 600;
            font-size: 1rem;
            color: #ffffff;
        }
        
        .song-actions { 
            display: flex; 
            gap: 1rem; 
            align-items: center; 
        }
        
        .action-btn { 
            cursor: pointer; 
            font-size: 1.3rem; 
            padding: 0.6rem;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 44px;
            height: 44px;
        }
        
        .action-btn:hover { 
            transform: scale(1.1);
            background: rgba(255, 255, 255, 0.15);
        }
        
        .favorite-btn { color: #666; }
        .favorite-btn.active { 
            color: #ff4757; 
            background: rgba(255, 71, 87, 0.2);
            border-color: #ff4757;
        }
        
        .download-btn { color: #666; }
        .download-btn.downloaded { 
            color: #1DB954; 
            background: rgba(29, 185, 84, 0.2);
            border-color: #1DB954;
        }
        
        .play-btn { 
            color: #1DB954; 
            background: rgba(29, 185, 84, 0.2);
            border-color: #1DB954;
        }
        
        /* ===== REPRODUCTOR MINI MODERNO ===== */
        .player { 
            position: fixed; 
            bottom: 90px; 
            left: 20px; 
            right: 20px; 
            background: rgba(15, 15, 35, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            z-index: 300; 
            display: none; 
            align-items: center; 
            padding: 1rem 1.5rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease;
        }
        
        .player:hover {
            transform: translateY(-2px);
            box-shadow: 0 25px 80px rgba(29, 185, 84, 0.15);
        }
        
        .player-img-mini { 
            width: 50px; 
            height: 50px; 
            border-radius: 12px; 
            object-fit: cover; 
            margin-right: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .player-info-mini { 
            flex: 1; 
            overflow: hidden;
        }
        
        .player-title-mini { 
            font-weight: 600; 
            font-size: 1rem;
            color: #ffffff;
            margin-bottom: 0.2rem;
        }
        
        .player-artist-mini { 
            color: rgba(255, 255, 255, 0.7); 
            font-size: 0.85rem;
        }
        
        .player-controls-inline { 
            display: flex; 
            align-items: center; 
            gap: 1rem;
        }
        
        .play-btn-inline { 
            background: linear-gradient(135deg, #1DB954, #00ff88);
            color: #000; 
            border: none; 
            border-radius: 50%; 
            width: 44px; 
            height: 44px; 
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(29, 185, 84, 0.4);
        }
        
        .play-btn-inline:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(29, 185, 84, 0.6);
        }
        
        /* ===== NAVEGACI√ìN INFERIOR MODERNA ===== */
        .bottom-nav { 
            position: fixed; 
            left: 20px; 
            right: 20px; 
            bottom: 20px; 
            background: rgba(15, 15, 35, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            display: flex; 
            height: 70px; 
            z-index: 5000;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            overflow: hidden;
        }
        
        .bottom-nav-item { 
            color: rgba(255, 255, 255, 0.6); 
            text-align: center; 
            flex: 1; 
            padding: 0.8rem 0; 
            cursor: pointer; 
            display: flex; 
            flex-direction: column; 
            align-items: center;
            gap: 0.3rem;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .bottom-nav-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(29, 185, 84, 0.1), rgba(0, 255, 136, 0.05));
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .bottom-nav-item.active::before {
            opacity: 1;
        }
        
        .bottom-nav-item.active { 
            color: #1DB954;
        }
        
        .bottom-nav-item:hover {
            color: #ffffff;
        }
        
        .bottom-nav-item .icon { 
            font-size: 1.4rem; 
        }
        
        .bottom-nav-item small { 
            font-size: 0.7rem;
            font-weight: 500;
        }
        
        /* ===== SECCIONES DE CONTENIDO ===== */
        .content-section { 
            display: none; 
        }
        
        .content-section.active { 
            display: block; 
        }
        
        /* ===== BOT√ìN DE VOLVER ===== */
        .back-btn { 
            margin-bottom: 2rem; 
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            color: #fff; 
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 0.8rem 1.5rem; 
            border-radius: 50px; 
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .back-btn:hover { 
            background: rgba(29, 185, 84, 0.2);
            border-color: #1DB954;
            transform: translateX(-4px);
        }
        
        /* ===== MODAL MODERNO ===== */
        .modal { 
            position: fixed; 
            top: 0; 
            left: 0; 
            right: 0; 
            bottom: 0; 
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: none; 
            align-items: center; 
            justify-content: center; 
            z-index: 2000;
        }
        
        .modal-content { 
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 2.5rem; 
            border-radius: 24px; 
            width: 95%; 
            max-width: 400px; 
            position: relative;
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.5);
        }
        
        .form-group { 
            margin-bottom: 1.5rem;
        }
        
        .form-group input { 
            width: 100%; 
            padding: 1rem 1.2rem; 
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px; 
            color: #fff;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #1DB954;
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 0 3px rgba(29, 185, 84, 0.1);
        }
        
        .form-group input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .btn-primary { 
            background: linear-gradient(135deg, #1DB954, #00ff88);
            color: #000; 
            border: none; 
            padding: 1rem 2rem; 
            border-radius: 50px; 
            cursor: pointer; 
            width: 100%; 
            margin-top: 1rem;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(29, 185, 84, 0.4);
        }
        
        .btn-primary:hover { 
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(29, 185, 84, 0.6);
        }
        
        .close-modal { 
            position: absolute; 
            top: 1rem; 
            right: 1rem; 
            background: rgba(255, 255, 255, 0.1);
            border: none; 
            color: #fff; 
            font-size: 1.5rem; 
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .close-modal:hover {
            background: rgba(255, 71, 87, 0.2);
            color: #ff4757;
        }
        
        /* ===== DROPDOWN MODERNO ===== */
        .user-dropdown { 
            display: none; 
            position: absolute; 
            right: 0; 
            top: calc(100% + 10px); 
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(20px);
            min-width: 220px; 
            border-radius: 16px; 
            z-index: 1000;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        }
        
        .user-dropdown.show { 
            display: block; 
            animation: dropdownSlideIn 0.3s ease;
        }
        
        .user-dropdown-item { 
            padding: 1rem 1.5rem; 
            cursor: pointer; 
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            font-weight: 500;
        }
        
        .user-dropdown-item:last-child {
            border-bottom: none;
        }
        
        .user-dropdown-item:hover { 
            background: rgba(255, 255, 255, 0.05);
        }
        
        /* ===== LOADING MODERNO ===== */
        .loading-indicator { 
            position: fixed; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(20px);
            color: #fff; 
            padding: 2rem 3rem; 
            border-radius: 20px; 
            z-index: 2000; 
            display: none;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.5);
        }
        
        /* ===== FAVORITOS MODERNOS ===== */
        .favorite-item { 
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            padding: 1.5rem; 
            margin-bottom: 1rem; 
            border-radius: 16px; 
            cursor: pointer; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            border-left: 4px solid #ff4757;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .favorite-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 0;
            background: linear-gradient(90deg, rgba(255, 71, 87, 0.1), transparent);
            transition: width 0.3s ease;
        }
        
        .favorite-item:hover::before {
            width: 100%;
        }
        
        .favorite-item:hover { 
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 71, 87, 0.3);
            transform: translateX(8px);
        }
        
        .favorite-info { 
            flex: 1; 
        }
        
        .favorite-title { 
            font-weight: 600; 
            margin-bottom: 0.4rem; 
            color: #fff;
            font-size: 1.1rem;
        }
        
        .favorite-artist { 
            font-size: 0.9rem; 
            color: rgba(255, 255, 255, 0.7);
        }
        
        .favorite-album { 
            font-size: 0.8rem; 
            color: rgba(255, 255, 255, 0.5); 
            margin-top: 0.2rem; 
        }
        
        /* ===== SEARCH INPUT MODERNO ===== */
        .search-input {
            width: 100%; 
            padding: 1.2rem 1.5rem; 
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px; 
            color: #fff; 
            margin-bottom: 2rem;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #1DB954;
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 0 3px rgba(29, 185, 84, 0.1);
        }
        
        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        /* ===== COPYRIGHT MODERNO ===== */
        .copyright { 
            position: fixed; 
            bottom: 0; 
            left: 0; 
            width: 100%; 
            height: 20px; 
            background: rgba(0, 0, 0, 0.8);
            color: rgba(255, 255, 255, 0.4); 
            font-size: 0.7rem; 
            text-align: center; 
            padding: 2px 0; 
            z-index: 10000;
        }
        
        /* ===== TEMAS CORREGIDOS ===== */
        /* üé® TEMA NEON */
        body.theme-neon { 
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 30%, #16213e 60%, #0f0f23 100%) !important;
        }
        
        body.theme-neon .logo { 
            background: linear-gradient(135deg, #00ff88, #00cc6a) !important;
            -webkit-background-clip: text !important;
            -webkit-text-fill-color: transparent !important;
            background-clip: text !important;
        }
        
        body.theme-neon .btn-primary {
            background: linear-gradient(135deg, #00ff88, #00cc6a) !important;
        }
        
        body.theme-neon .play-btn-inline {
            background: linear-gradient(135deg, #00ff88, #00cc6a) !important;
        }
        
        body.theme-neon .bottom-nav-item.active { 
            color: #00ff88 !important;
        }
        
        body.theme-neon .album-card:hover {
            border-color: rgba(0, 255, 136, 0.3) !important;
            box-shadow: 0 20px 60px rgba(0, 255, 136, 0.2) !important;
        }
        
        body.theme-neon .action-btn.play-btn {
            background: rgba(0, 255, 136, 0.2) !important;
            border-color: #00ff88 !important;
        }
        
        /* üé® TEMA SUNSET */
        body.theme-sunset { 
            background: linear-gradient(135deg, #2c1810 0%, #4a2c2a 25%, #6d4c41 50%, #8d5524 75%) !important;
        }
        
        body.theme-sunset .logo { 
            background: linear-gradient(135deg, #ff7043, #ff5722) !important;
            -webkit-background-clip: text !important;
            -webkit-text-fill-color: transparent !important;
            background-clip: text !important;
        }
        
        body.theme-sunset .btn-primary {
            background: linear-gradient(135deg, #ff7043, #ff5722) !important;
        }
        
        body.theme-sunset .play-btn-inline {
            background: linear-gradient(135deg, #ff7043, #ff5722) !important;
        }
        
        body.theme-sunset .bottom-nav-item.active { 
            color: #ff7043 !important;
        }
        
        body.theme-sunset .album-card:hover {
            border-color: rgba(255, 112, 67, 0.3) !important;
            box-shadow: 0 20px 60px rgba(255, 112, 67, 0.2) !important;
        }
        
        body.theme-sunset .action-btn.play-btn {
            background: rgba(255, 112, 67, 0.2) !important;
            border-color: #ff7043 !important;
        }
        
        /* üé® TEMA OCEANIC */
        body.theme-oceanic { 
            background: linear-gradient(135deg, #0a192f 0%, #173a5e 30%, #3b6978 60%, #84a9ac 100%) !important;
        }
        
        body.theme-oceanic .logo { 
            background: linear-gradient(135deg, #17a2b8, #138496) !important;
            -webkit-background-clip: text !important;
            -webkit-text-fill-color: transparent !important;
            background-clip: text !important;
        }
        
        body.theme-oceanic .btn-primary {
            background: linear-gradient(135deg, #17a2b8, #138496) !important;
        }
        
        body.theme-oceanic .play-btn-inline {
            background: linear-gradient(135deg, #17a2b8, #138496) !important;
        }
        
        body.theme-oceanic .bottom-nav-item.active { 
            color: #17a2b8 !important;
        }
        
        body.theme-oceanic .album-card:hover {
            border-color: rgba(23, 162, 184, 0.3) !important;
            box-shadow: 0 20px 60px rgba(23, 162, 184, 0.2) !important;
        }
        
        body.theme-oceanic .action-btn.play-btn {
            background: rgba(23, 162, 184, 0.2) !important;
            border-color: #17a2b8 !important;
        }
        
        /* ===== ANIMACIONES ===== */
        @keyframes dropdownSlideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes heartBeat {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            main { 
                padding: 1rem; 
            }
            
            .album-grid { 
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); 
                gap: 1rem;
            }
            
            .section-title { 
                font-size: 2rem; 
            }
            
            header { 
                padding: 1rem; 
            }
            
            .player {
                left: 10px;
                right: 10px;
            }
            
            .bottom-nav {
                left: 10px;
                right: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="loading-indicator" id="loading">
        <div style="display: flex; align-items: center; gap: 1rem;">
            <div style="width: 20px; height: 20px; border: 2px solid #1DB954; border-top: 2px solid transparent; border-radius: 50%; animation: spin 1s linear infinite;"></div>
            üéµ Cargando m√∫sica...
        </div>
    </div>
    
    <header>
        <span class="logo">KLMZ MUSIC</span>
        <div class="user-actions">
            <div class="theme-selector">
                <select id="theme-select" onchange="changeTheme(this.value)">
                    <option value="default">üéµ Default</option>
                    <option value="neon">‚ö° Neon Cyberpunk</option>
                    <option value="sunset">üåÖ Sunset Vibes</option>
                    <option value="oceanic">üåä Oceanic Serenity</option>
                </select>
            </div>
            <div class="user-menu">
                <div class="lock-icon" id="header-lock-icon" onclick="toggleUserMenu()">üîí</div>
                <div class="user-dropdown" id="userDropdown">
                    <div class="user-dropdown-item" onclick="showAuth('login')">
                        <span>üîê</span> Iniciar Sesi√≥n
                    </div>
                    <div class="user-dropdown-item" onclick="showAuth('register')">
                        <span>üìù</span> Registrarse
                    </div>
                    <div class="user-dropdown-item" id="adminBtn" onclick="showSection('admin')" style="display:none;">
                        <span>‚öôÔ∏è</span> Panel Admin
                    </div>
                    <div class="user-dropdown-item" id="logoutBtn" onclick="logout()" style="display:none;">
                        <span>üö™</span> Cerrar Sesi√≥n
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main>
        <section class="content-section active" id="home-section">
            <div class="section-title">Descubre M√∫sica</div>
            <div class="album-grid" id="albums">
                <div style="text-align: center; padding: 4rem; color: rgba(255,255,255,0.6);">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">üéµ</div>
                    <h3>Cargando tu biblioteca musical...</h3>
                </div>
            </div>
            <div id="album-detail" style="display:none;"></div>
        </section>

        <section class="content-section" id="search-section">
            <div class="section-title">Explorar</div>
            <input type="text" placeholder="Busca canciones, artistas o √°lbumes..." id="search-input" class="search-input" onkeyup="searchMusic()">
            <div id="search-results"></div>
        </section>

        <section class="content-section" id="favorites-section">
            <div class="section-title">‚ù§Ô∏è Favoritos</div>
            <div id="favorites-content">
                <div style="text-align: center; padding: 4rem; color: rgba(255,255,255,0.6);">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">üíñ</div>
                    <h3>Cargando tus favoritos...</h3>
                </div>
            </div>
        </section>

        <section class="content-section" id="downloads-section">
            <div class="section-title">üì• Offline</div>
            <div id="downloads-content">
                <div style="text-align: center; padding: 4rem; color: rgba(255,255,255,0.6);">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">üì±</div>
                    <h3>Cargando m√∫sica offline...</h3>
                </div>
            </div>
        </section>

        <section class="content-section" id="admin-section">
            <div class="section-title">‚öôÔ∏è Administraci√≥n</div>
            <div id="admin-content"></div>
        </section>
    </main>

    <nav class="bottom-nav">
        <div class="bottom-nav-item active" onclick="showSection('home')">
            <div class="icon">üè†</div>
            <small>Inicio</small>
        </div>
        <div class="bottom-nav-item" onclick="showSection('search')">
            <div class="icon">üîç</div>
            <small>Buscar</small>
        </div>
        <div class="bottom-nav-item" onclick="showSection('downloads')">
            <div class="icon">üì•</div>
            <small>Offline</small>
        </div>
        <div class="bottom-nav-item" onclick="showSection('favorites')">
            <div class="icon">üíñ</div>
            <small>Favoritos</small>
        </div>
    </nav>

    <div class="player" id="mini-player">
        <img class="player-img-mini" id="player-img" alt="cover">
        <div class="player-info-mini">
            <div class="player-title-mini" id="player-title"></div>
            <div class="player-artist-mini" id="player-artist"></div>
        </div>
        <div class="player-controls-inline">
            <button class="play-btn-inline" id="play-btn" onclick="togglePlay()">‚ñ∂</button>
        </div>
    </div>

    <div class="modal" id="auth-modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal()">&times;</button>
            <div id="login-form">
                <h2 style="text-align: center; margin-bottom: 2rem; font-weight: 700; background: linear-gradient(135deg, #1DB954, #00ff88); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Iniciar Sesi√≥n</h2>
                <form onsubmit="login(event)">
                    <div class="form-group">
                        <input type="email" id="login-email" placeholder="Correo electr√≥nico" required>
                    </div>
                    <div class="form-group">
                        <input type="password" id="login-password" placeholder="Contrase√±a" required>
                    </div>
                    <button type="submit" class="btn-primary">Entrar</button>
                </form>
            </div>
            <div id="register-form" style="display: none;">
                <h2 style="text-align: center; margin-bottom: 2rem; font-weight: 700; background: linear-gradient(135deg, #1DB954, #00ff88); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Crear Cuenta</h2>
                <form onsubmit="register(event)">
                    <div class="form-group">
                        <input type="email" id="register-email" placeholder="Correo electr√≥nico" required>
                    </div>
                    <div class="form-group">
                        <input type="password" id="register-password" placeholder="Contrase√±a" required>
                    </div>
                    <div class="form-group">
                        <input type="password" id="register-confirm" placeholder="Confirmar Contrase√±a" required>
                    </div>
                    <button type="submit" class="btn-primary">Registrarse</button>
                </form>
            </div>
        </div>
    </div>

    <div class="copyright">¬© 2025 KLMZ MUSIC - Desarrollado por Freddy Granados</div>
    <audio id="audio-player" preload="metadata"></audio>

    <script>
        // ===== VARIABLES GLOBALES =====
        let supabase;
        let currentUser = null;
        let allAlbums = [];
        let allSongs = [];
        let currentSong = null;
        let currentAlbum = null;
        let currentPlaylist = [];
        let currentIndex = 0;
        let isPlaying = false;
        let isCordova = false;
        let audioPlayer = null; // Para Cordova Media
        
        const CONFIG = {
            supabaseUrl: 'https://nqbldvpnqhngdtalvzov.supabase.co',
            supabaseKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5xYmxkdnBucWhuZ2R0YWx2em92Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUyMjY0NjUsImV4cCI6MjA3MDgwMjQ2NX0.Zzg5D219sW7bhvl0_R5ypX9MF6nRzBSDIeo2Lvebab0',
            adminEmail: 'klmzr@gmail.com'
        };
        
        console.log('üöÄ KLMZ MUSIC - Aplicaci√≥n moderna iniciando...');
        
        // ===== DETECCI√ìN DE ENTORNO =====
        function detectEnvironment() {
            isCordova = !!(window.cordova || window.phonegap);
            console.log('üì± Entorno detectado:', isCordova ? 'Cordova APK' : 'Navegador Web');
            return isCordova;
        }

        // ===== REPRODUCTOR DE AUDIO H√çBRIDO (WEB + CORDOVA) =====
        class AudioPlayerManager {
            constructor() {
                this.media = null;
                this.htmlAudio = null;
                this.isPlaying = false;
                this.currentSrc = null;
            }

            async play(src, song, album) {
                console.log('üéµ Iniciando reproducci√≥n:', src);
                
                // Actualizar datos actuales
                currentSong = song;
                currentAlbum = album;
                
                try {
                    if (isCordova && window.Media) {
                        // Usar Cordova Media plugin
                        await this.playCordova(src);
                    } else {
                        // Usar HTML5 audio en web
                        await this.playWeb(src);
                    }
                    
                    this.updateUI();
                    console.log('‚úÖ Reproducci√≥n iniciada exitosamente');
                    
                } catch (error) {
                    console.error('‚ùå Error en reproducci√≥n:', error);
                    showToast('‚ùå Error reproduciendo: ' + error.message);
                }
            }

            async playCordova(src) {
                console.log('üì± Usando Cordova Media plugin');
                
                // Limpiar reproductor anterior
                if (this.media) {
                    this.media.stop();
                    this.media.release();
                    this.media = null;
                }

                return new Promise((resolve, reject) => {
                    this.media = new Media(
                        src,
                        // √âxito
                        () => {
                            console.log('‚úÖ Cordova: Reproducci√≥n completada');
                            this.isPlaying = false;
                            this.updateUI();
                            resolve();
                        },
                        // Error
                        (error) => {
                            console.error('‚ùå Cordova Media error:', error);
                            reject(new Error('Error en Cordova Media: ' + JSON.stringify(error)));
                        },
                        // Estado
                        (status) => {
                            console.log('üìä Cordova Media status:', status);
                            switch(status) {
                                case Media.MEDIA_STARTING:
                                    console.log('üîÑ Media iniciando...');
                                    break;
                                case Media.MEDIA_RUNNING:
                                    this.isPlaying = true;
                                    this.updateUI();
                                    break;
                                case Media.MEDIA_PAUSED:
                                    this.isPlaying = false;
                                    this.updateUI();
                                    break;
                                case Media.MEDIA_STOPPED:
                                    this.isPlaying = false;
                                    this.updateUI();
                                    break;
                            }
                        }
                    );

                    this.currentSrc = src;
                    this.media.play();
                    this.isPlaying = true;
                    resolve();
                });
            }

            async playWeb(src) {
                console.log('üåê Usando HTML5 Audio');
                
                // Limpiar reproductor anterior
                if (this.htmlAudio) {
                    this.htmlAudio.pause();
                    this.htmlAudio = null;
                }

                return new Promise((resolve, reject) => {
                    this.htmlAudio = new Audio();
                    
                    this.htmlAudio.onloadstart = () => console.log('üîÑ Cargando audio...');
                    this.htmlAudio.oncanplay = () => console.log('‚úÖ Audio listo para reproducir');
                    
                    this.htmlAudio.onplay = () => {
                        console.log('‚ñ∂Ô∏è Reproducci√≥n iniciada');
                        this.isPlaying = true;
                        this.updateUI();
                    };
                    
                    this.htmlAudio.onpause = () => {
                        console.log('‚è∏Ô∏è Reproducci√≥n pausada');
                        this.isPlaying = false;
                        this.updateUI();
                    };
                    
                    this.htmlAudio.onended = () => {
                        console.log('üîö Reproducci√≥n terminada');
                        this.isPlaying = false;
                        this.updateUI();
                    };
                    
                    this.htmlAudio.onerror = (error) => {
                        console.error('‚ùå HTML5 Audio error:', error);
                        reject(new Error('Error cargando audio HTML5'));
                    };

                    this.currentSrc = src;
                    this.htmlAudio.src = src;
                    this.htmlAudio.load();
                    
                    this.htmlAudio.play().then(() => {
                        this.isPlaying = true;
                        this.updateUI();
                        resolve();
                    }).catch(reject);
                });
            }

            pause() {
                console.log('‚è∏Ô∏è Pausando reproducci√≥n');
                
                if (isCordova && this.media) {
                    this.media.pause();
                } else if (this.htmlAudio) {
                    this.htmlAudio.pause();
                }
                
                this.isPlaying = false;
                this.updateUI();
            }

            resume() {
                console.log('‚ñ∂Ô∏è Reanudando reproducci√≥n');
                
                if (isCordova && this.media) {
                    this.media.play();
                } else if (this.htmlAudio) {
                    this.htmlAudio.play();
                }
                
                this.isPlaying = true;
                this.updateUI();
            }

            stop() {
                console.log('‚èπÔ∏è Deteniendo reproducci√≥n');
                
                if (isCordova && this.media) {
                    this.media.stop();
                    this.media.release();
                    this.media = null;
                } else if (this.htmlAudio) {
                    this.htmlAudio.pause();
                    this.htmlAudio.src = '';
                    this.htmlAudio = null;
                }
                
                this.isPlaying = false;
                this.updateUI();
            }

            updateUI() {
                // Actualizar mini player
                const player = document.getElementById('mini-player');
                const playBtn = document.getElementById('play-btn');
                
                if (currentSong && currentAlbum) {
                    player.style.display = 'flex';
                    document.getElementById('player-img').src = currentAlbum.cover_url || '';
                    document.getElementById('player-title').textContent = currentSong.title || 'Sin t√≠tulo';
                    document.getElementById('player-artist').textContent = currentAlbum.artist || 'Artista desconocido';
                }
                
                if (playBtn) {
                    playBtn.textContent = this.isPlaying ? '‚è∏' : '‚ñ∂';
                }
            }
        }

        // Instancia global del reproductor
        const audioManager = new AudioPlayerManager();
        
        // ===== SISTEMA DE FAVORITOS =====
        class FavoritesManager {
            constructor() {
                this.favorites = this.loadFavorites();
            }

            loadFavorites() {
                try {
                    const stored = localStorage.getItem('klmz_favorites');
                    return stored ? JSON.parse(stored) : [];
                } catch (error) {
                    console.error('Error cargando favoritos:', error);
                    return [];
                }
            }

            saveFavorites() {
                try {
                    localStorage.setItem('klmz_favorites', JSON.stringify(this.favorites));
                    console.log('‚úÖ Favoritos guardados:', this.favorites.length);
                } catch (error) {
                    console.error('Error guardando favoritos:', error);
                }
            }

            isFavorite(songId) {
                return this.favorites.some(fav => fav.id === songId);
            }

            addFavorite(song, album) {
                if (this.isFavorite(song.id)) {
                    console.log('‚ö†Ô∏è Canci√≥n ya en favoritos:', song.title);
                    return false;
                }

                const favorite = {
                    id: song.id,
                    title: song.title,
                    artist: album.artist,
                    album: album.title,
                    song_url: song.song_url,
                    cover_url: album.cover_url,
                    addedAt: new Date().toISOString()
                };

                this.favorites.push(favorite);
                this.saveFavorites();
                
                console.log('‚ù§Ô∏è Agregado a favoritos:', song.title);
                return true;
            }

            removeFavorite(songId) {
                const initialLength = this.favorites.length;
                this.favorites = this.favorites.filter(fav => fav.id !== songId);
                
                if (this.favorites.length < initialLength) {
                    this.saveFavorites();
                    console.log('üíî Removido de favoritos');
                    return true;
                }
                
                return false;
            }

            toggleFavorite(song, album) {
                if (this.isFavorite(song.id)) {
                    this.removeFavorite(song.id);
                    return false;
                } else {
                    this.addFavorite(song, album);
                    return true;
                }
            }

            getAllFavorites() {
                return [...this.favorites];
            }

            getFavorite(songId) {
                return this.favorites.find(fav => fav.id === songId);
            }

            clearFavorites() {
                this.favorites = [];
                this.saveFavorites();
                console.log('üßπ Favoritos limpiados');
            }
        }

        // Instancia global de favoritos
        const favoritesManager = new FavoritesManager();

        // ===== SISTEMA DE DESCARGAS H√çBRIDO =====
        class DownloadManager {
            constructor() {
                this.downloads = this.loadDownloads();
            }

            loadDownloads() {
                try {
                    const key = isCordova ? 'cordova_downloads' : 'web_downloads';
                    const stored = localStorage.getItem(key);
                    return stored ? JSON.parse(stored) : [];
                } catch (error) {
                    console.error('Error cargando descargas:', error);
                    return [];
                }
            }

            saveDownloads() {
                try {
                    const key = isCordova ? 'cordova_downloads' : 'web_downloads';
                    localStorage.setItem(key, JSON.stringify(this.downloads));
                    console.log('‚úÖ Descargas guardadas:', this.downloads.length);
                } catch (error) {
                    console.error('Error guardando descargas:', error);
                }
            }

            isDownloaded(songId) {
                return this.downloads.some(dl => dl.id === songId);
            }

            async downloadSong(song, album) {
                if (this.isDownloaded(song.id)) {
                    throw new Error('Canci√≥n ya descargada');
                }

                console.log('üì• Iniciando descarga:', song.title);

                try {
                    let downloadData;
                    
                    if (isCordova && window.FileTransfer) {
                        downloadData = await this.downloadCordova(song, album);
                    } else {
                        downloadData = await this.downloadWeb(song, album);
                    }

                    this.downloads.push(downloadData);
                    this.saveDownloads();

                    console.log('‚úÖ Descarga completada:', song.title);
                    return downloadData;

                } catch (error) {
                    console.error('‚ùå Error en descarga:', error);
                    throw error;
                }
            }

            async downloadCordova(song, album) {
                console.log('üì± Descarga Cordova iniciada');

                if (!window.cordova || !window.FileTransfer) {
                    throw new Error('Plugins Cordova no disponibles. Instalar: cordova plugin add cordova-plugin-file cordova-plugin-file-transfer');
                }

                const safeTitle = song.title.replace(/[^a-zA-Z0-9\-_\s]/g, '').trim();
                const fileName = `${safeTitle}_${song.id}.mp3`;

                return new Promise((resolve, reject) => {
                    const fileTransfer = new FileTransfer();
                    const fileURL = cordova.file.dataDirectory + fileName;

                    fileTransfer.onprogress = (progressEvent) => {
                        if (progressEvent.lengthComputable) {
                            const percent = Math.floor((progressEvent.loaded / progressEvent.total) * 100);
                            console.log(`üì• Progreso Cordova: ${percent}%`);
                        }
                    };

                    fileTransfer.download(
                        song.song_url,
                        fileURL,
                        (entry) => {
                            console.log('‚úÖ Archivo Cordova descargado:', entry.toURL());
                            
                            const downloadData = {
                                id: song.id,
                                title: song.title,
                                artist: album.artist,
                                album: album.title,
                                localPath: entry.toURL(),
                                fileName: fileName,
                                originalUrl: song.song_url,
                                coverUrl: album.cover_url,
                                downloadedAt: new Date().toISOString(),
                                platform: 'cordova'
                            };
                            
                            resolve(downloadData);
                        },
                        (error) => {
                            console.error('‚ùå Error descarga Cordova:', error);
                            reject(new Error('Error en descarga Cordova: ' + JSON.stringify(error)));
                        }
                    );
                });
            }

            async downloadWeb(song, album) {
                console.log('üåê Descarga Web iniciada');

                if (!window.indexedDB) {
                    throw new Error('IndexedDB no soportado en este navegador');
                }

                // Descargar el archivo
                console.log('üì• Descargando desde:', song.song_url);
                const response = await fetch(song.song_url);
                if (!response.ok) {
                    throw new Error(`Error HTTP: ${response.status} ${response.statusText}`);
                }

                const audioBlob = await response.blob();
                console.log('‚úÖ Audio descargado, tama√±o:', audioBlob.size, 'bytes');

                // Descargar portada
                let coverBlob = null;
                try {
                    const coverResponse = await fetch(album.cover_url);
                    if (coverResponse.ok) {
                        coverBlob = await coverResponse.blob();
                    }
                } catch (e) {
                    console.warn('‚ö†Ô∏è No se pudo descargar portada:', e);
                }

                // Guardar en IndexedDB
                const db = await this.openIndexedDB();
                
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction(['downloads'], 'readwrite');
                    const store = transaction.objectStore('downloads');
                    
                    const downloadData = {
                        id: song.id,
                        title: song.title,
                        artist: album.artist,
                        album: album.title,
                        audioBlob: audioBlob,
                        coverBlob: coverBlob,
                        originalUrl: song.song_url,
                        coverUrl: album.cover_url,
                        downloadedAt: new Date().toISOString(),
                        platform: 'web'
                    };

                    const request = store.put(downloadData);
                    
                    request.onsuccess = () => {
                        console.log('‚úÖ Guardado en IndexedDB');
                        resolve(downloadData);
                    };
                    
                    request.onerror = () => {
                        reject(new Error('Error guardando en IndexedDB'));
                    };
                });
            }

            async openIndexedDB() {
                return new Promise((resolve, reject) => {
                    const request = indexedDB.open('KLMZMusicDownloadsDB', 1);
                    
                    request.onerror = () => reject(new Error('Error abriendo IndexedDB'));
                    
                    request.onsuccess = (event) => {
                        console.log('‚úÖ IndexedDB abierta');
                        resolve(event.target.result);
                    };
                    
                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;
                        if (!db.objectStoreNames.contains('downloads')) {
                            const store = db.createObjectStore('downloads', { keyPath: 'id' });
                            console.log('‚úÖ Store de descargas creado');
                        }
                    };
                });
            }

            async getAllDownloads() {
                if (isCordova) {
                    return this.downloads;
                } else {
                    // Cargar desde IndexedDB
                    try {
                        const db = await this.openIndexedDB();
                        return new Promise((resolve) => {
                            const transaction = db.transaction(['downloads'], 'readonly');
                            const store = transaction.objectStore('downloads');
                            const request = store.getAll();
                            
                            request.onsuccess = () => resolve(request.result || []);
                            request.onerror = () => resolve([]);
                        });
                    } catch (error) {
                        console.error('Error cargando desde IndexedDB:', error);
                        return [];
                    }
                }
            }

            getDownload(songId) {
                return this.downloads.find(dl => dl.id === songId);
            }
        }

        // Instancia global de descargas
        const downloadManager = new DownloadManager();

        // ===== FUNCIONES PRINCIPALES =====

        function changeTheme(theme) {
            console.log('üé® Cambiando tema:', theme);
            const body = document.body;
            ['theme-neon', 'theme-sunset', 'theme-oceanic'].forEach(t => body.classList.remove(t));
            if (theme !== 'default') body.classList.add('theme-' + theme);
            localStorage.setItem('klmz_theme', theme);
            console.log('‚úÖ Tema aplicado:', theme);
        }
        
        function loadTheme() {
            const saved = localStorage.getItem('klmz_theme') || 'default';
            document.getElementById('theme-select').value = saved;
            changeTheme(saved);
        }
        
        async function initSupabase() {
            try {
                console.log('üîÑ Inicializando Supabase...');
                supabase = window.supabase.createClient(CONFIG.supabaseUrl, CONFIG.supabaseKey);
                
                supabase.auth.onAuthStateChange((event, session) => {
                    currentUser = session?.user || null;
                    updateAuthUI();
                });
                
                const { data: { session } } = await supabase.auth.getSession();
                currentUser = session?.user || null;
                updateAuthUI();
                console.log('‚úÖ Supabase inicializado');
                return true;
            } catch (error) {
                console.error('‚ùå Error Supabase:', error);
                return false;
            }
        }
        
        async function loadData() {
            try {
                showLoading(true);
                console.log('üìä Cargando datos...');
                
                if (!supabase) throw new Error('Supabase no inicializado');
                
                const { data: albums, error: albumError } = await supabase
                    .from('albums').select('*').order('created_at', { ascending: false });
                if (albumError) throw albumError;
                
                const { data: songs, error: songError } = await supabase
                    .from('songs').select('*, albums:album_id(*)').order('created_at', { ascending: false });
                if (songError) throw songError;
                
                allAlbums = albums || [];
                allSongs = songs || [];
                
                console.log(`‚úÖ Cargados: ${allAlbums.length} √°lbumes, ${allSongs.length} canciones`);
                displayAlbums();
                
            } catch (error) {
                console.error('‚ùå Error cargando datos:', error);
                document.getElementById('albums').innerHTML = `
                    <div style="text-align: center; padding: 4rem; color: #ff4757;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">‚ùå</div>
                        <h3>Error de conexi√≥n</h3>
                        <p style="margin: 1rem 0;">${error.message}</p>
                        <button onclick="loadData()" class="btn-primary" style="width: auto; margin-top: 1rem;">üîÑ Reintentar</button>
                    </div>
                `;
            } finally {
                showLoading(false);
            }
        }
        
        function displayAlbums() {
            const container = document.getElementById('albums');
            
            if (allAlbums.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 4rem; color: rgba(255,255,255,0.6);">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">üéº</div>
                        <h3 style="margin-bottom: 1rem;">No hay √°lbumes disponibles</h3>
                        <p style="margin-bottom: 2rem;">Inicia sesi√≥n como administrador para subir m√∫sica</p>
                        ${currentUser?.email === CONFIG.adminEmail ? '<button onclick="showSection(\'admin\')" class="btn-primary" style="width: auto; margin-top: 1rem;">‚öôÔ∏è Ir al Panel Admin</button>' : ''}
                    </div>
                `;
                return;
            }
            
            container.innerHTML = allAlbums.map(album => `
                <div class="album-card" onclick="showAlbum('${album.id}')">
                    <img class="album-img" src="${album.cover_url}" alt="${album.title}" onerror="this.style.background='linear-gradient(135deg, #333, #555)'; this.alt='üéµ';">
                    <div class="album-title">${album.title}</div>
                    <div class="album-artist">${album.artist}</div>
                </div>
            `).join('');
        }
        
        async function showAlbum(albumId) {
            try {
                console.log('üîç Mostrando √°lbum:', albumId);
                
                const album = allAlbums.find(a => a.id === albumId);
                if (!album) return;
                
                currentAlbum = album;
                
                document.getElementById('albums').style.display = 'none';
                const detail = document.getElementById('album-detail');
                detail.style.display = 'block';
                
                detail.innerHTML = `
                    <button class="back-btn" onclick="backToAlbums()">
                        <span>‚üµ</span> Volver a √°lbumes
                    </button>
                    <div style="text-align: center; margin-bottom: 3rem;">
                        <img src="${album.cover_url}" style="width: 250px; height: 250px; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.4); margin-bottom: 1.5rem;" onerror="this.style.background='linear-gradient(135deg, #333, #555)';">
                        <h2 style="font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem;">${album.title}</h2>
                        <p style="color: rgba(255,255,255,0.7); font-size: 1.1rem;">${album.artist}</p>
                    </div>
                    <div id="song-list">
                        <div style="text-align: center; color: rgba(255,255,255,0.6);">
                            <div style="font-size: 2rem; margin-bottom: 1rem;">üéµ</div>
                            <h3>Cargando canciones...</h3>
                        </div>
                    </div>
                `;
                
                const { data: songs } = await supabase.from('songs').select('*').eq('album_id', albumId);
                const songList = document.getElementById('song-list');
                
                if (!songs || songs.length === 0) {
                    songList.innerHTML = `
                        <div style="text-align: center; color: rgba(255,255,255,0.6); padding: 3rem;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">üì≠</div>
                            <h3>No hay canciones</h3>
                            <p style="margin: 1rem 0;">Este √°lbum a√∫n no tiene canciones</p>
                            ${currentUser?.email === CONFIG.adminEmail ? '<button onclick="showSection(\'admin\')" class="btn-primary" style="width: auto; margin-top: 1rem;">‚öôÔ∏è Subir Canciones</button>' : ''}
                        </div>
                    `;
                    return;
                }
                
                currentPlaylist = songs;
                
                songList.innerHTML = `
                    <div class="song-list">
                        <ul>
                            ${songs.map((song, idx) => `
                                <li data-song-id="${song.id}">
                                    <div onclick="playSong(${JSON.stringify(song).replace(/"/g, '&quot;')}, ${JSON.stringify(album).replace(/"/g, '&quot;')})" style="flex: 1; cursor: pointer;">
                                        <div class="song-title">${song.title}</div>
                                    </div>
                                    <div class="song-actions">
                                        <span class="action-btn favorite-btn ${favoritesManager.isFavorite(song.id) ? 'active' : ''}" 
                                              onclick="toggleFavorite(${JSON.stringify(song).replace(/"/g, '&quot;')}, ${JSON.stringify(album).replace(/"/g, '&quot;')}, this)" 
                                              title="${favoritesManager.isFavorite(song.id) ? 'Quitar de favoritos' : 'Agregar a favoritos'}">
                                            ${favoritesManager.isFavorite(song.id) ? '‚ù§Ô∏è' : 'ü§ç'}
                                        </span>
                                        <span class="action-btn download-btn ${downloadManager.isDownloaded(song.id) ? 'downloaded' : ''}" 
                                              onclick="downloadSong(${JSON.stringify(song).replace(/"/g, '&quot;')}, ${JSON.stringify(album).replace(/"/g, '&quot;')}, this)" 
                                              title="${downloadManager.isDownloaded(song.id) ? 'Ya descargada' : 'Descargar para offline'}">
                                            ${downloadManager.isDownloaded(song.id) ? '‚úì' : '‚Üì'}
                                        </span>
                                        <span class="action-btn play-btn" 
                                              onclick="playSong(${JSON.stringify(song).replace(/"/g, '&quot;')}, ${JSON.stringify(album).replace(/"/g, '&quot;')})" 
                                              title="Reproducir">‚ñ∂</span>
                                    </div>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                `;
                
            } catch (error) {
                console.error('‚ùå Error mostrando √°lbum:', error);
            }
        }

        // ===== FUNCIONES DE REPRODUCCI√ìN =====
        
        async function playSong(song, album) {
            if (!song || !song.song_url) {
                console.error('‚ùå Datos de canci√≥n inv√°lidos');
                showToast('‚ùå Error: Datos de canci√≥n inv√°lidos');
                return;
            }
            
            console.log('üéµ === INICIANDO REPRODUCCI√ìN ===');
            console.log('Canci√≥n:', song.title);
            console.log('URL:', song.song_url);
            console.log('Entorno:', isCordova ? 'Cordova' : 'Web');
            
            try {
                await audioManager.play(song.song_url, song, album);
                showToast(`üéµ Reproduciendo: ${song.title}`);
            } catch (error) {
                console.error('‚ùå Error en playSong:', error);
                showToast('‚ùå Error reproduciendo canci√≥n');
            }
        }
        
        function togglePlay() {
            if (audioManager.isPlaying) {
                audioManager.pause();
                showToast('‚è∏Ô∏è Pausado');
            } else {
                audioManager.resume();
                showToast('‚ñ∂Ô∏è Reproduciendo');
            }
        }

        // ===== FUNCIONES DE DESCARGA =====
        
        async function downloadSong(song, album, element) {
            if (!song || !album || !element) {
                showToast('‚ùå Error: Datos inv√°lidos para descarga');
                return;
            }
            
            if (element.classList.contains('downloaded')) {
                showToast('‚ö†Ô∏è Canci√≥n ya descargada');
                return;
            }
            
            const originalText = element.textContent;
            const originalColor = element.style.color;
            
            try {
                element.textContent = '‚è≥';
                element.style.color = '#ff9800';
                
                await downloadManager.downloadSong(song, album);
                
                element.classList.add('downloaded');
                element.textContent = '‚úì';
                element.style.color = '#1DB954';
                
                showToast(`‚úÖ "${song.title}" descargada para offline`);
                console.log('‚úÖ Descarga completada exitosamente');
                
            } catch (error) {
                console.error('‚ùå Error en descarga:', error);
                element.textContent = originalText;
                element.style.color = originalColor;
                showToast('‚ùå Error: ' + error.message);
            }
        }

        // ===== FUNCIONES DE FAVORITOS =====
        
        function toggleFavorite(song, album, element) {
            console.log('‚ù§Ô∏è Toggle favorito:', song.title);
            
            const wasAdded = favoritesManager.toggleFavorite(song, album);
            
            if (element) {
                element.innerHTML = wasAdded ? '‚ù§Ô∏è' : 'ü§ç';
                element.classList.toggle('active', wasAdded);
                element.title = wasAdded ? 'Quitar de favoritos' : 'Agregar a favoritos';
            }
            
            updateAllFavoriteButtons(song.id, wasAdded);
            
            const message = wasAdded ? `‚ù§Ô∏è "${song.title}" agregada a favoritos` : `üíî "${song.title}" removida de favoritos`;
            showToast(message);
            
            if (document.getElementById('favorites-section').classList.contains('active')) {
                setTimeout(() => loadFavorites(), 500);
            }
        }

        function updateAllFavoriteButtons(songId, isFavorite) {
            const buttons = document.querySelectorAll(`[data-song-id="${songId}"] .favorite-btn`);
            buttons.forEach(btn => {
                btn.innerHTML = isFavorite ? '‚ù§Ô∏è' : 'ü§ç';
                btn.classList.toggle('active', isFavorite);
                btn.title = isFavorite ? 'Quitar de favoritos' : 'Agregar a favoritos';
            });
        }

        async function loadFavorites() {
            console.log('‚ù§Ô∏è Cargando secci√≥n de favoritos...');
            
            try {
                showLoading(true);
                const favorites = favoritesManager.getAllFavorites();
                const content = document.getElementById('favorites-content');
                
                if (favorites.length === 0) {
                    content.innerHTML = `
                        <div style="text-align: center; padding: 4rem; color: rgba(255,255,255,0.6);">
                            <div style="font-size: 4rem; margin-bottom: 1rem;">üíî</div>
                            <h3 style="margin-bottom: 1rem;">No tienes favoritos a√∫n</h3>
                            <p style="margin-bottom: 2rem;">Descubre m√∫sica incre√≠ble y marca tus canciones favoritas</p>
                            <button onclick="showSection('home')" class="btn-primary" style="width: auto; padding: 1rem 2rem;">
                                üéµ Explorar M√∫sica
                            </button>
                        </div>
                    `;
                    return;
                }
                
                console.log(`‚ù§Ô∏è Mostrando ${favorites.length} favoritos`);
                
                content.innerHTML = `
                    <div style="margin-bottom: 2rem; text-align: center;">
                        <div style="display: inline-flex; align-items: center; gap: 1rem; background: rgba(255, 71, 87, 0.1); padding: 1rem 2rem; border-radius: 50px; border: 1px solid rgba(255, 71, 87, 0.3);">
                            <span style="color: #ff4757; font-weight: 600; font-size: 1.1rem;">‚ù§Ô∏è ${favorites.length} canciones favoritas</span>
                            <button onclick="clearAllFavorites()" style="background: rgba(255, 71, 87, 0.2); border: 1px solid #ff4757; color: #ff4757; padding: 0.5rem 1rem; border-radius: 20px; cursor: pointer; font-size: 0.8rem;">
                                üóëÔ∏è Limpiar
                            </button>
                        </div>
                    </div>
                    
                    <div class="favorites-list">
                        ${favorites.sort((a, b) => new Date(b.addedAt) - new Date(a.addedAt)).map(favorite => `
                            <div class="favorite-item" data-song-id="${favorite.id}">
                                <div class="favorite-info" onclick="playFavoriteSong('${favorite.id}')">
                                    <div class="favorite-title">${favorite.title}</div>
                                    <div class="favorite-artist">${favorite.artist}</div>
                                    <div class="favorite-album">${favorite.album}</div>
                                    <small style="color: rgba(255,255,255,0.4); font-size: 0.7rem; margin-top: 0.3rem; display: block;">
                                        üíñ ${new Date(favorite.addedAt).toLocaleDateString()}
                                    </small>
                                </div>
                                <div class="song-actions">
                                    <span class="action-btn favorite-btn active" 
                                          onclick="toggleFavoriteFromList('${favorite.id}', this)" 
                                          title="Quitar de favoritos">‚ù§Ô∏è</span>
                                    <span class="action-btn play-btn" 
                                          onclick="playFavoriteSong('${favorite.id}')" 
                                          title="Reproducir">‚ñ∂</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                
            } catch (error) {
                console.error('‚ùå Error cargando favoritos:', error);
                document.getElementById('favorites-content').innerHTML = `
                    <div style="text-align: center; padding: 4rem; color: #ff4757;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">‚ùå</div>
                        <h3>Error cargando favoritos</h3>
                        <p style="margin: 1rem 0;">${error.message}</p>
                        <button onclick="loadFavorites()" class="btn-primary" style="width: auto; margin-top: 1rem;">
                            üîÑ Reintentar
                        </button>
                    </div>
                `;
            } finally {
                showLoading(false);
            }
        }

        function toggleFavoriteFromList(songId, element) {
            const favorite = favoritesManager.getFavorite(songId);
            if (favorite) {
                const song = {
                    id: favorite.id,
                    title: favorite.title,
                    song_url: favorite.song_url
                };
                
                const album = {
                    title: favorite.album,
                    artist: favorite.artist,
                    cover_url: favorite.cover_url
                };
                
                toggleFavorite(song, album, element);
            }
        }

        function playFavoriteSong(songId) {
            const favorite = favoritesManager.getFavorite(songId);
            if (!favorite) {
                showToast('‚ùå Canci√≥n favorita no encontrada');
                return;
            }
            
            console.log('üéµ Reproduciendo favorito:', favorite.title);
            
            const song = {
                id: favorite.id,
                title: favorite.title,
                song_url: favorite.song_url
            };
            
            const album = {
                title: favorite.album,
                artist: favorite.artist,
                cover_url: favorite.cover_url
            };
            
            playSong(song, album);
        }

        function clearAllFavorites() {
            if (!confirm('¬øEst√°s seguro de que quieres eliminar TODOS los favoritos? Esta acci√≥n no se puede deshacer.')) {
                return;
            }
            
            favoritesManager.clearFavorites();
            showToast('üßπ Todos los favoritos han sido eliminados');
            loadFavorites();
        }

        // ===== FUNCI√ìN PARA CARGAR DESCARGAS =====
        
        async function loadDownloads() {
            console.log('üì• Cargando secci√≥n de descargas...');
            
            try {
                showLoading(true);
                const downloads = await downloadManager.getAllDownloads();
                const content = document.getElementById('downloads-content');
                
                if (downloads.length === 0) {
                    content.innerHTML = `
                        <div style="text-align: center; padding: 4rem; color: rgba(255,255,255,0.6);">
                            <div style="font-size: 4rem; margin-bottom: 1rem;">üì•</div>
                            <h3 style="margin-bottom: 1rem;">No tienes m√∫sica offline</h3>
                            <p style="margin-bottom: 1rem;">Descarga canciones para escuchar sin conexi√≥n</p>
                            <p style="font-size: 0.9rem; color: rgba(255,255,255,0.4);">
                                <strong>Entorno:</strong> ${isCordova ? 'üì± Android APK' : 'üåê Navegador Web'}
                            </p>
                            <button onclick="showSection('home')" class="btn-primary" style="width: auto; padding: 1rem 2rem; margin-top: 1rem;">
                                üéµ Explorar M√∫sica
                            </button>
                        </div>
                    `;
                    return;
                }
                
                console.log(`üì• Mostrando ${downloads.length} descargas`);
                
                content.innerHTML = `
                    <div style="margin-bottom: 2rem; text-align: center;">
                        <div style="display: inline-flex; align-items: center; gap: 1rem; background: rgba(29, 185, 84, 0.1); padding: 1rem 2rem; border-radius: 50px; border: 1px solid rgba(29, 185, 84, 0.3);">
                            <span style="color: #1DB954; font-weight: 600; font-size: 1.1rem;">üì• ${downloads.length} canciones offline ‚Ä¢ ${isCordova ? 'üì± APK' : 'üåê Web'}</span>
                        </div>
                    </div>
                    
                    <div class="downloads-list">
                        ${downloads.map(download => `
                            <div onclick="playOfflineSong('${download.id}')" style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.08); padding: 1.5rem; margin-bottom: 1rem; border-radius: 16px; cursor: pointer; border-left: 4px solid #1DB954; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.08)'; this.style.transform='translateX(8px)'" onmouseout="this.style.background='rgba(255,255,255,0.05)'; this.style.transform='translateX(0)'">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; margin-bottom: 0.3rem; color: #fff; font-size: 1.1rem;">${download.title}</div>
                                        <div style="font-size: 0.9rem; color: rgba(255, 255, 255, 0.7);">${download.artist} ‚Ä¢ ${download.album}</div>
                                        <small style="color: rgba(255,255,255,0.4); font-size: 0.7rem; margin-top: 0.3rem; display: block;">
                                            üì• ${new Date(download.downloadedAt).toLocaleDateString()} ‚Ä¢ ${download.platform}
                                        </small>
                                    </div>
                                    <div style="color: #1DB954; font-size: 1.5rem;">‚úì</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                
            } catch (error) {
                console.error('‚ùå Error cargando descargas:', error);
                document.getElementById('downloads-content').innerHTML = `
                    <div style="text-align: center; padding: 4rem; color: #ff4757;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">‚ùå</div>
                        <h3>Error cargando descargas</h3>
                        <p style="margin: 1rem 0;">${error.message}</p>
                    </div>
                `;
            } finally {
                showLoading(false);
            }
        }

        async function playOfflineSong(songId) {
            try {
                console.log('üéµ Reproduciendo canci√≥n offline:', songId);
                
                const downloads = await downloadManager.getAllDownloads();
                const download = downloads.find(dl => dl.id === songId);
                
                if (!download) {
                    showToast('‚ùå Canci√≥n offline no encontrada');
                    return;
                }
                
                let audioSrc;
                
                if (isCordova) {
                    audioSrc = download.localPath;
                } else {
                    // Crear URL desde blob
                    audioSrc = URL.createObjectURL(download.audioBlob);
                }
                
                const song = {
                    id: download.id,
                    title: download.title,
                    song_url: audioSrc
                };
                
                const album = {
                    title: download.album,
                    artist: download.artist,
                    cover_url: download.coverUrl
                };
                
                await audioManager.play(audioSrc, song, album);
                showToast(`üéµ Reproduciendo offline: ${download.title}`);
                
                console.log('‚úÖ Reproducci√≥n offline iniciada');
                
            } catch (error) {
                console.error('‚ùå Error reproduciendo canci√≥n offline:', error);
                showToast('‚ùå Error reproduciendo canci√≥n offline');
            }
        }
        
        // ===== FUNCIONES DE INTERFAZ =====
        
        function showToast(message) {
            const toast = document.createElement('div');
            toast.textContent = message;
            toast.style.cssText = `
                position: fixed;
                top: 100px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(26, 26, 46, 0.95);
                backdrop-filter: blur(20px);
                border: 1px solid rgba(255, 255, 255, 0.1);
                color: #fff;
                padding: 1rem 2rem;
                border-radius: 50px;
                z-index: 10000;
                font-size: 14px;
                font-weight: 500;
                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
                animation: toastSlideIn 0.4s ease;
            `;
            
            const style = document.createElement('style');
            style.textContent = `
                @keyframes toastSlideIn {
                    0% { opacity: 0; transform: translateX(-50%) translateY(-30px); }
                    100% { opacity: 1; transform: translateX(-50%) translateY(0); }
                }
                @keyframes toastSlideOut {
                    0% { opacity: 1; transform: translateX(-50%) translateY(0); }
                    100% { opacity: 0; transform: translateX(-50%) translateY(-30px); }
                }
            `;
            
            document.head.appendChild(style);
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'toastSlideOut 0.4s ease';
                setTimeout(() => {
                    if (document.body.contains(toast)) document.body.removeChild(toast);
                    if (document.head.contains(style)) document.head.removeChild(style);
                }, 400);
            }, 2100);
        }
        
        function backToAlbums() {
            document.getElementById('album-detail').style.display = 'none';
            document.getElementById('albums').style.display = 'grid';
        }
        
        function showSection(sectionName) {
            console.log('üß≠ Navegando a:', sectionName);
            
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.bottom-nav-item').forEach(n => n.classList.remove('active'));
            
            document.getElementById(sectionName + '-section').classList.add('active');
            
            const navMap = { home: 0, search: 1, downloads: 2, favorites: 3 };
            const navItems = document.querySelectorAll('.bottom-nav-item');
            if (navMap.hasOwnProperty(sectionName)) {
                navItems[navMap[sectionName]].classList.add('active');
            }
            
            if (sectionName === 'favorites') {
                loadFavorites();
            }
            
            if (sectionName === 'downloads') {
                loadDownloads();
            }
            
            if (sectionName === 'admin') {
                if (!currentUser || currentUser.email !== CONFIG.adminEmail) {
                    showToast('üîí Solo el administrador puede acceder');
                    showSection('home');
                    return;
                }
                loadAdminPanel();
            }
        }
        
        function searchMusic() {
            const query = document.getElementById('search-input').value.toLowerCase();
            const results = document.getElementById('search-results');
            
            if (!query) {
                results.innerHTML = '';
                return;
            }
            
            const found = allSongs.filter(s => 
                s.title.toLowerCase().includes(query) || 
                s.albums?.artist?.toLowerCase().includes(query)
            );
            
            if (found.length === 0) {
                results.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: rgba(255,255,255,0.6);">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">üîç</div>
                        <h3>No se encontraron resultados</h3>
                        <p>Intenta con otro t√©rmino de b√∫squeda</p>
                    </div>
                `;
                return;
            }
            
            results.innerHTML = found.map(song => `
                <div style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.08); padding: 1.5rem; margin: 1rem 0; border-radius: 16px; cursor: pointer; transition: all 0.3s ease;" 
                     onclick="playSong(${JSON.stringify(song).replace(/"/g, '&quot;')}, ${JSON.stringify(song.albums).replace(/"/g, '&quot;')})"
                     onmouseover="this.style.background='rgba(255,255,255,0.08)'; this.style.transform='translateX(8px)'"
                     onmouseout="this.style.background='rgba(255,255,255,0.05)'; this.style.transform='translateX(0)'">
                    <div style="font-weight: 600; font-size: 1.1rem; margin-bottom: 0.3rem;">${song.title}</div>
                    <div style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">${song.albums?.artist || 'Desconocido'}</div>
                </div>
            `).join('');
        }
        
        function toggleUserMenu() { 
            document.getElementById('userDropdown').classList.toggle('show'); 
        }
        
        function showAuth(type) {
            document.getElementById('userDropdown').classList.remove('show');
            document.getElementById('login-form').style.display = type === 'login' ? 'block' : 'none';
            document.getElementById('register-form').style.display = type === 'register' ? 'block' : 'none';
            document.getElementById('auth-modal').style.display = 'flex';
        }
        
        function closeModal() { 
            document.getElementById('auth-modal').style.display = 'none'; 
        }
        
        function showLoading(show) { 
            document.getElementById('loading').style.display = show ? 'block' : 'none'; 
        }
        
        function updateAuthUI() {
            const adminBtn = document.getElementById('adminBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            const lockIcon = document.getElementById('header-lock-icon');
            
            if (currentUser) {
                lockIcon.textContent = 'üë§';
                logoutBtn.style.display = 'block';
                if (currentUser.email === CONFIG.adminEmail) {
                    adminBtn.style.display = 'block';
                    lockIcon.textContent = '‚öôÔ∏è';
                }
            } else {
                lockIcon.textContent = 'üîí';
                adminBtn.style.display = 'none';
                logoutBtn.style.display = 'none';
            }
        }
        
        async function login(event) {
            event.preventDefault();
            try {
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                const { error } = await supabase.auth.signInWithPassword({ email, password });
                if (error) throw error;
                showToast('‚úÖ ¬°Bienvenido de vuelta!');
                closeModal();
            } catch (error) {
                showToast('‚ùå Error: ' + error.message);
            }
        }
        
        async function register(event) {
            event.preventDefault();
            try {
                const email = document.getElementById('register-email').value;
                const password = document.getElementById('register-password').value;
                const confirm = document.getElementById('register-confirm').value;
                if (password !== confirm) { 
                    showToast('‚ùå Las contrase√±as no coinciden'); 
                    return; 
                }
                const { error } = await supabase.auth.signUp({ email, password });
                if (error) throw error;
                showToast('‚úÖ Registro exitoso. Revisa tu email.');
                closeModal();
            } catch (error) {
                showToast('‚ùå Error: ' + error.message);
            }
        }
        
        async function logout() {
            try {
                await supabase.auth.signOut();
                showToast('‚úÖ Sesi√≥n cerrada correctamente');
                showSection('home');
            } catch (error) {
                console.error('Error logout:', error);
            }
        }
        
        function loadAdminPanel() {
            document.getElementById('admin-content').innerHTML = `
                <div style="text-align: center; padding: 4rem; color: rgba(255,255,255,0.6);">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">‚öôÔ∏è</div>
                    <h3 style="margin-bottom: 1rem;">Panel de Administraci√≥n</h3>
                    <div style="background: rgba(29,185,84,0.1); border: 1px solid rgba(29,185,84,0.3); padding: 2rem; border-radius: 16px; margin: 2rem 0;">
                        <p><strong>üìÄ √Ålbumes:</strong> ${allAlbums.length}</p>
                        <p><strong>üéµ Canciones:</strong> ${allSongs.length}</p>
                        <p><strong>üë§ Usuario:</strong> ${currentUser?.email}</p>
                        <p><strong>üì± Entorno:</strong> ${isCordova ? 'Cordova APK' : 'Navegador Web'}</p>
                    </div>
                    <p>Panel completo disponible pr√≥ximamente</p>
                </div>
            `;
        }
        
        // ===== INICIALIZACI√ìN =====
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üöÄ === INICIALIZANDO KLMZ MUSIC COMPLETA ===');
            
            try {
                loadTheme();
                detectEnvironment();
                
                const supabaseOk = await initSupabase();
                if (supabaseOk) {
                    await loadData();
                    console.log('‚úÖ === APLICACI√ìN COMPLETAMENTE INICIADA ===');
                } else {
                    console.error('‚ùå Error inicializando aplicaci√≥n');
                }
                
            } catch (error) {
                console.error('‚ùå Error cr√≠tico:', error);
                showLoading(false);
            }
        });
        
        document.addEventListener('deviceready', () => {
            console.log('üì± === CORDOVA DEVICE READY ===');
            detectEnvironment();
        }, false);
        
        console.log('‚úÖ === SCRIPT COMPLETO CARGADO ===');
    </script>
</body>
</html>
