<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>KLMZ MUSIC</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: Arial, sans-serif; background: #111; color: #fff; margin: 0; padding: 0; }
header { background: #222; padding: 10px; text-align: center; font-size: 1.5em; }
main { padding: 10px; }
.album { background: #222; padding: 10px; margin: 10px 0; border-radius: 5px; }
button { padding: 5px 10px; margin-top: 5px; cursor: pointer; }
input, select { margin: 5px 0; padding: 5px; }
audio { width: 100%; margin-top: 10px; }
.hidden { display: none; }
</style>
</head>
<body>
<header>KLMZ MUSIC</header>

<main>
<section id="login-section">
    <h2>Iniciar sesión</h2>
    <input type="email" id="email" placeholder="Email"><br>
    <input type="password" id="password" placeholder="Contraseña"><br>
    <button onclick="login()">Entrar</button>
</section>

<section id="admin-section" class="hidden">
    <h2>Subir Álbum</h2>
    <input type="text" id="album-name" placeholder="Nombre del álbum"><br>
    <input type="file" id="album-cover"><br>
    <button onclick="uploadAlbum()">Subir Álbum</button>

    <h2>Subir Canción</h2>
    <select id="album-select"></select><br>
    <input type="text" id="song-name" placeholder="Nombre de la canción"><br>
    <input type="file" id="song-file"><br>
    <button onclick="uploadSong()">Subir Canción</button>
</section>

<h2>Álbumes</h2>
<div id="albums-list"></div>
</main>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
const SUPABASE_URL = "https://nqbldvpnqhngdtalvzov.supabase.co"; // Cambia
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5xYmxkdnBucWhuZ2R0YWx2em92Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUyMjY0NjUsImV4cCI6MjA3MDgwMjQ2NX0.Zzg5D219sW7bhvl0_R5ypX9MF6nRzBSDIeo2Lvebab0"; // Cambia
const ADMIN_EMAIL = "klmzr230@gmail.com"; // Cambia
const ADMIN_PASSWORD = "freddyg23."; // Cambia

const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

async function login() {
    const email = document.getElementById("email").value;
    const pass = document.getElementById("password").value;

    if (email === ADMIN_EMAIL && pass === ADMIN_PASSWORD) {
        document.getElementById("login-section").classList.add("hidden");
        document.getElementById("admin-section").classList.remove("hidden");
        loadAlbums();
    } else {
        alert("Credenciales incorrectas");
    }
}

async function uploadAlbum() {
    const name = document.getElementById("album-name").value;
    const file = document.getElementById("album-cover").files[0];
    if (!name || !file) return alert("Completa todos los campos");

    const { data: storageData, error: storageError } = await supabase.storage
        .from("covers")
        .upload(`covers/${Date.now()}_${file.name}`, file);

    if (storageError) return alert("Error subiendo portada");

    const { data, error } = await supabase.from("albums").insert([{ name, cover: storageData.path }]);
    if (error) return alert("Error insertando álbum");
    alert("Álbum subido");
    loadAlbums();
}

async function uploadSong() {
    const albumId = document.getElementById("album-select").value;
    const name = document.getElementById("song-name").value;
    const file = document.getElementById("song-file").files[0];
    if (!albumId || !name || !file) return alert("Completa todos los campos");

    const { data: storageData, error: storageError } = await supabase.storage
        .from("songs")
        .upload(`songs/${Date.now()}_${file.name}`, file);

    if (storageError) return alert("Error subiendo canción");

    const { data, error } = await supabase.from("songs").insert([{ album_id: albumId, name, file: storageData.path }]);
    if (error) return alert("Error insertando canción");
    alert("Canción subida");
    loadAlbums();
}

async function loadAlbums() {
    const { data: albums } = await supabase.from("albums").select("*");
    const { data: songs } = await supabase.from("songs").select("*");

    const list = document.getElementById("albums-list");
    const select = document.getElementById("album-select");
    list.innerHTML = "";
    select.innerHTML = "";

    albums.forEach(album => {
        const albumDiv = document.createElement("div");
        albumDiv.className = "album";
        albumDiv.innerHTML = `<h3>${album.name}</h3><img src="${supabase.storage.from("covers").getPublicUrl(album.cover).data.publicUrl}" width="150">`;

        songs.filter(s => s.album_id === album.id).forEach(song => {
            const songUrl = supabase.storage.from("songs").getPublicUrl(song.file).data.publicUrl;
            const audio = document.createElement("audio");
            audio.controls = true;
            audio.src = songUrl;

            const fsBtn = document.createElement("button");
            fsBtn.textContent = "Pantalla completa";
            fsBtn.onclick = () => audio.requestFullscreen?.() || alert("Tu navegador no soporta fullscreen de audio");

            albumDiv.appendChild(document.createElement("br"));
            albumDiv.appendChild(document.createTextNode(song.name));
            albumDiv.appendChild(audio);
            albumDiv.appendChild(fsBtn);
        });

        list.appendChild(albumDiv);

        const option = document.createElement("option");
        option.value = album.id;
        option.textContent = album.name;
        select.appendChild(option);
    });
}

loadAlbums();
</script>
</body>
</html>
