<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>KLMZ MUSIC</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  
  <style>
    /* Estilos Base y Generales */
    * { box-sizing: border-box; }
    body { margin: 0; font-family: -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif; background: #181818; color: #fff; padding-bottom: 84px; transition: all 0.3s ease;}
    header { background: #121212; padding: 1rem 1.5rem; display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 100; transition: all 0.3s ease; }
    .logo { font-weight: bold; font-size: 1.4rem; letter-spacing: 1px; transition: all 0.3s ease; color: #1DB954; }
    .user-actions { display:flex; align-items: center; gap:.5rem; }
    .lock-icon { cursor:pointer; font-size:1.4rem; color:#fff; user-select:none; transition: all 0.3s ease; }
    .lock-icon:hover { opacity:.7;}
    .lock-icon.admin{background:#1DB954;animation:crownPulse 1.5s infinite;border-radius:8px;padding:0.5rem;}
    @keyframes crownPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}
    .theme-selector { display: flex; align-items: center; gap: 0.3rem; margin-right: 0.5rem; }
    .theme-selector label { font-size: 0.7rem; color: #b3b3b3; }
    .theme-selector select { background: #333; color: #fff; border: 1px solid #555; border-radius: 4px; padding: 0.1rem 0.2rem; font-size: 0.7rem; cursor: pointer; transition: all 0.3s ease; }
    .app-container { display: flex; min-height: calc(100vh - 60px);}
    main { flex:1; padding:1rem; max-width:900px; margin:0 auto;}
    .section-title { font-size:1.8rem; font-weight:bold; margin-bottom:1.5rem; transition: all 0.3s ease; }
    .album-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(140px,1fr)); gap:1.5rem;}
    .album-card { background:none; padding:0; cursor:pointer; display:flex; flex-direction:column; align-items:center; text-align:center; transition: transform 0.3s; position: relative;}
    .album-card:hover { transform:scale(1.05);}
    .album-actions{position:absolute;top:0.5rem;right:0.5rem;display:none;gap:0.5rem;z-index:2;}
    .album-card:hover .album-actions{display:flex;}
    .album-img { border-radius:50%; width:100px; height:100px; object-fit:cover; margin-bottom:.7rem; background:#333; transition: all 0.3s ease; }
    .album-title { font-size:.98rem; font-weight: bold; margin-bottom: 0.4rem; transition: all 0.3s ease; }
    .album-artist { font-size: .9rem; color: #b3b3b3; transition: all 0.3s ease; }

    /* Contenedor principal de la barra de navegación */
    .bottom-nav {
        position: fixed;
        left: 0;
        right: 0;
        bottom: 20px;
        background: #181818;
        border-top: 1px solid #272727;
        display: flex;
        height: 64px;
        z-index: 5000;
        transition: all 0.3s ease;
    }

    /* Estilo para cada elemento/botón de la barra */
    .bottom-nav-item {
        color: #b3b3b3;         /* Color del texto e ícono */
        text-align: center;
        flex: 1;                /* Distribuye el espacio equitativamente */
        font-size: 1.14rem;
        padding: 4px 0 0 0;
        border-radius: 7px;
        cursor: pointer;
        display: flex;
        flex-direction: column; /* Apila el ícono sobre el texto */
        align-items: center;
        transition: all 0.3s ease;
    }

    /* Estilo para el elemento activo (la sección actual) */
    .bottom-nav-item.active {
        color: #1DB954;                        /* Color verde distintivo */
        background: rgba(29, 185, 84, .09); /* Un fondo verde muy sutil */
    }

    /* Efecto al pasar el mouse sobre un elemento */
    .bottom-nav-item:hover {
        background: rgba(255, 255, 255, 0.05); /* Un ligero fondo blanco */
    }

    /* Estilo específico para el ícono dentro del botón */
    .bottom-nav-item .icon {
        font-size: 1.12rem;
    }

    /* Estilo para el texto pequeño debajo del ícono */
    .bottom-nav-item small {
        font-size: 0.67rem;
    }

    /* Estilo base para el ícono de descarga */
    .download-icon {
        cursor: pointer;      /* Muestra una mano al pasar el mouse */
        color: #666;          /* Color gris por defecto */
        font-size: 1.2rem;    /* Tamaño del ícono */
    }

    /* Estilo para el ícono CUANDO la canción ya está descargada */
    .download-icon.downloaded {
        color: #1DB954;      /* Cambia el color a verde */
    }

    .content-section { display: none; }
    .content-section.active { display: block; }
    .copyright { position: fixed; bottom: 0; left: 0; width: 100%; height: 20px; background: #0a0a0a; color: #666; font-size: 0.7rem; text-align: center; padding: 2px 0; z-index: 10000; border-top: 1px solid #222; }
    .empty-state{text-align:center;padding:3rem;color:#666;background:#333;border-radius:12px}
    .modal { position: fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,.80); display:none; align-items:center; justify-content:center; z-index:2000; transition: all 0.3s ease;}
    .modal.show{display:flex;}
    .modal-content { background:#282828; padding:2rem; border-radius:8px; width:95%; max-width:430px; max-height:90vh; overflow-y:auto; transition: all 0.3s ease; position:relative; }
    .form-group { margin-bottom:1rem;}
    .form-group label { display:block; margin-bottom:0.5rem;}
    .form-group input { width:100%; padding:.7rem; background:#404040; border:1px solid #555; border-radius:4px; color:#fff; transition: all 0.3s ease;}
    .btn-primary { background:#1DB954; color:#fff; border:none; padding:.7rem 1.5rem; border-radius:999px; cursor:pointer; width:100%; margin-top:.7rem; transition: all 0.3s ease; }
    .btn-primary:hover { background:#1ed760; }
    .btn-danger { background:#e22134; color:#fff; border:none; padding:.5rem 1rem; border-radius:4px; cursor:pointer; transition: all 0.3s ease; }
    .btn{background:#1DB954;color:#fff;border:none;padding:.7rem 1.5rem;border-radius:8px;cursor:pointer;transition:all 0.3s ease;}
    .btn.secondary{background:#555;}
    .close-modal { position:absolute; top:1rem; right:1rem; background:none; border:none; color:#fff; font-size:1.2rem; cursor:pointer;}
    .user-info { display: none; }

    /* Status y elementos específicos de KLMZ */
    .status{padding:1.5rem;border-radius:12px;font-family:monospace;margin:2rem 0;border-left:4px solid #1DB954}
    .status.success{background:#1a2e1a;color:#51cf66;border-left-color:#51cf66}
    .status.error{background:#2d1517;color:#ff6b6b;border-left-color:#ff6b6b}
    .status.info{background:#1e2833;color:#74c0fc;border-left-color:#74c0fc}
    .status.admin{background:#1DB954;color:#fff;border-left-color:#fff;font-weight:bold}
    .admin-badge{background:linear-gradient(45deg,#1DB954,#1ed760);color:#fff;padding:0.25rem 0.75rem;border-radius:20px;font-size:0.8rem;font-weight:bold;margin-left:0.5rem}
    .admin-panel{display:none;background:#242424;border-radius:12px;padding:2rem;margin:2rem 0;border:2px solid #1DB954}
    .admin-panel.show{display:block}
    .test-buttons{display:flex;gap:1rem;margin-top:2rem;flex-wrap:wrap}

    /* ✅ TEMAS VISUALES */
    body.theme-neon { background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 70%, #0a0a0a 100%) !important; color: #00ff88 !important; }
    body.theme-neon .bottom-nav { background: linear-gradient(180deg, rgba(26,26,46,0.95), rgba(10,10,10,0.95)) !important; border-top: 2px solid #00ff88 !important; }
    body.theme-neon .bottom-nav-item.active { color: #00ff88 !important; background: rgba(0,255,136,0.15) !important; }
    body.theme-minimal { background: linear-gradient(135deg, #0f0f0f 0%, #1c1c1c 50%, #2a2a2a 70%, #0f0f0f 100%) !important; color: #f5f5f5 !important; }
    body.theme-minimal .bottom-nav { background: rgba(28,28,28,0.95) !important; }
    body.theme-minimal .bottom-nav-item.active { color: #f5f5f5 !important; background: rgba(245,245,245,0.08) !important; }
    body.theme-sunset { background: linear-gradient(135deg, #2c1810 0%, #4a2c2a 30%, #6d4c41 60%, #1a1a1a 100%) !important; color: #ffab91 !important; }
    body.theme-sunset .bottom-nav-item.active { color: #ff8a65 !important; background: rgba(255,138,101,0.15) !important; }
    body.theme-pastel { background: linear-gradient(135deg, #1a1625 0%, #2d2438 50%, #3d2f47 70%, #4a3b5c 100%) !important; color: #d4c5f9 !important; }
    body.theme-pastel .bottom-nav-item.active { color: #d4c5f9 !important; background: rgba(184,169,232,0.15) !important; }
    body.theme-luxury { background: linear-gradient(135deg, #0f1419 0%, #1a252f 50%, #2c3e50 70%, #34495e 100%) !important; color: #f0f8ff !important; }
    body.theme-luxury .bottom-nav-item.active { color: #d4af37 !important; background: rgba(212,175,55,0.15) !important; }
    body.theme-oceanic { background: linear-gradient(135deg, #0a192f 0%, #173a5e 50%, #3b6978 70%, #84a9ac 100%) !important; color: #e0e0e0 !important; }
    body.theme-oceanic .bottom-nav-item.active { color: #98ded9 !important; background: rgba(152, 222, 217, 0.1) !important; }

    @media (max-width: 768px) { .album-img { width: 80px; height: 80px; } }
  </style>
</head>

<body>
  <header>
    <span class="logo">🎵 KLMZ MUSIC</span>
    <div class="user-actions">
      <div class="theme-selector">
        <label>Tema:</label>
        <select id="themeSelect">
          <option value="">Spotify</option>
          <option value="theme-neon">⚡ Neon</option>
          <option value="theme-minimal">✨ Minimal</option>
          <option value="theme-sunset">🌅 Sunset</option>
          <option value="theme-pastel">🌸 Pastel</option>
          <option value="theme-luxury">💎 Luxury</option>
          <option value="theme-oceanic">🌊 Oceanic</option>
        </select>
      </div>
      <div id="userInfo" class="user-info">
        <span id="userName"></span>
        <button class="btn-danger" onclick="logout()">Salir</button>
      </div>
      <div id="lockIcon" class="lock-icon">🔒</div>
    </div>
  </header>

  <div class="app-container">
    <main>
      <!-- Sección Inicio -->
      <div id="homeSection" class="content-section active">
        <h1 class="section-title">Álbumes</h1>
        <div id="status" class="status info">🔄 Inicializando conexión directa...</div>
        
        <!-- Botones admin - OCULTOS para visitantes públicos -->
        <div class="test-buttons" id="adminButtons" style="display:none;">
          <button class="btn" onclick="testConnection()">🔍 Probar Conexión</button>
          <button class="btn secondary" onclick="addTestAlbum()">➕ Agregar Álbum de Prueba</button>
          <button class="btn secondary" onclick="loadAlbums()">📀 Cargar Álbumes</button>
        </div>
        
        <div id="albums" class="album-grid"></div>
      </div>

      <!-- Sección Buscar -->
      <div id="searchSection" class="content-section">
        <h1 class="section-title">Buscar</h1>
        <input type="text" id="searchInput" placeholder="🔍 Buscar álbumes, artistas..." style="width:100%;padding:1rem;background:#242424;border:1px solid #555;border-radius:8px;color:#fff;margin-bottom:2rem;font-size:1rem;">
        <div id="searchResults" class="album-grid">
          <div class="empty-state">
            <h2>🔍 Buscar música</h2>
            <p>Escribe el nombre de un álbum o artista para buscar.</p>
          </div>
        </div>
      </div>

      <!-- Sección Biblioteca -->
      <div id="librarySection" class="content-section">
        <h1 class="section-title">Mi Biblioteca</h1>
        <div class="empty-state">
          <h2>📚 Tu Biblioteca</h2>
          <p>Aquí aparecerán tus álbumes favoritos y música guardada.</p>
        </div>
      </div>

      <!-- Sección Perfil -->
      <div id="profileSection" class="content-section">
        <h1 class="section-title">Perfil</h1>
        <div style="text-align:center;padding:2rem;">
          <div id="profileContent">
            <div class="empty-state">
              <h2>👤 Mi Perfil</h2>
              <p>Inicia sesión para ver tu perfil y configuración.</p>
              <button class="btn-primary" onclick="openAuthModal()" style="width:auto;margin-top:1rem;padding:0.8rem 2rem;">Iniciar Sesión</button>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Navegación inferior -->
  <div class="bottom-nav">
    <div class="bottom-nav-item active" data-section="home">
      <div class="icon">🏠</div>
      <small>Inicio</small>
    </div>
    <div class="bottom-nav-item" data-section="search">
      <div class="icon">🔍</div>
      <small>Buscar</small>
    </div>
    <div class="bottom-nav-item" data-section="library">
      <div class="icon">📚</div>
      <small>Biblioteca</small>
    </div>
    <div class="bottom-nav-item" data-section="profile">
      <div class="icon">👤</div>
      <small>Perfil</small>
    </div>
  </div>

  <div class="copyright">© 2025 KLMZ MUSIC - Powered by Appwrite</div>

  <!-- Modal de autenticación -->
  <div id="authModal" class="modal">
    <div class="modal-content">
      <button class="close-modal" onclick="closeAuthModal()">&times;</button>
      <h2 id="modalTitle">Iniciar Sesión</h2>
      
      <form id="authForm" onsubmit="handleAuth(event)">
        <div class="form-group">
          <label for="email">Email:</label>
          <input type="email" id="email" required>
        </div>
        
        <div class="form-group">
          <label for="password">Contraseña:</label>
          <input type="password" id="password" required>
        </div>
        
        <div id="nameGroup" class="form-group" style="display:none">
          <label for="name">Nombre:</label>
          <input type="text" id="name">
        </div>
        
        <button type="submit" class="btn-primary" id="authSubmitBtn">Iniciar Sesión</button>
      </form>
      
      <p><span id="toggleText">¿No tienes cuenta?</span>
      <a href="#" onclick="toggleAuthMode()" id="toggleBtn">Registrarse</a></p>
    </div>
  </div>

  <script>
    // Variables globales
    const CONFIG = {
      endpoint: 'https://nyc.cloud.appwrite.io/v1',
      projectId: '68ab0cf2000365979a71',
      databaseId: '68ab0d9b00124af501a5',
      albumsCollectionId: '68ab0dd00024ddeb51fd',
      songsCollectionId: '68ab0f0e002d9f334b0d',
      bucketId: '68ab1101001cff947e6b'
    };

    const $ = id => document.getElementById(id);
    let isLoginMode = true;
    let currentUser = null;
    let isAdmin = false;
    let currentAlbums = [];

    function setStatus(message, type = 'info') {
      const emoji = type === 'error' ? '❌' : type === 'success' ? '✅' : type === 'admin' ? '👑' : '🔄';
      $('status').innerHTML = `${emoji} ${message}`;
      $('status').className = `status ${type}`;
    }

    // ✅ FUNCIÓN DE NAVEGACIÓN (CORREGIDA)
    function showSection(section) {
      console.log('Cambiando a sección:', section);
      
      // Ocultar todas las secciones
      document.querySelectorAll('.content-section').forEach(sec => {
        sec.classList.remove('active');
      });
      
      // Mostrar sección seleccionada
      const targetSection = document.getElementById(section + 'Section');
      if (targetSection) {
        targetSection.classList.add('active');
      }
      
      // Actualizar navegación
      document.querySelectorAll('.bottom-nav-item').forEach(item => {
        item.classList.remove('active');
      });
      
      const activeNavItem = document.querySelector(`[data-section="${section}"]`);
      if (activeNavItem) {
        activeNavItem.classList.add('active');
      }

      // Acciones específicas
      if (section === 'home') {
        loadAlbums();
      } else if (section === 'search') {
        setTimeout(() => {
          const searchInput = document.getElementById('searchInput');
          if (searchInput) searchInput.focus();
        }, 100);
      }
    }

    // ✅ FUNCIÓN CAMBIAR TEMA
    function changeTheme(theme) {
      const themes = ['theme-neon', 'theme-minimal', 'theme-sunset', 'theme-pastel', 'theme-luxury', 'theme-oceanic'];
      themes.forEach(t => document.body.classList.remove(t));
      
      if (theme) {
        document.body.classList.add(theme);
        localStorage.setItem('klmzTheme', theme);
      } else {
        localStorage.removeItem('klmzTheme');
      }
    }

    // ✅ CLIENTE APPWRITE SIMPLIFICADO
    class SimpleAppwriteClient {
      constructor(endpoint, projectId) {
        this.endpoint = endpoint;
        this.projectId = projectId;
        this.headers = {
          'X-Appwrite-Project': projectId,
          'Content-Type': 'application/json'
        };
      }

      async request(method, path, params = {}) {
        let url = `${this.endpoint}${path}`;
        const options = {
          method,
          headers: { ...this.headers },
          credentials: 'include'
        };

        if (method === 'GET' && Object.keys(params).length > 0) {
          const queryString = new URLSearchParams(params).toString();
          url = `${url}?${queryString}`;
        } else if (method !== 'GET') {
          options.body = JSON.stringify(params);
        }

        const response = await fetch(url, options);

        if (response.status === 204) {
          return { success: true };
        }

        const text = await response.text();
        if (!text) {
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          return { success: true };
        }

        const data = JSON.parse(text);
        if (!response.ok) {
          throw new Error(data.message || `HTTP ${response.status}`);
        }

        return data;
      }

      async getAccount() {
        return this.request('GET', '/account');
      }

      async createSession(email, password) {
        return this.request('POST', '/account/sessions/email', { email, password });
      }

      async deleteSession() {
        return this.request('DELETE', '/account/sessions/current');
      }

      async listDocuments(databaseId, collectionId) {
        return this.request('GET', `/databases/${databaseId}/collections/${collectionId}/documents`);
      }

      async createDocument(databaseId, collectionId, documentId, data, permissions = []) {
        return this.request('POST', `/databases/${databaseId}/collections/${collectionId}/documents`, {
          documentId,
          data,
          permissions
        });
      }
    }

    const client = new SimpleAppwriteClient(CONFIG.endpoint, CONFIG.projectId);

    // ✅ FUNCIONES BÁSICAS
    async function testConnection() {
      setStatus('Probando conexión...');
      try {
        const user = await client.getAccount();
        currentUser = user;
        isAdmin = user.email === 'klmzr230@gmail.com';
        setStatus(`✅ Conectado como: ${user.name}`, isAdmin ? 'admin' : 'success');
        
        if (isAdmin) {
          $('adminButtons').style.display = 'flex';
          $('lockIcon').textContent = '👑';
        }
      } catch (error) {
        setStatus('✅ Conectado como visitante - CORS OK', 'success');
      }
    }

    async function loadAlbums() {
      setStatus('Cargando álbumes...');
      try {
        const response = await client.listDocuments(CONFIG.databaseId, CONFIG.albumsCollectionId);
        currentAlbums = response.documents || [];
        
        if (currentAlbums.length === 0) {
          $('albums').innerHTML = `
            <div class="empty-state">
              <h2>🎵 Conexión exitosa</h2>
              <p>No hay álbumes disponibles.</p>
            </div>
          `;
        } else {
          displayAlbums(currentAlbums);
        }
        setStatus(`✅ ${currentAlbums.length} álbum(es) cargados`, 'success');
      } catch (error) {
        setStatus(`❌ Error: ${error.message}`, 'error');
      }
    }

    function displayAlbums(albums) {
      $('albums').innerHTML = albums.map(album => `
        <div class="album-card">
          <div class="album-img" style="background:linear-gradient(135deg, #1DB954, #1ed760);display:flex;align-items:center;justify-content:center;font-size:2rem;color:white;">🎵</div>
          <div class="album-title">${album.name}</div>
          <div class="album-artist">${album.artistName}</div>
        </div>
      `).join('');
    }

    async function addTestAlbum() {
      if (!currentUser) {
        setStatus('Inicia sesión primero', 'error');
        return;
      }

      try {
        const albumData = {
          name: `Álbum Test - ${new Date().toLocaleTimeString()}`,
          artistName: isAdmin ? 'Admin Test' : 'Usuario Test'
        };

        const permissions = [
          'read("any()")',
          `write("user(${currentUser.$id})")`,
          `delete("user(${currentUser.$id})")`
        ];

        await client.createDocument(
          CONFIG.databaseId,
          CONFIG.albumsCollectionId,
          'album-' + Date.now(),
          albumData,
          permissions
        );

        setStatus('✅ Álbum creado correctamente', 'success');
        setTimeout(loadAlbums, 1000);
      } catch (error) {
        setStatus(`❌ Error: ${error.message}`, 'error');
      }
    }

    // ✅ AUTH FUNCTIONS
    function openAuthModal() {
      $('authModal').classList.add('show');
    }

    function closeAuthModal() {
      $('authModal').classList.remove('show');
    }

    function toggleAuthMode() {
      isLoginMode = !isLoginMode;
      
      if (isLoginMode) {
        $('modalTitle').textContent = 'Iniciar Sesión';
        $('authSubmitBtn').textContent = 'Iniciar Sesión';
        $('toggleText').textContent = '¿No tienes cuenta?';
        $('toggleBtn').textContent = 'Registrarse';
        $('nameGroup').style.display = 'none';
      } else {
        $('modalTitle').textContent = 'Crear Cuenta';
        $('authSubmitBtn').textContent = 'Registrarse';
        $('toggleText').textContent = '¿Ya tienes cuenta?';
        $('toggleBtn').textContent = 'Iniciar Sesión';
        $('nameGroup').style.display = 'block';
      }
    }

    async function handleAuth(event) {
      event.preventDefault();
      const email = $('email').value;
      const password = $('password').value;

      try {
        await client.createSession(email, password);
        const user = await client.getAccount();
        currentUser = user;
        isAdmin = user.email === 'klmzr230@gmail.com';
        
        closeAuthModal();
        setStatus(`¡Bienvenido ${user.name}!`, isAdmin ? 'admin' : 'success');
        
        if (isAdmin) {
          $('adminButtons').style.display = 'flex';
          $('lockIcon').textContent = '👑';
        }
      } catch (error) {
        setStatus(`Error: ${error.message}`, 'error');
      }
    }

    async function logout() {
      try {
        await client.deleteSession();
        currentUser = null;
        isAdmin = false;
        $('lockIcon').textContent = '🔒';
        $('adminButtons').style.display = 'none';
        setStatus('Sesión cerrada', 'success');
      } catch (error) {
        setStatus(`Error: ${error.message}`, 'error');
      }
    }

    // ✅ SEARCH FUNCTION
    function performSearch() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
      const searchResults = document.getElementById('searchResults');
      
      if (!searchTerm) {
        searchResults.innerHTML = '<div class="empty-state"><h2>🔍 Buscar música</h2><p>Escribe para buscar.</p></div>';
        return;
      }
      
      const filteredAlbums = currentAlbums.filter(album => 
        album.name.toLowerCase().includes(searchTerm) || 
        album.artistName.toLowerCase().includes(searchTerm)
      );
      
      if (filteredAlbums.length === 0) {
        searchResults.innerHTML = `<div class="empty-state"><h2>🔍 Sin resultados</h2><p>No encontrado: "${searchTerm}"</p></div>`;
      } else {
        searchResults.innerHTML = filteredAlbums.map(album => `
          <div class="album-card">
            <div class="album-img" style="background:linear-gradient(135deg, #1DB954, #1ed760);display:flex;align-items:center;justify-content:center;font-size:2rem;color:white;">🎵</div>
            <div class="album-title">${album.name}</div>
            <div class="album-artist">${album.artistName}</div>
          </div>
        `).join('');
      }
    }

    // ✅ INICIALIZACIÓN (CORREGIDA)
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM cargado, inicializando...');

      // Cargar tema guardado
      const savedTheme = localStorage.getItem('klmzTheme');
      if (savedTheme) {
        document.body.classList.add(savedTheme);
        $('themeSelect').value = savedTheme;
      }

      // Event listeners para navegación
      document.querySelectorAll('.bottom-nav-item').forEach(item => {
        item.addEventListener('click', function(e) {
          e.preventDefault();
          const section = this.getAttribute('data-section');
          showSection(section);
        });
      });

      // Event listener para tema
      $('themeSelect').addEventListener('change', function() {
        changeTheme(this.value);
      });

      // Event listener para búsqueda
      const searchInput = document.getElementById('searchInput');
      if (searchInput) {
        searchInput.addEventListener('input', performSearch);
      }

      // Event listener para auth icon
      $('lockIcon').addEventListener('click', openAuthModal);

      // Inicialización automática
      setTimeout(() => {
        testConnection();
        loadAlbums();
      }, 500);

      console.log('Inicialización completa');
    });

    // Cerrar modal al hacer clic fuera
    window.addEventListener('click', function(event) {
      if (event.target === $('authModal')) {
        closeAuthModal();
      }
    });
  </script>
</body>
</html>
