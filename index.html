<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>KLMZ MUSIC</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <!-- SDK Appwrite (debe ir antes de tu c√≥digo) -->
  <script src="https://cdn.jsdelivr.net/npm/appwrite@13/dist/appwrite.umd.js"></script>

  <style>
  /* ‚Äî‚Äî estilos b√°sicos ‚Äî‚Äî */
  *{box-sizing:border-box}
  body{margin:0;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#181818;color:#fff;padding-bottom:84px}
  header{background:#121212;padding:1rem 1.5rem;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100}
  .logo{font-weight:700;font-size:1.4rem}
  .lock-icon{font-size:1.4rem;cursor:pointer}
  .section-title{font-size:1.8rem;font-weight:700;margin:1.5rem 0}
  .album-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:1.5rem}
  .album-card{text-align:center;cursor:pointer}
  .album-img{border-radius:50%;width:100px;height:100px;object-fit:cover;margin-bottom:.7rem;background:#333}
  .loading{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,.9);color:#fff;padding:1.5rem 2.5rem;border-radius:12px;border:2px solid #1DB954}
  </style>
</head>

<body>
  <header>
    <span class="logo">KLMZ MUSIC</span>
    <div id="header-lock-icon" class="lock-icon">üîí</div>
  </header>

  <main>
    <h2 class="section-title">√Ålbumes</h2>
    <div id="albums" class="album-grid">Cargando‚Ä¶</div>
  </main>

  <div id="loader" class="loading" hidden>Cargando‚Ä¶</div>
  <audio id="audio"></audio>

  <!-- ‚Äî‚Äî L√≥gica JS ‚Äî‚Äî -->
  <script>
    /* ==== utilidades DOM ==== */
    const $    = id => document.getElementById(id);
    const show = el => el.hidden = false;
    const hide = el => el.hidden = true;

    /* ==== configuraci√≥n Appwrite ==== */
    const { Client, Databases, Account, Storage } = Appwrite;

    const client = new Client()
      .setEndpoint('https://nyc.cloud.appwrite.io/v1')     // endpoint del proyecto
      .setProject('68aa8307001f723f5518');                 // Project-ID

    const account = new Account(client);
    const db      = new Databases(client);
    const bucket  = new Storage(client);

    const DB_ID   = '68aa8566002832b4c093';
    const COL_ALB = '68aa85730036dd283cc9';
    const BUCKET  = '68aa8cc5003a2c336a1f';

    /* ==== carga de √°lbumes ==== */
    async function loadAlbums () {
      show($('loader'));
      try {
        const { documents } = await db.listDocuments(DB_ID, COL_ALB);
        $('albums').innerHTML = documents.map(a => `
          <div class="album-card">
            <img class="album-img" src="\${bucket.getFilePreview(BUCKET, a.coverStorageId)}" alt="\${a.name}">
            <div>\${a.name}</div>
          </div>`).join('');
      } catch {
        $('albums').textContent = 'Error al cargar √°lbumes';
      }
      hide($('loader'));
    }

    /* ==== inicio ==== */
    document.addEventListener('DOMContentLoaded', () => {
      // comprobaci√≥n r√°pida de CORS: debe devolver 401 sin bloqueo
      account.get()
        .then(u => console.log('Sesi√≥n activa de', u.email))
        .catch(() => console.log('Visitante sin sesi√≥n ‚Äî CORS OK'));

      loadAlbums();
    });
  </script>
</body>
</html>
