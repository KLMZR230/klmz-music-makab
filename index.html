<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>KLMZ MUSIC</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#1DB954">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Metal+Mania&display=swap');
        * { box-sizing: border-box; }
        body { margin: 0; font-family: -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif; background: #181818; color: #fff; padding-bottom: 84px; transition: all 0.3s ease; }
        header { background: #121212; padding: 1rem 1.5rem; display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 100; transition: all 0.3s ease; }
        .logo { font-weight: bold; font-size: 1.4rem; letter-spacing: 1px; transition: all 0.3s ease; }
        .user-actions { display:flex; align-items: center; gap:.5rem; }
        .lock-icon { cursor:pointer; font-size:1.4rem; color:#fff; user-select:none; transition: all 0.3s ease; }
        .lock-icon:hover { opacity:.7;}
        .theme-selector { display: flex; align-items: center; gap: 0.3rem; margin-right: 0.5rem; }
        .theme-selector label { font-size: 0.7rem; color: #b3b3b3; }
        .theme-selector select { background: #333; color: #fff; border: 1px solid #555; border-radius: 4px; padding: 0.1rem 0.2rem; font-size: 0.7rem; cursor: pointer; transition: all 0.3s ease; }
        .app-container { display: flex; min-height: calc(100vh - 60px);}
        main { flex:1; padding:1rem; max-width:900px; margin:0 auto;}
        #search-input { width: 100%; padding: 1rem; background: #242424; border: none; border-radius: 4px; color: #fff; margin-bottom: 2rem; transition: all 0.3s ease; }
        .section-title { font-size:1.8rem; font-weight:bold; margin-bottom:1.5rem; transition: all 0.3s ease; }
        .album-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(140px,1fr)); gap:1.5rem;}
        .album-card { background:none; padding:1rem; cursor:pointer; display:flex; flex-direction:column; align-items:center; text-align:center; transition: all 0.3s ease; border-radius: 12px; }
        .album-card:hover { transform:scale(1.05); box-shadow: 0 0 15px rgba(29, 185, 84, 0.4); }
        .album-img { border-radius:50%; width:100px; height:100px; object-fit:cover; margin-bottom:.7rem; background:#333; transition: all 0.3s ease; border: 3px solid #444; }
        .album-title { font-size:.98rem; font-weight: bold; margin-bottom: 0.4rem; transition: all 0.3s ease; }
        .album-artist { font-size: .9rem; color: #b3b3b3; transition: all 0.3s ease; }
        .album-detail-img { width: 200px; height: 200px; border-radius: 50%; object-fit: cover; margin: 0 auto 1.5rem; display: block; border: 4px solid #444; transition: all 0.3s ease; }
        .song-list { width:100%; margin-top:1rem; padding-bottom: 120px; }
        .song-list ul { list-style:none; padding:0; margin:0;}
        .song-list li { padding:.7rem; cursor:pointer; color:#1db954; border-bottom:1px solid #333; display:flex; justify-content:space-between; align-items:center; transition: all 0.3s ease; gap: 1rem;}
        .song-list li:hover { color:#fff; background: rgba(255,255,255,.05); transform: translateX(2px);}
        .song-list .song-info { flex-grow: 1; min-width: 0; }
        .song-list .song-title { font-weight: 500; display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .song-list .song-artist { color:#b3b3b3; font-size: 0.85rem; }
        .song-list li:hover .song-title { color: #1DB954; font-weight: 600; }
        .song-meta { display: flex; align-items: center; gap: 1.5rem; flex-shrink: 0;}
        .song-actions { display: flex; gap: 0.8rem; align-items: center; }
        .song-actions span { font-size: 1.2rem; cursor: pointer; color: #666; transition: all 0.3s ease; }
        .song-actions span:hover { color: #fff; transform: scale(1.1); }
        .play-icon { font-size: 1.1rem !important; }
        .playlist-item { background: #242424; padding: 1rem; margin-bottom: 0.8rem; border-radius: 8px; cursor: pointer; border-left: 3px solid #1DB954; transition: all 0.3s ease; display: flex; justify-content: space-between; align-items: center;}
        .playlist-item:hover { background: #333; border-left-color: #1ed760; }
        .playlist-info strong { font-size: 1.1rem; }
        .playlist-info small { font-size: 0.8rem; color: #b3b3b3; display: block; }
        .playlist-actions .delete-playlist { font-size: 1.2rem; color: #555; }
        .playlist-actions .delete-playlist:hover { color: #ff4757; }
        #add-to-playlist-modal ul { list-style: none; padding: 0; max-height: 40vh; overflow-y: auto; }
        #add-to-playlist-modal li { padding: 1rem; border-bottom: 1px solid #444; cursor: pointer; }
        #add-to-playlist-modal li:hover { background: #404040; color: #1DB954; }
        #add-to-playlist-modal li:last-child { border-bottom: none; }
        .modal-header { font-size: 1.2rem; font-weight: bold; margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid #444; }
        .player { position: fixed; bottom: 84px; left: 0; right: 0; background: #212121cc; border-top: 1px solid #282828; z-index: 300; display: flex; align-items: center; padding: 0.8rem 1.2rem; min-height: 56px; cursor: pointer; box-shadow: 0 -2px 10px #0002; transition: all 0.3s ease;}
        .player-img-mini { width:44px; height:44px; border-radius:100%; object-fit:cover; margin-right:1rem;}
        .player-info-mini { flex:1; overflow:hidden;}
        .player-title-mini { font-weight:bold; font-size:1rem; line-height:1.2;}
        .player-artist-mini { color:#b3b3b3; font-size:0.9rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
        .player-controls-inline { display:flex; align-items:center; gap:.5rem;}
        .play-btn-inline { background: none; color:#fff; border:none; font-size:1.8rem; cursor:pointer; transition: all 0.3s ease; padding: 0; }
        .play-btn-inline:hover { opacity: 0.7; }
        .full-player-backdrop { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.97); z-index:9999; align-items:center; justify-content:center; flex-direction:column; transition: all 0.3s ease;}
        .full-player-backdrop.active { display: flex;}
        .full-player-cover { width: 200px; height: 200px; border-radius: 12px; object-fit:cover; margin: 0 auto 2rem; display: block; transition: all 0.3s ease;}
        .full-player-title { font-size: 1.8rem; font-weight: bold; margin: 1rem 0 .5rem 0; text-align: center;}
        .full-player-artist { color: #b3b3b3; font-size: 1.1rem; margin-bottom: 2rem; text-align: center;}
        .full-player-controls { display: flex; flex-direction: column; align-items: center; gap: 1.5rem; width: 100%; }
        .full-control-buttons { display: flex; gap: 3rem; align-items: center; }
        .full-control-btn { background: none; border: none; color: #fff; font-size: 2.2rem; padding: 0; cursor: pointer; transition: all 0.3s ease; }
        .full-control-btn:hover { color: #1DB954; }
        .full-play-btn { font-size: 3.5rem; }
        .full-play-btn:hover { transform: scale(1.1); color: #1DB954; }
        .mode-controls { display: flex; gap: 1rem; margin-top: 1rem; justify-content: center; }
        .mode-btn { background: none; border: 1px solid #444; color: #b3b3b3; padding: 0.5rem; border-radius: 50%; cursor: pointer; font-size: 1.2rem; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; }
        .mode-btn:hover { color: #fff; border-color: #666; }
        .mode-btn.active { color: #1DB954; border-color: #1DB954; background: rgba(29,185,84,0.1); }
        .full-progress-bar { flex: 1; height: 8px; background: #4f4f4f; border-radius: 4px; cursor: pointer; position: relative;}
        .full-progress-fill { height: 100%; background: #1DB954; border-radius: 4px; width: 0%; position: absolute; top: 0; left: 0; transition: all 0.3s ease;}
        .full-progress-container { width: 90%; max-width: 400px; display: flex; align-items: center; gap: 1rem;}
        .full-progress-time { font-size: 1rem; color: #b3b3b3; min-width: 50px;}
        .full-player-volume { margin-top: 1rem;}
        .full-volume-slider { width: 150px; }
        .full-player-close { position: absolute; top: 30px; right: 40px; background: none; border: none; font-size: 2.5rem; color: #fff; cursor: pointer; transition: all 0.3s ease; }
        .full-player-close:hover { color: #ff4757; }
        .modal { position: fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,.80); display:none; align-items:center; justify-content:center; z-index:2000; transition: all 0.3s ease;}
        .modal-content { background:#282828; padding:2rem; border-radius:8px; width:95%; max-width:430px; max-height:90vh; overflow-y:auto; transition: all 0.3s ease; }
        .modal-content p a { color: #1DB954; text-decoration: none; }
        .modal-content p { text-align: center; margin-top: 1rem; }
        .form-group { margin-bottom:1rem;}
        .form-group label { display:block; margin-bottom:0.5rem;}
        .form-group input, .form-group select { width:100%; padding:.7rem; background:#404040; border:1px solid #555; border-radius:4px; color:#fff; transition: all 0.3s ease;}
        .btn-primary { background:#1DB954; color:#fff; border:none; padding:.7rem 1.5rem; border-radius:999px; cursor:pointer; width:100%; margin-top:.7rem; transition: all 0.3s ease; }
        .btn-primary:hover { background:#1ed760; }
        .btn-danger { background:#e22134; color:#fff; border:none; padding:.5rem 1rem; border-radius:4px; cursor:pointer; transition: all 0.3s ease; }
        .btn-danger:hover { background:#ff4757; }
        .close-modal { position:absolute; top:1rem; right:1rem; background:none; border:none; color:#fff; font-size:1.2rem; cursor:pointer;}
        .user-menu { position: relative; display: inline-block; }
        .user-dropdown { display: none; position: absolute; right: 0; top: calc(100% + 10px); background: #282828; min-width: 200px; border-radius: 8px; box-shadow: 0 8px 32px rgba(0,0,0,0.4); z-index: 1000; border: 1px solid #404040; transition: all 0.3s ease; }
        .user-dropdown.show { display: block; animation: dropdownFadeIn 0.2s ease; }
        .user-dropdown-item { padding: 0.8rem 1rem; cursor: pointer; border-bottom: 1px solid #404040; display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; transition: all 0.3s ease; }
        .user-dropdown-item:last-child { border-bottom: none; }
        .user-dropdown-item:hover { background: #404040; }
        .user-dropdown-item.logout { color: #ff4757; border-top: 1px solid #404040; margin-top: 0.3rem; }
        .user-info { padding: 0.8rem 1rem; border-bottom: 2px solid #404040; font-size: 0.85rem; color: #b3b3b3; }
        .user-info strong { color: #fff; font-size: 0.9rem; }
        .bottom-nav { position: fixed; left: 0; right: 0; bottom: 20px; background: #181818; border-top: 1px solid #272727; display: flex; height: 64px; z-index: 5000; transition: all 0.3s ease; }
        .bottom-nav-item { color: #b3b3b3; text-align: center; flex: 1; font-size: 1.14rem; padding: 4px 0 0 0; border-radius: 7px; cursor: pointer; display: flex; flex-direction: column; align-items: center; transition: all 0.3s ease;}
        .bottom-nav-item.active { color: #1DB954; background: rgba(29,185,84,.09);}
        .bottom-nav-item:hover {background:rgba(255,255,255,0.05);}
        .bottom-nav-item .icon { font-size: 1.12rem; }
        .bottom-nav-item small { font-size: 0.67rem;}
        .content-section { display: none; }
        .content-section.active { display: block; }
        .back-btn { margin-bottom: 1.2rem; background: #222; color: #fff; border: none; padding: 0.5rem 1.5rem; border-radius: 999px; cursor: pointer; transition: all 0.3s ease; }
        .back-btn:hover { background: #333; }
        .copyright { position: fixed; bottom: 0; left: 0; width: 100%; height: 20px; background: #0a0a0a; color: #666; font-size: 0.7rem; text-align: center; padding: 2px 0; z-index: 10000; border-top: 1px solid #222; }
        .loading-indicator { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.9); color: #fff; padding: 1.5rem 2.5rem; border-radius: 12px; font-size: 1rem; z-index: 2000; border: 2px solid #1DB954; }
        
        /* --- ESTILOS DE BÚSQUEDA --- */
        .search-song-item, .search-album-item { background: #242424; padding: 0.8rem; margin-bottom: 0.8rem; border-radius: 8px; cursor: pointer; display: flex; align-items: center; transition: all 0.3s ease; }
        .search-song-item:hover, .search-album-item:hover { background: #333; }
        .search-song-info, .search-album-info { flex: 1; }
        .search-song-title, .search-album-title { font-weight: bold; margin-bottom: 0.2rem; }
        .search-song-artist, .search-album-artist { font-size: 0.9rem; color: #b3b3b3; }
        .search-album-img { width: 50px; height: 50px; border-radius: 8px; margin-right: 1rem; object-fit: cover; background: #333; }
        #search-results h3 { margin-top: 1.5rem; margin-bottom: 1rem; border-bottom: 1px solid #444; padding-bottom: 0.5rem; }
        
        .favorites-list, .downloads-list { margin-top: 1rem; }
        .favorite-item, .download-item { background: #242424; padding: 1rem; margin-bottom: 0.8rem; border-radius: 8px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; border-left: 3px solid #1DB954; transition: all 0.3s ease; }
        .favorite-item:hover, .download-item:hover { background: #333; }
        .favorite-info, .download-info { flex: 1; }
        .favorite-title, .download-title { font-weight: bold; margin-bottom: 0.3rem; color: #fff; }
        .favorite-artist, .download-artist { font-size: 0.9rem; color: #b3b3b3; }
        .download-item-actions { display: flex; gap: 0.5rem; align-items: center; }
        .delete-download { cursor: pointer; color: #ff4757; font-size: 1rem; transition: all 0.3s ease; }
        .delete-download:hover { transform: scale(1.2); }
        #album-detail, #playlist-detail { padding-bottom: 120px; }
        .admin-section { margin-bottom: 2.5rem; background: #242424; padding: 1.5rem; border-radius: 8px; border-left: 4px solid #1DB954; }
        .admin-section h3 { margin-top: 0; border-bottom: 2px solid #1DB954; padding-bottom: 0.8rem; margin-bottom: 1.5rem; color: #1DB954; display: flex; align-items: center; gap: 0.5rem; }
        .admin-form { margin-bottom: 2rem; }
        .admin-form input[type="file"] { background: #333; border: 2px dashed #1DB954; padding: 1rem; border-radius: 8px; text-align: center; cursor: pointer; }
        .admin-form input[type="file"]:hover { background: #404040; }
        .btn-secondary { background: #555; color: #fff; border: none; padding: .7rem 1.5rem; border-radius: 999px; cursor: pointer; transition: all 0.3s ease; margin-right: 0.5rem; }
        .btn-secondary:hover { background: #666; }
        .admin-album-item { background: #2c2c2c; border-radius: 8px; margin-bottom: 1.5rem; border-left: 3px solid #1DB954; overflow: hidden; }
        .admin-album-header { display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #333; }
        .admin-item-info { flex: 1; }
        .admin-item-info strong { color: #1DB954; font-size: 1.1rem; }
        .admin-item-info small { color: #b3b3b3; display: block; margin-top: 0.3rem; }
        .admin-item-actions button { margin-left: 0.5rem; padding: 0.4rem 0.8rem; font-size: 0.85rem; }
        .admin-song-list { padding: 0.5rem 1rem 1rem; }
        .admin-song-item { display: flex; justify-content: space-between; align-items: center; padding: 0.8rem; border-bottom: 1px solid #404040; }
        .admin-song-item:last-child { border-bottom: none; }
        .admin-song-actions button { margin-left: 0.5rem; padding: 0.3rem 0.6rem; font-size: 0.8rem; }
        .no-songs { color: #888; padding: 1rem; text-align: center; font-style: italic; }
        .admin-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
        .stat-card { background: #333; padding: 1.5rem; border-radius: 8px; text-align: center; border-left: 4px solid #1DB954; }
        .stat-number { font-size: 2rem; font-weight: bold; color: #1DB954; }
        .stat-label { color: #b3b3b3; margin-top: 0.5rem; }
        .offline-indicator { background: #ff4757; color: white; padding: 0.3rem 0.8rem; border-radius: 12px; font-size: 0.8rem; margin-left: 0.5rem; }
        .multi-upload-section { background: rgba(29,185,84,0.1); border: 2px dashed #1DB954; border-radius: 8px; padding: 1.5rem; margin-bottom: 1.5rem; text-align: center; }
        .multi-upload-section h4 { color: #1DB954; margin-top: 0; }
        .file-queue { margin-top: 1rem; max-height: 200px; overflow-y: auto; }
        .file-queue-item { background: #333; padding: 0.8rem; margin-bottom: 0.5rem; border-radius: 4px; display: flex; justify-content: space-between; align-items: center; font-size: 0.9rem; }
        .file-queue-item.uploading { border-left: 3px solid #ff9800; }
        .file-queue-item.success { border-left: 3px solid #4caf50; }
        .file-queue-item.error { border-left: 3px solid #f44336; }
        .file-remove { color: #ff4757; cursor: pointer; font-size: 1.2rem; }
        .file-remove:hover { transform: scale(1.2); }
        .upload-progress-container { margin-top: 0.5rem; }
        .upload-progress-bar { background-color: #555; border-radius: 4px; height: 6px; overflow: hidden; }
        .upload-progress-fill { background-color: #1DB954; height: 100%; width: 0%; transition: width 0.2s ease-in-out; }
        .batch-upload-progress { margin-top: 1rem; }
        .batch-progress-bar { background: #444; height: 8px; border-radius: 4px; overflow: hidden; }
        .batch-progress-fill { background: #1DB954; height: 100%; width: 0%; transition: width 0.3s ease; }
        .hidden-badge { background: #555; color: #ccc; font-size: 0.7rem; padding: 2px 6px; border-radius: 8px; margin-left: 0.5rem; vertical-align: middle; font-weight: normal; }
        body.offline-mode { background: linear-gradient(135deg, #1a3d1a 0%, #0d2d0d 100%) !important; }
        body.offline-mode .section-title { color: #90ee90 !important; }
        body.offline-mode .download-item { background: #1a4d1a !important; border-left-color: #90ee90 !important; }
        body.offline-mode .bottom-nav { background: #0d2d0d !important; }
        body.offline-mode .offline-indicator { background: #ff9800 !important; animation: pulse 2s infinite; }

        /* TEMAS COMPLETOS */
        body.theme-default .album-img, body.theme-default .album-detail-img { border-color: #1DB954; }
        body.theme-fire .album-img, body.theme-fire .album-detail-img { border-color: #ff4500; }
        body.theme-fire { background: radial-gradient(ellipse at center, #3d0303 0%, #1a0000 70%) !important; color: #ffcc80 !important; }
        body.theme-fire .logo { font-family: 'Metal Mania', cursive !important; font-size: 1.8rem !important; color: #ff4500 !important; text-shadow: 0 0 5px #ff4500, 0 0 10px #ff4500, 0 0 20px #ff8c00, 0 0 40px #ff0000 !important; animation: logo-flicker 2s infinite linear alternate; }
        body.theme-fire .section-title { font-family: 'Metal Mania', cursive !important; color: #ff8c00 !important; }
        body.theme-fire header { background: rgba(10,0,0,0.8) !important; border-bottom: 2px solid #ff4500; }
        body.theme-fire .album-card:hover { animation: fire-glow 1.5s ease-in-out infinite alternate; }
        body.theme-fire .btn-primary { background: #ff4500 !important; color: #fff !important; }
        body.theme-fire .song-list li { color: #ff8c00 !important; }
        body.theme-fire .bottom-nav-item.active { color: #ff4500 !important; background: rgba(255, 69, 0, 0.2); }
        body.theme-neon .album-img, body.theme-neon .album-detail-img { border-color: #00ff88; }
        body.theme-neon { background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 70%, #0f0f23 100%) !important; color: #00ff88 !important; }
        body.theme-neon .logo { color: #00ff88 !important; text-shadow: 0 0 15px #00ff88, 0 0 30px #00ff88 !important; animation: neonPulse 2s ease-in-out infinite alternate !important; }
        body.theme-neon header { background: #0f0f23 !important; border-bottom: 1px solid #00ff88; }
        body.theme-neon .album-card:hover { box-shadow: 0 0 25px rgba(0,255,136,0.6) !important; }
        body.theme-neon .btn-primary { background: #00ff88 !important; color: #000 !important; }
        body.theme-neon .song-list li { color: #00ff88 !important; }
        body.theme-neon .bottom-nav-item.active { color: #00ff88 !important; }
        body.theme-minimal .album-img, body.theme-minimal .album-detail-img { border-color: #f5f5f5; }
        body.theme-minimal { background: linear-gradient(135deg, #0f0f0f 0%, #1c1c1c 50%, #2a2a2a 70%, #1a1a1a 100%) !important; color: #f5f5f5 !important; }
        body.theme-minimal header { background: #0f0f0f !important; border-bottom: 1px solid #333; }
        body.theme-minimal .album-card:hover { box-shadow: 0 0 20px rgba(245,245,245,0.4) !important; }
        body.theme-minimal .btn-primary { background: #f5f5f5 !important; color: #0f0f0f !important; }
        body.theme-minimal .song-list li { color: #f5f5f5 !important; }
        body.theme-minimal .bottom-nav-item.active { color: #f5f5f5 !important; }
        body.theme-sunset .album-img, body.theme-sunset .album-detail-img { border-color: #ff7043; }
        body.theme-sunset { background: linear-gradient(135deg, #2c1810 0%, #4a2c2a 30%, #6d4c41 60%, #1a1a1a 100%) !important; color: #ffab91 !important; }
        body.theme-sunset .logo { color: #ff7043 !important; text-shadow: 0 0 10px #ff7043; }
        body.theme-sunset .album-card:hover { box-shadow: 0 0 20px rgba(255, 112, 67, 0.6); }
        body.theme-sunset .btn-primary { background: #ff7043 !important; color: #fff !important; }
        body.theme-sunset .bottom-nav-item.active { color: #ff7043 !important; }
        body.theme-pastel .album-img, body.theme-pastel .album-detail-img { border-color: #bb86fc; }
        body.theme-pastel { background: linear-gradient(135deg, #1a1625 0%, #2d2438 50%, #3d2f47 70%, #4a3b5c 100%) !important; color: #d4c5f9 !important; }
        body.theme-pastel .logo { color: #bb86fc !important; text-shadow: 0 0 10px #bb86fc; }
        body.theme-pastel .album-card:hover { box-shadow: 0 0 20px rgba(187, 134, 252, 0.6); }
        body.theme-pastel .btn-primary { background: #bb86fc !important; color: #1a1625 !important; }
        body.theme-pastel .bottom-nav-item.active { color: #bb86fc !important; }
        body.theme-luxury .album-img, body.theme-luxury .album-detail-img { border-color: #3498db; }
        body.theme-luxury { background: linear-gradient(135deg, #0f1419 0%, #1a252f 50%, #2c3e50 70%, #34495e 100%) !important; color: #f0f8ff !important; }
        body.theme-luxury .logo { color: #3498db !important; text-shadow: 0 0 10px #3498db; }
        body.theme-luxury .album-card:hover { box-shadow: 0 0 20px rgba(52, 152, 219, 0.6); }
        body.theme-luxury .btn-primary { background: linear-gradient(45deg, #3498db, #2980b9) !important; color: #fff !important; }
        body.theme-luxury .bottom-nav-item.active { color: #3498db !important; }
        body.theme-oceanic .album-img, body.theme-oceanic .album-detail-img { border-color: #17a2b8; }
        body.theme-oceanic { background: linear-gradient(135deg, #0a192f 0%, #173a5e 50%, #3b6978 70%, #84a9ac 100%) !important; color: #e0e0e0 !important; }
        body.theme-oceanic .logo { color: #17a2b8 !important; text-shadow: 0 0 10px #17a2b8; }
        body.theme-oceanic .album-card:hover { box-shadow: 0 0 20px rgba(23, 162, 184, 0.6); }
        body.theme-oceanic .btn-primary { background: #17a2b8 !important; color: #fff !important; }
        body.theme-oceanic .bottom-nav-item.active { color: #17a2b8 !important; }
        body.theme-hacker .album-img, body.theme-hacker .album-detail-img { border-color: #39ff14; }
        body.theme-hacker { background: #000 !important; color: #39ff14 !important; font-family: 'Courier New', Courier, monospace !important; }
        body.theme-hacker .logo, body.theme-hacker .section-title { color: #39ff14 !important; text-shadow: 0 0 5px #39ff14, 0 0 10px #39ff14; }
        body.theme-hacker header { background: #050505 !important; border-bottom: 1px solid #39ff14; }
        body.theme-hacker .album-card:hover { box-shadow: 0 0 20px rgba(57, 255, 20, 0.7) !important; }
        body.theme-hacker .btn-primary { background: #39ff14 !important; color: #000 !important; font-weight: bold; }
        body.theme-hacker .song-list li { color: #39ff14 !important; }
        body.theme-hacker .bottom-nav-item.active { color: #39ff14 !important; background: rgba(57, 255, 20, 0.1); }
        body.theme-cyber .album-img, body.theme-cyber .album-detail-img { border-color: #ff00ff; }
        body.theme-cyber { background: linear-gradient(135deg, #0b0213 0%, #1d0f2b 100%) !important; color: #e0e0e0 !important; font-family: -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif !important; }
        body.theme-cyber .logo { color: #ff00ff !important; text-shadow: 0 0 8px #ff00ff; }
        body.theme-cyber header { background: rgba(11, 2, 19, 0.8) !important; backdrop-filter: blur(5px); border-bottom: 1px solid #ff00ff; }
        body.theme-cyber .album-card:hover { box-shadow: 0 0 18px rgba(255, 0, 255, 0.6) !important; }
        body.theme-cyber .btn-primary { background: #ff00ff !important; color: #fff !important; }
        body.theme-cyber .song-list li { color: #ff00ff !important; }
        body.theme-cyber .bottom-nav-item.active { color: #ff00ff !important; background: rgba(255, 0, 255, 0.1); }
        body.theme-floral .album-img, body.theme-floral .album-detail-img { border-color: #ff85a2; }
        body.theme-floral { background: linear-gradient(135deg, #3d1c2b 0%, #4a2c3a 100%) !important; color: #ffe0e9 !important; }
        body.theme-floral .logo { color: #ff85a2 !important; text-shadow: 0 0 8px #ff85a2; }
        body.theme-floral header { background: rgba(45, 20, 35, 0.8) !important; backdrop-filter: blur(5px); border-bottom: 1px solid #ff85a2; }
        body.theme-floral .album-card:hover { box-shadow: 0 0 18px rgba(255, 133, 162, 0.6) !important; }
        body.theme-floral .btn-primary { background: #ff85a2 !important; color: #3d1c2b !important; font-weight: bold; }
        body.theme-floral .song-list li { color: #ff85a2 !important; }
        body.theme-floral .bottom-nav-item.active { color: #ff85a2 !important; background: rgba(255, 133, 162, 0.1); }
        @keyframes fire-glow { from { box-shadow: 0 0 10px #ff8c00, 0 0 20px #ff8c00, 0 0 30px #ff4500, 0 0 40px #ff0000; } to { box-shadow: 0 0 15px #ff8c00, 0 0 25px #ff8c00, 0 0 40px #ff4500, 0 0 55px #ff0000; } } @keyframes logo-flicker { 0%, 100% { text-shadow: 0 0 5px #ff4500, 0 0 10px #ff4500, 0 0 20px #ff8c00, 0 0 40px #ff0000; opacity: 1; } 50% { text-shadow: 0 0 8px #ff4500, 0 0 15px #ff4500, 0 0 25px #ff8c00, 0 0 45px #ff0000; opacity: 0.95; } } @keyframes neonPulse { 0% { text-shadow: 0 0 15px #00ff88, 0 0 30px #00ff88; } 100% { text-shadow: 0 0 25px #00ff88, 0 0 40px #00ff88, 0 0 60px #00ff88; } } @keyframes dropdownFadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } } @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } } /* --- ESTILOS PARA MÓVILES --- */ @media (max-width: 768px) { header { padding: 1rem; } .logo { font-size: 1.2rem; } main { padding: 0.8rem; } .album-detail-img { width: 160px; height: 160px; } .song-list li { padding: 0.6rem 0.5rem; } .song-meta { gap: 1rem; } .song-actions { gap: 0.6rem; } .song-actions span { font-size: 1.1rem; } .bottom-nav { height: 60px; } .bottom-nav-item .icon { font-size: 1rem; } .bottom-nav-item small { font-size: 0.6rem; } .full-player-cover { width: 180px; height: 180px; } .full-player-title { font-size: 1.5rem; } .full-player-artist { font-size: 1rem; } .full-control-btn { font-size: 2rem; } .full-play-btn { font-size: 3rem; } .full-player-close { font-size: 2rem; top: 20px; right: 20px; } .full-progress-container { width: 100%; max-width: 350px; } .full-progress-time { font-size: 0.9rem; min-width: 40px; } .full-player-volume { margin-top: 0.5rem; } } @media (max-width: 400px) { .album-grid { grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 1rem; } .album-img { width: 90px; height: 90px; } .album-card { padding: 0.5rem; } .album-title { font-size: 0.9rem; } .album-artist { font-size: 0.8rem; } .song-list li { flex-wrap: wrap; } .song-meta { width: 100%; justify-content: space-between; margin-top: 0.5rem; } .bottom-nav { height: 60px; } .player { bottom: 60px; padding: 0.6rem 0.8rem; } }
    </style>
</head>
<body class="theme-default">
    
    <header>
        <div class="logo">KLMZ MUSIC</div>
        <div class="user-actions">
            <div class="theme-selector">
                <label for="theme-select">Tema:</label>
                <select id="theme-select">
                    <option value="default">Default</option>
                    <option value="fire">Fire</option>
                    <option value="neon">Neon</option>
                    <option value="minimal">Minimal</option>
                    <option value="sunset">Sunset</option>
                    <option value="pastel">Pastel</option>
                    <option value="luxury">Luxury</option>
                    <option value="oceanic">Oceanic</option>
                    <option value="hacker">Hacker</option>
                    <option value="cyber">Cyber</option>
                    <option value="floral">Floral</option>
                </select>
            </div>
            <span class="material-symbols-outlined lock-icon" id="lock-icon">🔓</span>
            <div class="user-menu">
                <span class="material-symbols-outlined lock-icon" id="user-menu-btn">person</span>
                <div class="user-dropdown" id="user-dropdown">
                    <div class="user-info">Sesión: <strong>Invitado</strong></div>
                    <div class="user-dropdown-item" id="login-link"><span class="material-symbols-outlined">login</span> Iniciar Sesión</div>
                    <div class="user-dropdown-item" id="register-link"><span class="material-symbols-outlined">person_add</span> Registrarse</div>
                    <div class="user-dropdown-item" id="admin-link" style="display:none;"><span class="material-symbols-outlined">admin_panel_settings</span> Panel Admin</div>
                    <div class="user-dropdown-item logout"><span class="material-symbols-outlined">logout</span> Cerrar Sesión (Simulado)</div>
                </div>
            </div>
        </div>
    </header>

    <div class="app-container">
        <main>
            <div id="loading-indicator" class="loading-indicator" style="display:none;">Cargando...</div>

            <section id="home" class="content-section active">
                <h2 class="section-title">Nuevos Lanzamientos <span class="offline-indicator" style="display:none;">Offline</span></h2>
                <div class="album-grid" id="album-grid">
                    </div>
            </section>

            <section id="search" class="content-section">
                <h2 class="section-title">Buscar</h2>
                <input type="text" id="search-input" placeholder="Busca canciones, artistas o álbumes...">
                <div id="search-results">
                    </div>
            </section>
            
            <section id="library" class="content-section">
                <h2 class="section-title">Mi Biblioteca</h2>
                
                <h3><span class="material-symbols-outlined">favorite</span> Favoritas</h3>
                <div id="favorites-list" class="favorites-list">
                    </div>
                
                <h3><span class="material-symbols-outlined">playlist_play</span> Playlists</h3>
                <div id="playlist-list">
                    </div>
                <button class="btn-primary" onclick="alert('Simulación: Crear nueva playlist')">Crear Nueva Playlist</button>
                
                <h3><span class="material-symbols-outlined">download</span> Descargas</h3>
                <div id="downloads-list" class="downloads-list">
                    </div>
                <button class="btn-secondary" onclick="toggleOfflineMode()">Modo Offline <span id="offline-status">${isOfflineMode ? 'Desactivar' : 'Activar'}</span></button>
            </section>

            <section id="album-detail" class="content-section">
                <button class="back-btn" id="back-button"><span class="material-symbols-outlined">arrow_back</span> Volver</button>
                <img id="album-detail-img" src="placeholder.jpg" alt="Portada del Álbum" class="album-detail-img">
                <h2 class="section-title" id="album-detail-title">Nombre del Álbum</h2>
                <p class="album-artist" id="album-detail-artist">Artista</p>
                
                <div class="song-list">
                    <ul>
                        </ul>
                </div>
            </section>

            <section id="playlist-detail" class="content-section">
                <button class="back-btn" id="back-button-playlist"><span class="material-symbols-outlined">arrow_back</span> Volver</button>
                <h2 class="section-title" id="playlist-detail-title">Nombre de Playlist</h2>
                <p class="album-artist" id="playlist-detail-count">X canciones</p>
                
                <div class="song-list">
                    <ul>
                        </ul>
                </div>
            </section>
            
            <section id="admin" class="content-section">
                <h2 class="section-title"><span class="material-symbols-outlined">admin_panel_settings</span> Panel de Administración</h2>
                
                <div class="admin-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="total-albums">0</div>
                        <div class="stat-label">Álbumes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="total-songs">0</div>
                        <div class="stat-label">Canciones</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="total-users">0</div>
                        <div class="stat-label">Usuarios (Sim.)</div>
                    </div>
                </div>
                
                <div class="admin-section">
                    <h3>Gestión de Álbumes y Canciones</h3>
                    <div id="admin-album-list">
                        </div>
                    <button class="btn-primary" onclick="alert('Simulación: Crear nuevo álbum')">Crear Nuevo Álbum</button>
                </div>
                
                <div class="admin-section multi-upload-section">
                    <h4>Carga Masiva de Canciones</h4>
                    <div class="admin-form">
                        <div class="form-group">
                            <label for="multi-file-upload">Seleccionar Archivos (MP3)</label>
                            <input type="file" id="multi-file-upload" multiple accept=".mp3">
                        </div>
                        <div class="form-group">
                            <label for="multi-album-select">Asignar a Álbum:</label>
                            <select id="multi-album-select">
                                <option value="new">Nuevo Álbum...</option>
                                <option value="a1">KLMZ Best Hits</option>
                            </select>
                        </div>
                        <div id="file-queue" class="file-queue">
                            </div>
                        <div class="batch-upload-progress" style="display:none;">
                            <div class="batch-progress-bar"><div class="batch-progress-fill"></div></div>
                            <small id="batch-progress-text">0 de 0 subidos</small>
                        </div>
                        <button class="btn-primary" onclick="alert('Simulación: Iniciar carga masiva')">Iniciar Carga</button>
                    </div>
                </div>
            </section>
            
        </main>
    </div>

    <div class="player" id="mini-player" style="display:none;">
        <img id="mini-player-img" src="placeholder.jpg" alt="Mini Cover" class="player-img-mini">
        <div class="player-info-mini">
            <div id="mini-player-title" class="player-title-mini">Título de la Canción</div>
            <div id="mini-player-artist" class="player-artist-mini">Artista</div>
        </div>
        <div class="player-controls-inline">
            <button class="play-btn-inline material-symbols-outlined">play_arrow</button>
        </div>
    </div>
    
    <div class="full-player-backdrop" id="full-player-backdrop">
        <button class="full-player-close material-symbols-outlined" id="full-player-close">close</button>
        
        <img id="full-player-cover" src="placeholder.jpg" alt="Full Cover" class="full-player-cover">
        
        <div id="full-player-title" class="full-player-title">Título de la Canción</div>
        <div id="full-player-artist" class="full-player-artist">Artista</div>
        
        <div class="full-player-controls">
            <div class="full-progress-container">
                <span id="full-progress-current" class="full-progress-time">0:00</span>
                <div id="full-progress-bar" class="full-progress-bar">
                    <div id="full-progress-fill" class="full-progress-fill"></div>
                </div>
                <span id="full-progress-duration" class="full-progress-time">0:00</span>
            </div>
            
            <div class="full-control-buttons">
                <button class="full-control-btn material-symbols-outlined" id="shuffle-btn">shuffle</button>
                <button class="full-control-btn material-symbols-outlined" id="full-player-prev">skip_previous</button>
                <button class="full-control-btn material-symbols-outlined full-play-btn" id="full-player-play">play_arrow</button>
                <button class="full-control-btn material-symbols-outlined" id="full-player-next">skip_next</button>
                <button class="full-control-btn material-symbols-outlined" id="repeat-btn">repeat</button>
            </div>
            
            <div class="full-player-volume">
                <span class="material-symbols-outlined">volume_up</span>
                <input type="range" min="0" max="1" step="0.01" value="1" class="full-volume-slider" id="volume-slider">
            </div>
        </div>
    </div>

    <div class="modal" id="login-modal">
        <div class="modal-content">
            <button class="close-modal material-symbols-outlined">close</button>
            <div class="modal-header">Iniciar Sesión</div>
            <form id="login-form">
                <div class="form-group">
                    <label for="login-user">Usuario</label>
                    <input type="text" id="login-user" required>
                </div>
                <div class="form-group">
                    <label for="login-pass">Contraseña</label>
                    <input type="password" id="login-pass" required>
                </div>
                <button type="submit" class="btn-primary">Entrar</button>
                <p>¿No tienes cuenta? <a href="#" id="modal-register-link">Regístrate aquí</a></p>
            </form>
        </div>
    </div>

    <div class="modal" id="register-modal">
        <div class="modal-content">
            <button class="close-modal material-symbols-outlined">close</button>
            <div class="modal-header">Registrarse</div>
            <form id="register-form">
                <div class="form-group">
                    <label for="register-user">Usuario</label>
                    <input type="text" id="register-user" required>
                </div>
                <div class="form-group">
                    <label for="register-email">Email</label>
                    <input type="email" id="register-email" required>
                </div>
                <div class="form-group">
                    <label for="register-pass">Contraseña</label>
                    <input type="password" id="register-pass" required>
                </div>
                <button type="submit" class="btn-primary">Crear Cuenta</button>
                <p>¿Ya tienes cuenta? <a href="#" id="modal-login-link">Inicia Sesión</a></p>
            </form>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="bottom-nav-item active" data-view="home">
            <span class="material-symbols-outlined icon">home</span>
            <small>Inicio</small>
        </div>
        <div class="bottom-nav-item" data-view="search">
            <span class="material-symbols-outlined icon">search</span>
            <small>Buscar</small>
        </div>
        <div class="bottom-nav-item" data-view="library">
            <span class="material-symbols-outlined icon">library_music</span>
            <small>Biblioteca</small>
        </div>
        <div class="bottom-nav-item" data-view="admin" id="admin-nav-item" style="display:none;">
            <span class="material-symbols-outlined icon">admin_panel_settings</span>
            <small>Admin</small>
        </div>
    </div>
    
    <div class="copyright">
        KLMZ MUSIC © 2024
    </div>
    
    <script>
        // Datos de ejemplo para Álbumes - INICIO DEL ARREGLO DE ÁLBUMES
        const albums = [
            { id: 'a1', title: 'KLMZ Best Hits', artist: 'KLMZ', cover: 'covers/klmz_best_hits.jpg' },
            { id: 'a2', title: 'Future Sounds', artist: 'Various Artists', cover: 'covers/future_sounds.jpg' },
            { id: 'a3', title: 'Deep Chill', artist: 'Lounge Stars', cover: 'covers/deep_chill.jpg' },
            { id: 'a4', title: 'Rock Classics', artist: 'Legends', cover: 'covers/rock_classics.jpg' },
            { id: 'a5', title: 'Latin Pop', artist: 'Sabor Latino', cover: 'covers/latin_pop.jpg' },
            { id: 'a6', title: 'Smooth Jazz', artist: 'Jazz Masters', cover: 'covers/smooth_jazz.jpg' },
            { id: 'a7', title: '90s Dance', artist: 'Eurobeat Kings', cover: 'covers/90s_dance.jpg' },
            { id: 'a8', title: 'Acoustic Vibes', artist: 'Singer Songwriters', cover: 'covers/acoustic_vibes.jpg' },
        ];

        // Función para renderizar los álbumes
        function renderAlbums() {
            const grid = document.getElementById('album-grid');
            if (!grid) return; 

            // Limpiar el contenido existente (si hay)
            grid.innerHTML = ''; 

            albums.forEach(album => {
                const card = document.createElement('div');
                card.className = 'album-card';
                card.dataset.albumId = album.id;
                card.innerHTML = `
                    <img src="${album.cover}" alt="${album.title}" class="album-img">
                    <div class="album-title">${album.title}</div>
                    <div class="album-artist">${album.artist}</div>
                `;
                // Añadir un evento de clic para simular la navegación a los detalles del álbum
                card.addEventListener('click', () => showAlbumDetail(album.id)); 
                grid.appendChild(card);
            });
        }
        // Fin del arreglo de álbumes

        // Variables Globales
        let isAuthenticated = false;
        let isOfflineMode = false;
        let currentTheme = localStorage.getItem('theme') || 'theme-default';
        let currentPlaying = null;
        let currentPlaylist = [];
        let currentSongIndex = -1;
        let audio = new Audio();
        let currentView = 'home';
        let isPlayerOpen = false;
        let shuffleMode = false;
        let repeatMode = 'none'; // 'none', 'one', 'all'

        // Datos de ejemplo (deben estar actualizados con la app)
        const playlists = [
            { id: 'p1', name: 'Mis Favoritas', count: 3, isHidden: false },
            { id: 'p2', name: 'Para Correr', count: 5, isHidden: false },
            { id: 'p3', name: 'Concentración', count: 10, isHidden: false },
        ];

        const songsWithAlbumInfo = [
            { id: 's1', title: 'Sunrise Groove', artist: 'KLMZ', file: 'music/klmz_sunrise_groove.mp3', duration: '3:45', albumId: 'a1' },
            { id: 's2', title: 'City Lights', artist: 'KLMZ', file: 'music/klmz_city_lights.mp3', duration: '4:12', albumId: 'a1' },
            { id: 's3', title: 'Future Bass', artist: 'V. A.', file: 'music/va_future_bass.mp3', duration: '3:01', albumId: 'a2' },
            { id: 's4', title: 'Chill Out Mix', artist: 'Lounge Stars', file: 'music/chill_out_mix.mp3', duration: '5:00', albumId: 'a3' },
            { id: 's5', title: 'Bohemian Rhapsody', artist: 'Legends', file: 'music/bohemian_rhapsody.mp3', duration: '6:00', albumId: 'a4' },
            { id: 's6', title: 'Despacito', artist: 'Sabor Latino', file: 'music/despacito.mp3', duration: '4:00', albumId: 'a5' },
            // Agrega más canciones si es necesario para los álbumes nuevos
        ];
        
        const downloads = [
            { id: 'd1', title: 'Offline Track 1', artist: 'Local Artist', file: 'music/offline_track_1.mp3', duration: '3:20' },
            { id: 'd2', title: 'Offline Track 2', artist: 'Local Artist', file: 'music/offline_track_2.mp3', duration: '4:50' },
        ];
        
        const favorites = [
            { id: 's1', title: 'Sunrise Groove', artist: 'KLMZ', file: 'music/klmz_sunrise_groove.mp3', duration: '3:45', albumId: 'a1' },
            { id: 's5', title: 'Bohemian Rhapsody', artist: 'Legends', file: 'music/bohemian_rhapsody.mp3', duration: '6:00', albumId: 'a4' },
        ];
        
        // --- UTILIDADES ---
        
        function formatTime(seconds) {
            if (isNaN(seconds) || seconds < 0) return '0:00';
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = Math.floor(seconds % 60);
            return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
        }
        
        function toggleLock() {
            isAuthenticated = !isAuthenticated;
            document.querySelector('.lock-icon').textContent = isAuthenticated ? '🔒' : '🔓';
            document.getElementById('admin-link').style.display = isAuthenticated ? 'flex' : 'none';
            document.getElementById('admin-nav-item').style.display = isAuthenticated ? 'flex' : 'none';
            showView(currentView);
        }
        
        function toggleOfflineMode() {
            isOfflineMode = !isOfflineMode;
            document.body.classList.toggle('offline-mode', isOfflineMode);
            document.getElementById('offline-status').textContent = isOfflineMode ? 'Desactivar' : 'Activar';
            // Lógica para mostrar solo canciones descargadas si es necesario
        }
        
        function applyTheme(themeName) {
            document.body.className = `theme-${themeName}`;
            localStorage.setItem('theme', themeName);
            currentTheme = themeName;
        }

        function showView(viewId, params = {}) {
            currentView = viewId;
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(viewId).classList.add('active');
            
            // Lógica específica para cada vista
            const backButton = document.getElementById('back-button');
            if (backButton) {
                backButton.style.display = (viewId === 'home' || viewId === 'search' || viewId === 'library' || viewId === 'admin') ? 'none' : 'block';
            }
            
            // Si la vista es "admin", también ocultamos el botón de regreso de la playlist y viceversa
            const backButtonPlaylist = document.getElementById('back-button-playlist');
            if (backButtonPlaylist) backButtonPlaylist.style.display = 'none';

            if (viewId === 'home') {
                renderAlbums();
            } else if (viewId === 'library') {
                renderPlaylists();
                renderDownloads();
                renderFavorites();
            } else if (viewId === 'album-detail') {
                if (params.albumId) showAlbumDetail(params.albumId, true);
            } else if (viewId === 'playlist-detail') {
                if (params.playlistId) showPlaylistDetail(params.playlistId, true);
                if (backButtonPlaylist) backButtonPlaylist.style.display = 'block';
            } else if (viewId === 'admin') {
                if(isAuthenticated) renderAdminView();
                else showView('home'); // Redirigir si no está autenticado
            }
        }

        // --- MANEJO DE ÁLBUMES Y REPRODUCCIÓN ---

        function showAlbumDetail(albumId, force = false) {
            const album = albums.find(a => a.id === albumId);
            if (!album) return;

            document.getElementById('album-detail-title').textContent = album.title;
            document.getElementById('album-detail-artist').textContent = album.artist;
            document.getElementById('album-detail-img').src = album.cover;
            
            const songListUl = document.querySelector('#album-detail .song-list ul');
            songListUl.innerHTML = '';

            const albumSongs = songsWithAlbumInfo.filter(s => s.albumId === album.id);

            albumSongs.forEach((song, index) => {
                const li = document.createElement('li');
                li.dataset.songIndex = index;
                li.dataset.sourceType = 'album';
                li.dataset.sourceId = album.id;
                li.innerHTML = `
                    <div class="song-info">
                        <span class="song-title">${song.title}</span>
                        <small class="song-artist">${song.artist}</small>
                    </div>
                    <div class="song-meta">
                        <span class="song-duration">${song.duration}</span>
                        <div class="song-actions">
                            <span class="play-icon material-symbols-outlined" data-song-index="${index}">play_arrow</span>
                            <span class="add-to-playlist-icon material-symbols-outlined" data-song-id="${song.id}">playlist_add</span>
                        </div>
                    </div>
                `;
                songListUl.appendChild(li);
            });

            if (force) showView('album-detail', { albumId: albumId });
        }
        
        function playSong(song, sourceAlbums, sourcePlaylist, index) {
            currentPlaying = song;
            currentPlaylist = sourcePlaylist;
            currentSongIndex = index;

            audio.src = song.file;
            audio.play();

            // Actualizar mini-player
            document.getElementById('mini-player-img').src = sourceAlbums.find(a => a.id === song.albumId)?.cover || 'placeholder.jpg';
            document.getElementById('mini-player-title').textContent = song.title;
            document.getElementById('mini-player-artist').textContent = song.artist;
            document.getElementById('mini-player').style.display = 'flex';

            // Actualizar full-player
            document.getElementById('full-player-cover').src = document.getElementById('mini-player-img').src;
            document.getElementById('full-player-title').textContent = song.title;
            document.getElementById('full-player-artist').textContent = song.artist;
            updatePlayPauseIcon(true);
        }
        
        function playSongFromPlaylist(index) {
            if (index >= 0 && index < currentPlaylist.length) {
                const song = currentPlaylist[index];
                const album = albums.find(a => a.id === song.albumId);
                playSong(song, album ? [album] : [], currentPlaylist, index);
            }
        }

        function togglePlayPause() {
            if (audio.paused) {
                audio.play();
                updatePlayPauseIcon(true);
            } else {
                audio.pause();
                updatePlayPauseIcon(false);
            }
        }

        function updatePlayPauseIcon(isPlaying) {
            const iconName = isPlaying ? 'pause' : 'play_arrow';
            document.querySelectorAll('.play-btn-inline, .full-play-btn').forEach(btn => {
                btn.textContent = iconName;
            });
        }
        
        // --- LÓGICA DEL REPRODUCTOR COMPLETO ---

        function openFullPlayer() {
            if (!currentPlaying) return;
            document.getElementById('full-player-backdrop').classList.add('active');
            isPlayerOpen = true;
        }

        function closeFullPlayer() {
            document.getElementById('full-player-backdrop').classList.remove('active');
            isPlayerOpen = false;
        }

        audio.addEventListener('timeupdate', () => {
            const progress = (audio.currentTime / audio.duration) * 100;
            const fullProgressFill = document.getElementById('full-progress-fill');
            if (fullProgressFill) fullProgressFill.style.width = `${progress}%`;
            
            const currentTimeEl = document.getElementById('full-progress-current');
            if (currentTimeEl) currentTimeEl.textContent = formatTime(audio.currentTime);
            
            const durationEl = document.getElementById('full-progress-duration');
            if (durationEl && isNaN(audio.duration) === false) durationEl.textContent = formatTime(audio.duration);
        });

        audio.addEventListener('ended', () => {
            playNextSong();
        });

        function playNextSong() {
            if (repeatMode === 'one') {
                audio.currentTime = 0;
                audio.play();
                return;
            }
            
            let nextIndex = currentSongIndex + 1;
            
            if (shuffleMode) {
                nextIndex = Math.floor(Math.random() * currentPlaylist.length);
            } else if (nextIndex >= currentPlaylist.length) {
                if (repeatMode === 'all') {
                    nextIndex = 0; // Bucle
                } else {
                    audio.currentTime = 0;
                    updatePlayPauseIcon(false);
                    return; // Detener
                }
            }

            playSongFromPlaylist(nextIndex);
        }
        
        function playPreviousSong() {
            let prevIndex = currentSongIndex - 1;
            
            if (shuffleMode) {
                prevIndex = Math.floor(Math.random() * currentPlaylist.length);
            } else if (audio.currentTime > 3) { // Si ya van más de 3 segundos, reiniciar la canción
                audio.currentTime = 0;
                audio.play();
                return;
            } else if (prevIndex < 0) {
                prevIndex = currentPlaylist.length - 1;
            }
            
            playSongFromPlaylist(prevIndex);
        }
        
        function toggleShuffle() {
            shuffleMode = !shuffleMode;
            document.getElementById('shuffle-btn').classList.toggle('active', shuffleMode);
        }

        function toggleRepeat() {
            if (repeatMode === 'none') {
                repeatMode = 'all';
                document.getElementById('repeat-btn').textContent = 'repeat';
                document.getElementById('repeat-btn').classList.add('active');
            } else if (repeatMode === 'all') {
                repeatMode = 'one';
                document.getElementById('repeat-btn').textContent = 'repeat_one';
            } else {
                repeatMode = 'none';
                document.getElementById('repeat-btn').textContent = 'repeat';
                document.getElementById('repeat-btn').classList.remove('active');
            }
        }
        
        // --- LÓGICA DE BIBLIOTECA (PLAYLISTS, FAVORITOS, DESCARGAS) ---

        function renderPlaylists() {
            const container = document.getElementById('playlist-list');
            container.innerHTML = '';

            playlists.forEach(playlist => {
                const item = document.createElement('div');
                item.className = 'playlist-item';
                item.dataset.playlistId = playlist.id;
                item.innerHTML = `
                    <div class="playlist-info">
                        <strong>${playlist.name}</strong>
                        <small>${playlist.count} canciones</small>
                    </div>
                    <div class="playlist-actions">
                        <span class="material-symbols-outlined delete-playlist" data-playlist-id="${playlist.id}">delete</span>
                    </div>
                `;
                container.appendChild(item);
            });
        }
        
        function renderDownloads() {
            const container = document.getElementById('downloads-list');
            container.innerHTML = '';
            
            downloads.forEach(download => {
                const item = document.createElement('div');
                item.className = 'download-item';
                item.dataset.downloadId = download.id;
                item.innerHTML = `
                    <div class="download-info">
                        <span class="download-title">${download.title}</span>
                        <small class="download-artist">Descargada</small>
                    </div>
                    <div class="download-item-actions">
                        <span class="material-symbols-outlined delete-download" data-download-id="${download.id}">delete</span>
                    </div>
                `;
                container.appendChild(item);
            });
        }
        
        function renderFavorites() {
            const container = document.getElementById('favorites-list');
            container.innerHTML = '';
            
            favorites.forEach(favorite => {
                const item = document.createElement('div');
                item.className = 'favorite-item';
                item.dataset.song = JSON.stringify(favorite);
                item.dataset.songId = favorite.id;
                item.innerHTML = `
                    <div class="favorite-info">
                        <span class="favorite-title">${favorite.title}</span>
                        <small class="favorite-artist">${favorite.artist}</small>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        function showPlaylistDetail(playlistId, force = false) {
            const playlist = playlists.find(p => p.id === playlistId);
            if (!playlist) return;

            document.getElementById('playlist-detail-title').textContent = playlist.name;
            document.getElementById('playlist-detail-count').textContent = `${playlist.count} canciones`;
            
            const songListUl = document.querySelector('#playlist-detail .song-list ul');
            songListUl.innerHTML = '';

            // Usar una lista de ejemplo de canciones para la playlist
            const playlistSongs = songsWithAlbumInfo.slice(0, playlist.count); 

            playlistSongs.forEach((song, index) => {
                const li = document.createElement('li');
                li.dataset.songIndex = index;
                li.dataset.sourceType = 'playlist';
                li.dataset.sourceId = playlist.id;
                li.innerHTML = `
                    <div class="song-info">
                        <span class="song-title">${song.title}</span>
                        <small class="song-artist">${song.artist}</small>
                    </div>
                    <div class="song-meta">
                        <span class="song-duration">${song.duration}</span>
                        <div class="song-actions">
                            <span class="play-icon material-symbols-outlined" data-song-index="${index}">play_arrow</span>
                            <span class="material-symbols-outlined remove-from-playlist" data-song-id="${song.id}">remove</span>
                        </div>
                    </div>
                `;
                songListUl.appendChild(li);
            });

            if (force) showView('playlist-detail', { playlistId: playlistId });
        }
        
        // --- LÓGICA DE ADMIN (SIMULADA) ---

        function renderAdminView() {
            document.getElementById('total-albums').textContent = albums.length;
            document.getElementById('total-songs').textContent = songsWithAlbumInfo.length;
            document.getElementById('total-users').textContent = '1'; // Simulado

            const adminAlbumList = document.getElementById('admin-album-list');
            adminAlbumList.innerHTML = '';

            albums.forEach(album => {
                const albumSongs = songsWithAlbumInfo.filter(s => s.albumId === album.id);
                const albumItem = document.createElement('div');
                albumItem.className = 'admin-album-item';
                albumItem.innerHTML = `
                    <div class="admin-album-header">
                        <div class="admin-item-info">
                            <strong>${album.title}</strong>
                            <small>${album.artist} (${albumSongs.length} canciones)</small>
                        </div>
                        <div class="admin-item-actions">
                            <button class="btn-danger delete-album" data-album-id="${album.id}">Eliminar</button>
                        </div>
                    </div>
                    <div class="admin-song-list">
                        ${albumSongs.length > 0 ? albumSongs.map(song => `
                            <div class="admin-song-item" data-song-id="${song.id}">
                                <span>${song.title} - ${song.duration}</span>
                                <div class="admin-song-actions">
                                    <button class="btn-danger delete-song" data-song-id="${song.id}">Eliminar</button>
                                </div>
                            </div>
                        `).join('') : '<p class="no-songs">No hay canciones en este álbum.</p>'}
                        <button class="btn-primary" onclick="alert('Simulación de añadir canción a ${album.title}')">Añadir Canción</button>
                    </div>
                `;
                adminAlbumList.appendChild(albumItem);
            });
        }
        
        // --- MANEJO DE EVENTOS ---

        document.addEventListener('DOMContentLoaded', () => {
            // Inicializar vista y tema
            applyTheme(currentTheme);
            document.getElementById('theme-select').value = currentTheme;
            showView('home'); 
            
            // Asignar eventos del DOM
            const backButton = document.getElementById('back-button');
            if(backButton) {
                backButton.addEventListener('click', () => {
                    if (currentView === 'album-detail' || currentView === 'playlist-detail') {
                        showView('home');
                    } else if (currentView === 'search') {
                        document.getElementById('search-input').value = '';
                        document.getElementById('search-results').innerHTML = '';
                        showView('home');
                    }
                });
            }
            
            const backButtonPlaylist = document.getElementById('back-button-playlist');
            if(backButtonPlaylist) {
                backButtonPlaylist.addEventListener('click', () => {
                    showView('library');
                });
            }


            document.getElementById('theme-select').addEventListener('change', (e) => {
                applyTheme(e.target.value);
            });

            document.getElementById('lock-icon').addEventListener('click', toggleLock);
            
            document.getElementById('login-link').addEventListener('click', () => {
                document.getElementById('login-modal').style.display = 'flex';
            });
            document.getElementById('register-link').addEventListener('click', () => {
                document.getElementById('register-modal').style.display = 'flex';
            });
            
            // Alternar links en modales
            document.getElementById('modal-register-link').addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('login-modal').style.display = 'none';
                document.getElementById('register-modal').style.display = 'flex';
            });
            document.getElementById('modal-login-link').addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('register-modal').style.display = 'none';
                document.getElementById('login-modal').style.display = 'flex';
            });
            
            document.querySelectorAll('.close-modal').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.target.closest('.modal').style.display = 'none';
                });
            });
            
            document.getElementById('login-form').addEventListener('submit', (e) => {
                e.preventDefault();
                document.getElementById('login-modal').style.display = 'none';
                toggleLock();
            });
            
            document.getElementById('register-form').addEventListener('submit', (e) => {
                e.preventDefault();
                document.getElementById('register-modal').style.display = 'none';
                toggleLock();
            });
            
            document.getElementById('user-menu-btn').addEventListener('click', () => {
                document.getElementById('user-dropdown').classList.toggle('show');
            });
            document.querySelectorAll('.user-dropdown-item.logout').forEach(btn => {
                btn.addEventListener('click', () => {
                    if(isAuthenticated) toggleLock(); // Desactivar la sesión
                    document.getElementById('user-dropdown').classList.remove('show');
                });
            });
            document.getElementById('admin-link').addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('user-dropdown').classList.remove('show');
                showView('admin');
            });
            
            // Cerrar menú al hacer clic fuera
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.user-menu') && document.getElementById('user-dropdown').classList.contains('show')) {
                    document.getElementById('user-dropdown').classList.remove('show');
                }
            });


            // Navegación principal
            document.querySelectorAll('.bottom-nav-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    document.querySelectorAll('.bottom-nav-item').forEach(nav => nav.classList.remove('active'));
                    e.currentTarget.classList.add('active');
                    showView(e.currentTarget.dataset.view);
                });
            });

            // Controles del mini-player
            document.querySelector('.play-btn-inline').addEventListener('click', togglePlayPause);
            document.querySelector('#mini-player').addEventListener('click', (e) => {
                if (!e.target.closest('.player-controls-inline')) {
                    openFullPlayer();
                }
            });

            // Controles del full-player
            document.getElementById('full-player-close').addEventListener('click', closeFullPlayer);
            document.getElementById('full-player-play').addEventListener('click', togglePlayPause);
            document.getElementById('full-player-next').addEventListener('click', playNextSong);
            document.getElementById('full-player-prev').addEventListener('click', playPreviousSong);
            document.getElementById('shuffle-btn').addEventListener('click', toggleShuffle);
            document.getElementById('repeat-btn').addEventListener('click', toggleRepeat);
            
            document.getElementById('full-progress-bar').addEventListener('click', (e) => {
                const bar = e.currentTarget;
                const rect = bar.getBoundingClientRect();
                const offsetX = e.clientX - rect.left;
                const percentage = offsetX / rect.width;
                audio.currentTime = audio.duration * percentage;
            });
            
            document.getElementById('volume-slider').addEventListener('input', (e) => {
                audio.volume = e.target.value;
            });

            // Simulación de búsqueda
            document.getElementById('search-input').addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                const resultsContainer = document.getElementById('search-results');
                resultsContainer.innerHTML = '';
                
                if (query.length < 2) return;

                const filteredSongs = songsWithAlbumInfo.filter(song => 
                    song.title.toLowerCase().includes(query) || 
                    song.artist.toLowerCase().includes(query)
                );
                
                const filteredAlbums = albums.filter(album => 
                    album.title.toLowerCase().includes(query) || 
                    album.artist.toLowerCase().includes(query)
                );

                if (filteredSongs.length > 0) {
                    resultsContainer.innerHTML += '<h3>Canciones</h3>';
                    filteredSongs.forEach(song => {
                        const item = document.createElement('div');
                        item.className = 'search-song-item';
                        item.dataset.songId = song.id;
                        item.innerHTML = `
                            <div class="search-song-info">
                                <span class="search-song-title">${song.title}</span>
                                <small class="search-song-artist">${song.artist}</small>
                            </div>
                            <div class="song-actions">
                                <span class="play-icon material-symbols-outlined" data-song-id="${song.id}">play_arrow</span>
                                <span class="add-to-playlist-icon material-symbols-outlined" data-song-id="${song.id}">playlist_add</span>
                            </div>
                        `;
                        resultsContainer.appendChild(item);
                    });
                }
                
                if (filteredAlbums.length > 0) {
                    resultsContainer.innerHTML += '<h3>Álbumes</h3>';
                    filteredAlbums.forEach(album => {
                        const item = document.createElement('div');
                        item.className = 'search-album-item';
                        item.dataset.albumId = album.id;
                        item.innerHTML = `
                            <img src="${album.cover}" alt="${album.title}" class="search-album-img">
                            <div class="search-album-info">
                                <span class="search-album-title">${album.title}</span>
                                <small class="search-album-artist">${album.artist}</small>
                            </div>
                        `;
                        resultsContainer.appendChild(item);
                    });
                }
            });

            // Delegação de eventos de clique
            document.addEventListener('click', (e) => {
                
                // Clic en tarjeta de álbum en búsqueda
                const searchAlbumItem = e.target.closest('.search-album-item');
                if (searchAlbumItem) {
                    showAlbumDetail(searchAlbumItem.dataset.albumId, true);
                    return;
                }
                
                // Clic en ítem de playlist
                const playlistItem = e.target.closest('.playlist-item');
                if (playlistItem && !e.target.matches('.delete-playlist')) {
                    showPlaylistDetail(playlistItem.dataset.playlistId, true);
                    return;
                }
                
                // Clic en una canción en detalle de álbum o playlist
                const songLi = e.target.closest('.song-list li');
                if (songLi && (e.target.matches('.song-info *') || e.target.matches('.song-duration'))) {
                    const sourceType = songLi.dataset.sourceType;
                    const sourceId = songLi.dataset.sourceId;
                    const index = parseInt(songLi.dataset.songIndex);

                    if (sourceType === 'album') {
                        const album = albums.find(a => a.id === sourceId);
                        const albumSongs = songsWithAlbumInfo.filter(s => s.albumId === sourceId);
                        if (!isNaN(index) && album && albumSongs.length) playSong(albumSongs[index], [album], albumSongs, index);
                    } else if (sourceType === 'playlist') {
                        // Aquí se debería buscar la playlist real, pero usamos un ejemplo simplificado
                        const playlistSongs = songsWithAlbumInfo.slice(0, playlists.find(p => p.id === sourceId)?.count || 0);
                        if (!isNaN(index) && playlistSongs.length) playSong(playlistSongs[index], albums, playlistSongs, index);
                    }
                    return;
                }
                
                if (e.target.matches('.play-icon') && e.target.closest('.song-list')) {
                    const songLi = e.target.closest('.song-list li');
                    const sourceType = songLi.dataset.sourceType;
                    const sourceId = songLi.dataset.sourceId;
                    const index = parseInt(e.target.dataset.songIndex);

                    if (sourceType === 'album') {
                        const album = albums.find(a => a.id === sourceId);
                        const albumSongs = songsWithAlbumInfo.filter(s => s.albumId === sourceId);
                        if (!isNaN(index) && album && albumSongs.length) playSong(albumSongs[index], [album], albumSongs, index);
                    } else if (sourceType === 'playlist') {
                        const playlistSongs = songsWithAlbumInfo.slice(0, playlists.find(p => p.id === sourceId)?.count || 0);
                        if (!isNaN(index) && playlistSongs.length) playSong(playlistSongs[index], albums, playlistSongs, index);
                    }
                    return;
                }
                
                const searchSongItem = e.target.closest('.search-song-item');
                if (searchSongItem) {
                    const song = songsWithAlbumInfo.find(s => s.id === searchSongItem.dataset.songId);
                    const album = albums.find(a => a.id === song.albumId);
                    if (song) playSong(song, album ? [album] : [], [song], 0);
                    return;
                }
                
                const favoriteItem = e.target.closest('.favorite-item');
                if (favoriteItem) {
                    const songId = favoriteItem.dataset.songId;
                    const song = songsWithAlbumInfo.find(s => s.id === songId); // Buscar la info completa
                    const album = albums.find(a => a.id === song.albumId);
                    if(song) playSong(song, album ? [album] : [], [song], 0);
                    return;
                }

                if (e.target.matches('.delete-playlist')) {
                    alert('Simulación: Eliminar playlist ' + e.target.dataset.playlistId);
                    return;
                }
                
                if (e.target.matches('.delete-download')) {
                    alert('Simulación: Eliminar descarga ' + e.target.dataset.downloadId);
                    return;
                }

                if (e.target.matches('.add-to-playlist-icon')) {
                    alert('Simulación: Añadir canción ' + e.target.dataset.songId + ' a playlist');
                    // Aquí se mostraría el modal de selección de playlist
                    return;
                }
                
                if (e.target.matches('.delete-album')) {
                    alert('Simulación: Eliminar álbum ' + e.target.dataset.albumId);
                    return;
                }
                
                if (e.target.matches('.delete-song')) {
                    alert('Simulación: Eliminar canción ' + e.target.dataset.songId);
                    return;
                }

            });
        });
    </script>
    <script async="async" data-cfasync="false" src="//pl27638112.revenuecpmgate.com/2f9b36b527e21b2d6323dcdd425f899e4/invoke.js"></script>
    </body>
</html>
