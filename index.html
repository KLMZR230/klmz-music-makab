<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>KLMZ MUSIC</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#1DB954">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: #181818; color: #fff; padding-bottom: 100px; transition: all 0.3s ease;
        }
        
        .connection-status { position: fixed; top: 0; left: 0; right: 0; background: #1DB954; color: #fff; text-align: center; padding: 0.3rem; font-size: 0.8rem; z-index: 9999; }
        .connection-status.offline { background: #ff4757; }
        
        header { background: #121212; padding: 1rem 1.5rem; display: flex; align-items: center; justify-content: space-between; position: sticky; top: 30px; z-index: 100; }
        .logo { font-weight: bold; font-size: 1.4rem; letter-spacing: 1px; }
        .user-actions { display: flex; align-items: center; gap: 0.5rem; }
        .theme-selector select { background: #333; color: #fff; border: 1px solid #555; border-radius: 4px; padding: 0.3rem 0.5rem; font-size: 0.8rem; cursor: pointer; }
        .lock-icon { cursor: pointer; font-size: 1.4rem; color: #fff; user-select: none; margin-left: 1rem; }
        .lock-icon:hover { opacity: 0.7; }
        
        .app-container { display: flex; min-height: calc(100vh - 60px); }
        main { flex: 1; padding: 1rem; max-width: 900px; margin: 0 auto; }
        .section-title { font-size: 1.8rem; font-weight: bold; margin-bottom: 1.5rem; }
        
        .album-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 1.5rem; }
        .album-card { background: none; padding: 0; cursor: pointer; display: flex; flex-direction: column; align-items: center; text-align: center; transition: transform 0.3s; }
        .album-card:hover { transform: scale(1.05); }
        .album-img { border-radius: 50%; width: 100px; height: 100px; object-fit: cover; margin-bottom: 0.7rem; background: #333; }
        .album-title { font-size: 0.98rem; font-weight: bold; margin-bottom: 0.4rem; }
        .album-artist { font-size: 0.9rem; color: #b3b3b3; }
        
        #album-detail { padding-bottom: 120px; display: none; }
        .back-btn { margin-bottom: 1.2rem; background: #222; color: #fff; border: none; padding: 0.5rem 1.5rem; border-radius: 99px; cursor: pointer; }
        .back-btn:hover { background: #333; }
        
        .song-list { width: 100%; margin-top: 1rem; }
        .song-list ul { list-style: none; padding: 0; margin: 0; }
        .song-list li { padding: 0.7rem; cursor: pointer; color: #1db954; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; transition: all 0.3s ease; }
        .song-list li:hover { color: #fff; background: rgba(255,255,255,0.05); }
        
        .content-section { display: none; }
        .content-section.active { display: block; }
        
        .bottom-nav { position: fixed; left: 0; right: 0; bottom: 20px; background: #181818; border-top: 1px solid #272727; display: flex; height: 64px; z-index: 5000; }
        .bottom-nav-item { color: #b3b3b3; text-align: center; flex: 1; font-size: 1.14rem; padding: 4px 0 0 0; border-radius: 7px; cursor: pointer; display: flex; flex-direction: column; align-items: center; transition: all 0.3s ease; }
        .bottom-nav-item.active { color: #1DB954; background: rgba(29,185,84,0.09); }
        .bottom-nav-item:hover { background: rgba(255,255,255,0.05); }
        .bottom-nav-item .icon { font-size: 1.12rem; }
        .bottom-nav-item small { font-size: 0.67rem; }
        
        .player { position: fixed; bottom: 84px; left: 0; right: 0; background: #212121cc; border-top: 1px solid #282828; z-index: 300; display: none; align-items: center; padding: 0.8rem 1.2rem; min-height: 56px; }
        .player-img-mini { width: 44px; height: 44px; border-radius: 100%; object-fit: cover; margin-right: 1rem; }
        .player-info-mini { flex: 1; overflow: hidden; }
        .player-title-mini { font-weight: bold; font-size: 1rem; line-height: 1.2; }
        .player-artist-mini { color: #b3b3b3; font-size: 0.9rem; }
        .player-controls-inline { display: flex; align-items: center; gap: 0.5rem; }
        .play-btn-inline { background: #1DB954; color: #fff; border: none; border-radius: 50%; width: 36px; height: 36px; font-size: 1.1rem; cursor: pointer; }
        
        .copyright { position: fixed; bottom: 0; left: 0; width: 100%; height: 20px; background: #0a0a0a; color: #666; font-size: 0.7rem; text-align: center; padding: 2px 0; z-index: 10000; border-top: 1px solid #222; }
        .loading-indicator { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.9); color: #fff; padding: 1.5rem 2.5rem; border-radius: 12px; font-size: 1rem; z-index: 2000; border: 2px solid #1DB954; display: none; }
        
        /* TEMAS */
        body.theme-neon { background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 70%, #0a0a0a 100%) !important; color: #00ff88 !important; }
        body.theme-neon header { background: linear-gradient(135deg, #1a1a2e, #16213e) !important; border-bottom: 2px solid #00ff88 !important; }
        body.theme-neon .logo { color: #00ff88 !important; text-shadow: 0 0 15px #00ff88 !important; animation: neonPulse 2s ease-in-out infinite alternate !important; }
        body.theme-neon .section-title { color: #00ff88 !important; text-shadow: 0 0 15px rgba(0,255,136,0.7) !important; }
        
        body.theme-minimal { background: linear-gradient(135deg, #0f0f0f 0%, #1c1c1c 50%, #2a2a2a 70%, #0f0f0f 100%) !important; color: #f5f5f5 !important; }
        body.theme-minimal .logo { color: #f5f5f5 !important; font-weight: 200 !important; letter-spacing: 4px !important; }
        
        body.theme-sunset { background: linear-gradient(135deg, #2c1810 0%, #4a2c2a 30%, #6d4c41 60%, #1a1a1a 100%) !important; color: #ffab91 !important; }
        body.theme-sunset .logo { color: #ff8a65 !important; text-shadow: 0 2px 8px rgba(255,138,101,0.4) !important; }
        
        body.theme-pastel { background: linear-gradient(135deg, #1a1625 0%, #2d2438 50%, #3d2f47 70%, #4a3b5c 100%) !important; color: #d4c5f9 !important; }
        body.theme-pastel .logo { color: #b8a9e8 !important; text-shadow: 0 2px 12px rgba(184,169,232,0.5) !important; }
        
        body.theme-luxury { background: linear-gradient(135deg, #0f1419 0%, #1a252f 50%, #2c3e50 70%, #34495e 100%) !important; color: #f0f8ff !important; }
        body.theme-luxury .logo { color: #d4af37 !important; font-weight: 700 !important; text-shadow: 0 3px 10px rgba(212,175,55,0.5) !important; }
        
        @keyframes neonPulse { 0% { text-shadow: 0 0 15px #00ff88, 0 0 30px #00ff88; } 100% { text-shadow: 0 0 25px #00ff88, 0 0 40px #00ff88, 0 0 60px #00ff88; } }
        
        @media (max-width: 768px) { .album-img { width: 80px; height: 80px; } }
    </style>
</head>
<body>
    <div class="connection-status" id="connection-status">
        <span id="connection-text">üåê En l√≠nea</span>
    </div>
    <div class="loading-indicator" id="loading-indicator">üéµ Cargando m√∫sica...</div>

    <header>
        <span class="logo">KLMZ MUSIC</span>
        <div class="user-actions">
            <div class="theme-selector">
                <select id="theme-select">
                    <option value="default">üéµ Default</option>
                    <option value="neon">‚ö° Neon Cyberpunk</option>
                    <option value="minimal">‚ú® Elegancia Minimal</option>
                    <option value="sunset">üåÖ Sunset Vibes</option>
                    <option value="pastel">üå∏ Pastel Dreams</option>
                    <option value="luxury">üíé Luxury Jewels</option>
                </select>
            </div>
            <div class="lock-icon">üîí</div>
        </div>
    </header>

    <div class="app-container">
        <main>
            <section class="content-section active" id="home-section">
                <div class="section-title">Albums</div>
                <div class="album-grid" id="albums">
                    <div style="text-align: center; padding: 2rem;">üéµ Conectando a tu base de datos...</div>
                </div>
                <div id="album-detail"></div>
            </section>
            
            <section class="content-section" id="search-section">
                <div class="section-title">Buscar m√∫sica</div>
                <input type="text" placeholder="¬øQu√© quieres escuchar?" id="search-input" 
                       style="width: 100%; padding: 1rem; background: #242424; border: none; border-radius: 4px; color: #fff; margin-bottom: 2rem;">
                <div id="search-results"></div>
            </section>
            
            <section class="content-section" id="favorites-section">
                <div class="section-title">‚ù§Ô∏è Mis Favoritos</div>
                <div id="favorites-content">
                    <div style="text-align: center; padding: 2rem;">No tienes favoritos</div>
                </div>
            </section>
            
            <section class="content-section" id="downloads-section">
                <div class="section-title">‚¨áÔ∏è Mis Descargas</div>
                <div id="downloads-content">
                    <div style="text-align: center; padding: 2rem;">No tienes canciones descargadas</div>
                </div>
            </section>
        </main>
    </div>

    <nav class="bottom-nav">
        <div class="bottom-nav-item active" id="nav-home"><span class="icon">‚åÇ</span><small>Inicio</small></div>
        <div class="bottom-nav-item" id="nav-search"><span class="icon">‚åï</span><small>Buscar</small></div>
        <div class="bottom-nav-item" id="nav-downloads"><span class="icon">‚Üì</span><small>Descargas</small></div>
        <div class="bottom-nav-item" id="nav-favs"><span class="icon">‚ô°</span><small>Favoritos</small></div>
    </nav>

    <div class="player" id="mini-player">
        <img class="player-img-mini" id="mini-player-img" alt="cover">
        <div class="player-info-mini">
            <div class="player-title-mini" id="mini-player-title"></div>
            <div class="player-artist-mini" id="mini-player-artist"></div>
        </div>
        <div class="player-controls-inline">
            <button class="play-btn-inline" id="mini-play-btn">‚ñ∂</button>
        </div>
    </div>

    <div class="copyright">¬© 2025 KLMZ MUSIC - Desarrollado por Freddy Granados</div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // ========== VARIABLES GLOBALES ==========
        let supabase = null;
        let allAlbums = [];
        let allSongs = [];
        let currentAlbum = null;
        let isPlaying = false;

        const supabaseUrl = 'https://nqbldvpnqhngdtalvzov.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5xYmxkdnBucWhuZ2R0YWx2em92Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUyMjY0NjUsImV4cCI6MjA3MDgwMjQ2NX0.Zzg5D219sW7bhvl0_R5ypX9MF6nRzBSDIeo2Lvebab0';

        console.log('üöÄ KLMZ MUSIC iniciando...');

        // ========== NOTIFICACI√ìN ==========
        function showNotification(message, type = 'info') {
            console.log(`üì¢ ${type.toUpperCase()}: ${message}`);
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed; top: 50px; right: 20px; z-index: 9999;
                background: ${type === 'success' ? '#28a745' : type === 'error' ? '#ff4757' : '#1DB954'};
                color: white; padding: 1rem 1.5rem; border-radius: 8px;
                font-size: 0.9rem; font-weight: bold; min-width: 200px;
                transform: translateX(100%); transition: transform 0.3s ease;
            `;
            document.body.appendChild(notification);
            setTimeout(() => notification.style.transform = 'translateX(0)', 100);
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => { if (document.body.contains(notification)) document.body.removeChild(notification); }, 300);
            }, 3000);
        }

        function showLoadingIndicator(show) {
            document.getElementById('loading-indicator').style.display = show ? 'block' : 'none';
        }

        // ========== INICIALIZAR SUPABASE ==========
        async function initSupabase() {
            try {
                console.log('üîå Conectando a Supabase...');
                showLoadingIndicator(true);
                
                if (!window.supabase) {
                    throw new Error('Supabase no est√° cargado');
                }

                const { createClient } = window.supabase;
                supabase = createClient(supabaseUrl, supabaseKey);
                
                console.log('‚úÖ Supabase conectado');
                return true;
            } catch (error) {
                console.error('‚ùå Error conectando Supabase:', error);
                showNotification('‚ùå Error de conexi√≥n: ' + error.message, 'error');
                return false;
            }
        }

        // ========== CARGAR TUS √ÅLBUMES REALES ==========
        async function loadYourAlbums() {
            try {
                console.log('üìÄ Cargando TUS √°lbumes desde Supabase...');
                
                if (!supabase) {
                    const connected = await initSupabase();
                    if (!connected) {
                        throw new Error('No se pudo conectar a Supabase');
                    }
                }

                // Cargar √°lbumes reales
                console.log('üì° Consultando tabla albums...');
                const { data: albums, error: albumsError } = await supabase
                    .from('albums')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (albumsError) {
                    console.error('‚ùå Error cargando √°lbumes:', albumsError);
                    throw albumsError;
                }

                // Cargar canciones reales
                console.log('üì° Consultando tabla songs...');
                const { data: songs, error: songsError } = await supabase
                    .from('songs')
                    .select('*, albums:album_id(*)')
                    .order('created_at', { ascending: false });

                if (songsError) {
                    console.error('‚ùå Error cargando canciones:', songsError);
                    throw songsError;
                }

                allAlbums = albums || [];
                allSongs = songs || [];

                console.log(`‚úÖ Cargados: ${allAlbums.length} √°lbumes, ${allSongs.length} canciones`);

                if (allAlbums.length === 0) {
                    showNoAlbumsMessage();
                    return;
                }

                displayYourAlbums(allAlbums);
                showNotification(`‚úÖ ${allAlbums.length} de tus √°lbumes cargados`, 'success');

            } catch (error) {
                console.error('‚ùå Error cargando datos:', error);
                showNotification('‚ùå Error: ' + error.message, 'error');
                showErrorMessage(error.message);
            } finally {
                showLoadingIndicator(false);
            }
        }

        // ========== MOSTRAR TUS √ÅLBUMES ==========
        function displayYourAlbums(albums) {
            const container = document.getElementById('albums');
            
            container.innerHTML = albums.map(album => `
                <div class="album-card" onclick="openRealAlbum(${album.id})">
                    <img class="album-img" src="${album.cover_url}" alt="${album.title}" 
                         onerror="this.src='https://via.placeholder.com/100/1DB954/FFFFFF?text=${encodeURIComponent(album.title)}'">
                    <div class="album-title">${album.title}</div>
                    <div class="album-artist">${album.artist}</div>
                </div>
            `).join('');
            
            console.log('‚úÖ Tus √°lbumes mostrados en pantalla');
        }

        function showNoAlbumsMessage() {
            document.getElementById('albums').innerHTML = `
                <div style="text-align: center; padding: 3rem;">
                    <h2>üìÄ No tienes √°lbumes en tu base de datos</h2>
                    <p style="color: #b3b3b3; margin: 1rem 0;">Agrega √°lbumes a tu base de datos de Supabase</p>
                    <button onclick="loadYourAlbums()" style="background: #1DB954; color: #fff; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer;">üîÑ Recargar</button>
                </div>
            `;
        }

        function showErrorMessage(error) {
            document.getElementById('albums').innerHTML = `
                <div style="text-align: center; padding: 3rem;">
                    <h2>‚ùå Error cargando √°lbumes</h2>
                    <p style="color: #ff4757; margin: 1rem 0; font-size: 0.9rem;">${error}</p>
                    <button onclick="loadYourAlbums()" style="background: #1DB954; color: #fff; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer;">üîÑ Reintentar</button>
                </div>
            `;
        }
        // ========== ABRIR √ÅLBUM REAL ==========
        async function openRealAlbum(albumId) {
            try {
                console.log('üìÄ Abriendo tu √°lbum ID:', albumId);
                
                const album = allAlbums.find(a => a.id === albumId);
                if (!album) {
                    showNotification('‚ùå √Ålbum no encontrado', 'error');
                    return;
                }
                
                currentAlbum = album;
                showLoadingIndicator(true);
                
                // Cargar canciones del √°lbum
                console.log('üéµ Cargando canciones del √°lbum...');
                const { data: songs, error } = await supabase
                    .from('songs')
                    .select('*')
                    .eq('album_id', albumId)
                    .order('track_number', { ascending: true });

                if (error) {
                    console.error('‚ùå Error cargando canciones:', error);
                    throw error;
                }

                console.log(`‚úÖ Canciones cargadas: ${songs?.length || 0}`);

                // Ocultar grid y mostrar detalle
                document.getElementById('albums').style.display = 'none';
                const detailDiv = document.getElementById('album-detail');
                detailDiv.style.display = 'block';
                
                detailDiv.innerHTML = `
                    <button class="back-btn" onclick="closeRealAlbum()">‚üµ Volver a √Ålbumes</button>
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <img src="${album.cover_url}" alt="${album.title}" 
                             style="width: 200px; height: 200px; border-radius: 12px; margin-bottom: 1rem;"
                             onerror="this.src='https://via.placeholder.com/200/1DB954/FFFFFF?text=${encodeURIComponent(album.title)}'">
                        <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 0.5rem;">${album.title}</div>
                        <div style="font-size: 1.1rem; color: #b3b3b3;">${album.artist}</div>
                        <div style="font-size: 0.9rem; color: #888; margin-top: 0.5rem;">${songs?.length || 0} canciones</div>
                    </div>
                    <div class="song-list">
                        ${songs && songs.length > 0 ? `
                            <ul>
                                ${songs.map((song, index) => `
                                    <li onclick="playRealSong('${song.id}', '${song.title}', '${song.song_url}')">
                                        <div style="flex: 1;">
                                            <div style="font-weight: 500;">${song.title}</div>
                                            <div style="font-size: 0.9rem; color: #b3b3b3;">
                                                Pista ${song.track_number || index + 1}
                                                ${song.duration ? ' ‚Ä¢ ' + song.duration : ''}
                                            </div>
                                        </div>
                                        <div style="display: flex; gap: 1rem; align-items: center;">
                                            <span onclick="event.stopPropagation(); toggleFavorite('${song.id}', this)" style="cursor: pointer; color: #666;">ü§ç</span>
                                            <div style="color: #1DB954; font-size: 1.2rem;">‚ñ∂</div>
                                        </div>
                                    </li>
                                `).join('')}
                            </ul>
                        ` : '<div style="text-align: center; padding: 2rem; color: #b3b3b3;">No hay canciones en este √°lbum</div>'}
                    </div>
                `;
                
                showNotification('üìÄ ' + album.title + ' abierto', 'success');
                
            } catch (error) {
                console.error('‚ùå Error abriendo √°lbum:', error);
                showNotification('‚ùå Error: ' + error.message, 'error');
            } finally {
                showLoadingIndicator(false);
            }
        }

        // ========== CERRAR √ÅLBUM ==========
        function closeRealAlbum() {
            console.log('‚ùå Cerrando √°lbum');
            document.getElementById('album-detail').style.display = 'none';
            document.getElementById('albums').style.display = 'grid';
            showNotification('‚üµ Volviendo a tus √°lbumes', 'info');
        }

        // ========== REPRODUCIR CANCI√ìN REAL ==========
        function playRealSong(songId, songTitle, songUrl) {
            try {
                console.log('‚ñ∂Ô∏è Reproduciendo tu canci√≥n:', songTitle);
                
                if (!songUrl) {
                    showNotification('‚ùå URL de canci√≥n no disponible', 'error');
                    return;
                }

                // Mostrar mini player
                const player = document.getElementById('mini-player');
                player.style.display = 'flex';
                
                document.getElementById('mini-player-img').src = currentAlbum.cover_url;
                document.getElementById('mini-player-title').textContent = songTitle;
                document.getElementById('mini-player-artist').textContent = currentAlbum.artist;
                
                const playBtn = document.getElementById('mini-play-btn');
                playBtn.textContent = '‚è∏';
                isPlaying = true;
                
                // Aqu√≠ podr√≠as agregar el c√≥digo para reproducir realmente el audio
                // const audio = new Audio(songUrl);
                // audio.play();
                
                showNotification('üéµ Reproduciendo: ' + songTitle, 'success');
                
            } catch (error) {
                console.error('‚ùå Error reproduciendo:', error);
                showNotification('‚ùå Error reproduciendo: ' + error.message, 'error');
            }
        }

        // ========== FAVORITOS ==========
        function toggleFavorite(songId, element) {
            try {
                const favorites = JSON.parse(localStorage.getItem('klmz_favorites') || '[]');
                const isFavorite = favorites.includes(songId);
                
                if (isFavorite) {
                    const index = favorites.indexOf(songId);
                    favorites.splice(index, 1);
                    element.textContent = 'ü§ç';
                    element.style.color = '#666';
                    showNotification('üíî Removido de favoritos', 'info');
                } else {
                    favorites.push(songId);
                    element.textContent = '‚ù§Ô∏è';
                    element.style.color = '#1DB954';
                    showNotification('‚ù§Ô∏è Agregado a favoritos', 'success');
                }
                
                localStorage.setItem('klmz_favorites', JSON.stringify(favorites));
                
            } catch (error) {
                console.error('‚ùå Error con favoritos:', error);
                showNotification('‚ùå Error con favoritos', 'error');
            }
        }

        // ========== TEMAS ==========
        function changeTheme(themeName) {
            console.log('üé® Cambiando tema a:', themeName);
            const body = document.body;
            body.classList.remove('theme-neon', 'theme-minimal', 'theme-sunset', 'theme-pastel', 'theme-luxury');
            if (themeName && themeName !== 'default') {
                body.classList.add('theme-' + themeName);
            }
            localStorage.setItem('klmz_theme', themeName);
            showNotification('üé® Tema ' + (themeName === 'default' ? 'Default' : themeName) + ' aplicado', 'success');
        }

        function loadSavedTheme() {
            try {
                const savedTheme = localStorage.getItem('klmz_theme') || 'default';
                document.getElementById('theme-select').value = savedTheme;
                changeTheme(savedTheme);
            } catch (error) {
                console.error('Error cargando tema:', error);
                changeTheme('default');
            }
        }

        // ========== NAVEGACI√ìN ==========
        function showSection(sectionName) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionName + '-section').classList.add('active');
            
            document.querySelectorAll('.bottom-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            const navMap = { 'home': 'nav-home', 'search': 'nav-search', 'downloads': 'nav-downloads', 'favorites': 'nav-favs' };
            if (navMap[sectionName]) {
                document.getElementById(navMap[sectionName]).classList.add('active');
            }
            
            if (sectionName === 'home') {
                closeRealAlbum();
            }
            
            showNotification('üì± ' + sectionName.charAt(0).toUpperCase() + sectionName.slice(1), 'info');
        }

        // ========== PLAYER CONTROLS ==========
        function togglePlay() {
            const playBtn = document.getElementById('mini-play-btn');
            if (isPlaying) {
                playBtn.textContent = '‚ñ∂';
                isPlaying = false;
                showNotification('‚è∏ Pausado', 'info');
            } else {
                playBtn.textContent = '‚è∏';
                isPlaying = true;
                showNotification('‚ñ∂Ô∏è Reproduciendo', 'info');
            }
        }

        // ========== B√öSQUEDA EN TUS DATOS ==========
        function searchInYourMusic() {
            const query = document.getElementById('search-input').value.trim().toLowerCase();
            const resultsDiv = document.getElementById('search-results');
            
            if (!query) {
                resultsDiv.innerHTML = '';
                return;
            }
            
            console.log('üîç Buscando en tus datos:', query);
            
            const foundAlbums = allAlbums.filter(album => 
                album.title.toLowerCase().includes(query) ||
                album.artist.toLowerCase().includes(query)
            );
            
            const foundSongs = allSongs.filter(song => 
                song.title.toLowerCase().includes(query) ||
                (song.albums && song.albums.artist && song.albums.artist.toLowerCase().includes(query))
            );
            
            let html = '';
            
            if (foundAlbums.length > 0) {
                html += '<h3>üìÄ Tus √°lbumes encontrados</h3>';
                foundAlbums.forEach(album => {
                    html += `
                        <div style="background: #242424; padding: 1rem; margin: 0.5rem 0; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 1rem;"
                             onclick="openRealAlbum(${album.id})">
                            <img src="${album.cover_url}" alt="${album.title}" style="width: 50px; height: 50px; border-radius: 8px;">
                            <div>
                                <div style="font-weight: bold;">${album.title}</div>
                                <div style="color: #b3b3b3; font-size: 0.9rem;">${album.artist}</div>
                            </div>
                        </div>
                    `;
                });
            }
            
            if (foundSongs.length > 0) {
                html += '<h3>üéµ Tus canciones encontradas</h3>';
                foundSongs.forEach(song => {
                    html += `
                        <div style="background: #242424; padding: 1rem; margin: 0.5rem 0; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 1rem;"
                             onclick="playRealSong('${song.id}', '${song.title}', '${song.song_url}')">
                            <div style="width: 50px; height: 50px; background: #1DB954; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">‚ô™</div>
                            <div style="flex: 1;">
                                <div style="font-weight: bold;">${song.title}</div>
                                <div style="color: #b3b3b3; font-size: 0.9rem;">${song.albums?.artist || 'Desconocido'}</div>
                            </div>
                            <div style="color: #1DB954; font-size: 1.2rem;">‚ñ∂</div>
                        </div>
                    `;
                });
            }
            
            if (foundAlbums.length === 0 && foundSongs.length === 0) {
                html = '<div style="text-align: center; padding: 2rem; color: #b3b3b3;">No se encontraron resultados en tus datos para "' + query + '"</div>';
            }
            
            resultsDiv.innerHTML = html;
            showNotification('üîç B√∫squeda: ' + (foundAlbums.length + foundSongs.length) + ' resultados', 'info');
        }

        // ========== INICIALIZACI√ìN PRINCIPAL ==========
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üöÄ KLMZ MUSIC iniciando...');
            
            try {
                // 1. Cargar tema
                loadSavedTheme();
                
                // 2. Cargar TUS datos reales
                await loadYourAlbums();
                
                // 3. Event listeners
                document.getElementById('theme-select').addEventListener('change', function() {
                    changeTheme(this.value);
                });
                
                document.getElementById('nav-home').addEventListener('click', () => showSection('home'));
                document.getElementById('nav-search').addEventListener('click', () => showSection('search'));
                document.getElementById('nav-downloads').addEventListener('click', () => showSection('downloads'));
                document.getElementById('nav-favs').addEventListener('click', () => showSection('favorites'));
                
                document.getElementById('search-input').addEventListener('input', searchInYourMusic);
                document.getElementById('mini-play-btn').addEventListener('click', togglePlay);
                
                // Estado de conexi√≥n
                function updateConnectionStatus() {
                    const status = document.getElementById('connection-status');
                    const text = document.getElementById('connection-text');
                    if (navigator.onLine) {
                        status.classList.remove('offline');
                        text.textContent = 'üåê En l√≠nea';
                    } else {
                        status.classList.add('offline');
                        text.textContent = 'üì± Modo offline';
                    }
                }
                
                updateConnectionStatus();
                window.addEventListener('online', updateConnectionStatus);
                window.addEventListener('offline', updateConnectionStatus);
                
                console.log('‚úÖ KLMZ MUSIC inicializado - CONECTADO A TU BASE DE DATOS');
                
            } catch (error) {
                console.error('‚ùå Error en inicializaci√≥n:', error);
                showNotification('‚ùå Error inicializando: ' + error.message, 'error');
            }
        });

        // ========== FUNCIONES GLOBALES ==========
        window.openRealAlbum = openRealAlbum;
        window.closeRealAlbum = closeRealAlbum;
        window.playRealSong = playRealSong;
        window.toggleFavorite = toggleFavorite;
        window.togglePlay = togglePlay;
        window.showSection = showSection;
        window.changeTheme = changeTheme;
        window.searchInYourMusic = searchInYourMusic;
        window.loadYourAlbums = loadYourAlbums;

        console.log('üì± KLMZ Music - CONECTADO A TUS DATOS REALES DE SUPABASE');
    </script>
</body>
</html>
