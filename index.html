<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>KLMZ MUSIC - Simple</title>
    <style>
        body { 
            background: #181818; 
            color: white; 
            font-family: Arial, sans-serif; 
            padding: 20px; 
        }
        .theme-selector { 
            margin-bottom: 20px; 
        }
        select { 
            background: #333; 
            color: white; 
            padding: 10px; 
            border: none; 
            border-radius: 5px; 
        }
        .album { 
            background: #333; 
            margin: 10px; 
            padding: 20px; 
            border-radius: 10px; 
            cursor: pointer; 
        }
        .album:hover { 
            background: #444; 
        }
        .songs { 
            display: none; 
            margin-top: 20px; 
        }
        .song { 
            background: #444; 
            margin: 5px 0; 
            padding: 10px; 
            border-radius: 5px; 
            cursor: pointer; 
        }
        .song:hover { 
            background: #555; 
        }
        .back-btn { 
            background: #1DB954; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 5px; 
            cursor: pointer; 
            margin-bottom: 20px; 
        }
        
        /* TEMAS */
        body.neon { 
            background: linear-gradient(45deg, #0a0a0a, #1a1a2e); 
        }
        body.neon h1 { 
            color: #00ff88; 
            text-shadow: 0 0 10px #00ff88; 
        }
        body.minimal { 
            background: #0f0f0f; 
            color: #f5f5f5; 
        }
        body.sunset { 
            background: linear-gradient(45deg, #2c1810, #4a2c2a); 
            color: #ffab91; 
        }
        body.luxury { 
            background: linear-gradient(45deg, #0f1419, #2c3e50); 
            color: #f0f8ff; 
        }
        body.luxury h1 { 
            color: #d4af37; 
        }
    </style>
</head>
<body>
    <h1>KLMZ MUSIC</h1>
    
    <div class="theme-selector">
        <select onchange="changeTheme(this.value)">
            <option value="">Default</option>
            <option value="neon">Neon</option>
            <option value="minimal">Minimal</option>
            <option value="sunset">Sunset</option>
            <option value="luxury">Luxury</option>
        </select>
    </div>

    <div id="albums-view">
        <h2>√Ålbumes</h2>
        <div id="albums-list">
            <p>Cargando...</p>
        </div>
    </div>

    <div id="album-detail" style="display: none;">
        <button class="back-btn" onclick="showAlbums()">‚üµ Volver</button>
        <div id="album-info"></div>
        <div id="songs-list"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        let supabase = null;
        let albums = [];

        // CAMBIO DE TEMA - FUNCIONA
        function changeTheme(theme) {
            document.body.className = theme;
            console.log('Tema cambiado a:', theme);
        }

        // CONECTAR SUPABASE
        async function connectSupabase() {
            try {
                const { createClient } = window.supabase;
                supabase = createClient(
                    'https://nqbldvpnqhngdtalvzov.supabase.co',
                    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5xYmxkdnBucWhuZ2R0YWx2em92Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUyMjY0NjUsImV4cCI6MjA3MDgwMjQ2NX0.Zzg5D219sW7bhvl0_R5ypX9MF6nRzBSDIeo2Lvebab0'
                );
                console.log('‚úÖ Supabase conectado');
                return true;
            } catch (error) {
                console.error('‚ùå Error Supabase:', error);
                return false;
            }
        }

        // CARGAR √ÅLBUMES
        async function loadAlbums() {
            try {
                console.log('üì° Cargando √°lbumes...');
                
                const { data, error } = await supabase
                    .from('albums')
                    .select('*');

                if (error) {
                    console.error('Error:', error);
                    document.getElementById('albums-list').innerHTML = 
                        '<p style="color: red;">Error: ' + error.message + '</p>';
                    return;
                }

                albums = data || [];
                console.log('√Ålbumes cargados:', albums.length);

                if (albums.length === 0) {
                    document.getElementById('albums-list').innerHTML = 
                        '<p>No hay √°lbumes en tu base de datos</p>';
                    return;
                }

                // MOSTRAR √ÅLBUMES
                let html = '';
                albums.forEach(album => {
                    html += `
                        <div class="album" onclick="openAlbum(${album.id})">
                            <h3>${album.title}</h3>
                            <p>${album.artist}</p>
                        </div>
                    `;
                });
                document.getElementById('albums-list').innerHTML = html;

            } catch (error) {
                console.error('‚ùå Error cargando:', error);
                document.getElementById('albums-list').innerHTML = 
                    '<p style="color: red;">Error: ' + error.message + '</p>';
            }
        }

        // ABRIR √ÅLBUM - FUNCIONA
        async function openAlbum(albumId) {
            try {
                console.log('üìÄ Abriendo √°lbum:', albumId);
                
                const album = albums.find(a => a.id === albumId);
                if (!album) {
                    alert('√Ålbum no encontrado');
                    return;
                }

                // Cargar canciones
                const { data: songs, error } = await supabase
                    .from('songs')
                    .select('*')
                    .eq('album_id', albumId);

                if (error) {
                    console.error('Error cargando canciones:', error);
                }

                // MOSTRAR DETALLE
                document.getElementById('albums-view').style.display = 'none';
                document.getElementById('album-detail').style.display = 'block';
                
                document.getElementById('album-info').innerHTML = `
                    <h2>${album.title}</h2>
                    <p>Por: ${album.artist}</p>
                `;

                if (songs && songs.length > 0) {
                    let songsHtml = '<h3>Canciones:</h3>';
                    songs.forEach(song => {
                        songsHtml += `
                            <div class="song" onclick="playSong('${song.title}')">
                                ${song.title}
                            </div>
                        `;
                    });
                    document.getElementById('songs-list').innerHTML = songsHtml;
                } else {
                    document.getElementById('songs-list').innerHTML = 
                        '<p>No hay canciones en este √°lbum</p>';
                }

                console.log('‚úÖ √Ålbum abierto:', album.title);

            } catch (error) {
                console.error('‚ùå Error abriendo √°lbum:', error);
                alert('Error: ' + error.message);
            }
        }

        // VOLVER A √ÅLBUMES
        function showAlbums() {
            document.getElementById('album-detail').style.display = 'none';
            document.getElementById('albums-view').style.display = 'block';
            console.log('‚üµ Volviendo a √°lbumes');
        }

        // REPRODUCIR CANCI√ìN
        function playSong(title) {
            alert('üéµ Reproduciendo: ' + title);
            console.log('üéµ Reproduciendo:', title);
        }

        // INICIALIZAR
        window.onload = async function() {
            console.log('üöÄ Iniciando KLMZ MUSIC...');
            
            const connected = await connectSupabase();
            if (connected) {
                await loadAlbums();
            } else {
                document.getElementById('albums-list').innerHTML = 
                    '<p style="color: red;">No se pudo conectar a la base de datos</p>';
            }
        };

        // Hacer funciones globales
        window.openAlbum = openAlbum;
        window.showAlbums = showAlbums;
        window.playSong = playSong;
        window.changeTheme = changeTheme;

        console.log('üì± KLMZ Music - Versi√≥n Simple Cargada');
    </script>
</body>
</html>
