<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>KLMZ MUSIC</title>
<meta name="description" content="KLMZ MUSIC - Tu plataforma de mÃºsica personal" />
<meta name="theme-color" content="#1db954" />
<link rel="manifest" href="manifest.json">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
if ('serviceWorker' in navigator) {
Â  window.addEventListener('load', () => {
Â  Â  navigator.serviceWorker.register('sw.js')
Â  Â  Â  .then(registration => {
Â  Â  Â  Â  console.log('âœ… Service Worker registrado:', registration);
Â  Â  Â  })
Â  Â  Â  .catch(error => {
Â  Â  Â  Â  console.log('âŒ Error registrando Service Worker:', error);
Â  Â  Â  });
Â  });
}
</script>
<style>
Â  :root{--bg:#121212;--panel:#181818;--panel2:#1f1f1f;--text:#fff;--muted:#b3b3b3;--brand:#1db954;--brand-hover:#17a84b;--stroke:#2a2a2a;--accent:#ff6b35;--error:#ff4444;--warning:#ffab00;--success:#4caf50;}
Â  *{box-sizing:border-box}
Â  body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;padding-bottom:55px;overflow-x:hidden}
Â  @keyframes fadeIn{from{opacity:0}to{opacity:1}}
Â  @keyframes slideUp{from{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}
Â  @keyframes slideDown{from{transform:translateY(0);opacity:1}to{transform:translateY(100px);opacity:0}}
Â  @keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
Â  @keyframes wave{0%,40%,100%{height:15px;background:linear-gradient(to top,var(--brand),var(--accent))}20%{height:35px;background:linear-gradient(to top,var(--accent),#ffab00)}}
Â  @keyframes bounce{0%,20%,50%,80%,100%{transform:translateY(0)}40%{transform:translateY(-10px)}60%{transform:translateY(-5px)}}
Â  .fade-in{animation:fadeIn 0.5s ease}
Â  .slide-up{animation:slideUp 0.3s ease}
Â  .slide-down{animation:slideDown 0.3s ease}
Â  .bounce{animation:bounce 1s}
Â  .loading{position:fixed;inset:0;background:var(--bg);display:flex;align-items:center;justify-content:center;flex-direction:column;z-index:9999;transition:opacity 0.3s ease}
Â  .loading .spinner{width:50px;height:50px;border:3px solid var(--stroke);border-top:3px solid var(--brand);border-radius:50%;animation:spin 1s linear infinite}
Â  .loading .text{margin-top:20px;color:var(--muted);font-weight:600}
Â  .gesture-hint{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.8);color:white;padding:12px 20px;border-radius:25px;font-size:14px;z-index:1000;opacity:0;pointer-events:none;transition:opacity 0.3s ease}
Â  .gesture-hint.show{opacity:1}
Â  header{position:sticky;top:0;z-index:10;background:linear-gradient(180deg,#1db954 0%,#1db954 60%,#179b47 100%);padding:14px 18px;font-weight:800;letter-spacing:.3px;backdrop-filter:blur(10px)}
Â  header .row{display:flex;align-items:center;gap:12px;justify-content:space-between}
Â  .brand{font-size:20px;display:flex;align-items:center;gap:8px;transition:transform 0.3s ease}
Â  .brand:hover{transform:scale(1.05)}
Â  .brand .logo{display:inline-grid;place-items:center;width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,#ff6b35,#ff4500);font-weight:900;color:#fff;font-size:16px;transition:all 0.3s ease}
Â  .brand .logo:hover{transform:rotate(360deg)}
Â  .tools{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
Â  .btn{background:var(--brand);border:none;color:#fff;padding:10px 14px;border-radius:8px;cursor:pointer;font-weight:600;transition:all 0.3s ease}
Â  .btn:hover{background:var(--brand-hover);transform:translateY(-2px);box-shadow:0 4px 8px rgba(29,185,84,0.3)}
Â  .btn.ghost{background:transparent;border:1px solid #fff1}
Â  .btn.small{padding:6px 10px;font-size:12px}
Â  .btn.danger{background:var(--error)}
Â  .btn.danger:hover{background:#cc0000}
Â  .btn.warning{background:var(--warning);color:#000}
Â  .btn.warning:hover{background:#f57f17;transform:translateY(-2px)}
Â  .icon-btn{background:transparent;border:1px solid #ffffff22;color:#fff;padding:8px 10px;border-radius:10px;cursor:pointer;font-size:18px;line-height:1;transition:all 0.3s ease}
Â  .icon-btn:hover{background:#ffffff14;transform:scale(1.1)}
Â  .container{padding:18px;max-width:1100px;margin:auto}
Â  .card{background:var(--panel);border:1px solid var(--stroke);border-radius:14px;padding:14px;transition:all 0.3s ease}
Â  .grid{display:grid;gap:16px}
Â  .grid.albums{grid-template-columns:repeat(auto-fill,minmax(90px,1fr))}
Â  .grid.playlists{grid-template-columns:repeat(auto-fill,minmax(90px,1fr))}
Â  .album-card,.playlist-card{background:transparent;border:none;padding:8px;cursor:pointer;text-align:center;transition:.3s all ease;border-radius:12px}
Â  .album-card:hover,.playlist-card:hover{transform:translateY(-4px) scale(1.02);background:var(--panel)}
Â  .album-cover{width:100%;aspect-ratio:1/1;object-fit:cover;background:#0b0b0b;border:1px solid var(--stroke);transition:all 0.3s ease;border-radius:50%}
Â  .album-cover:hover{transform:scale(1.05);box-shadow:0 4px 12px rgba(29,185,84,0.3)}
Â  .playlist-cover{width:100%;aspect-ratio:1/1;object-fit:cover;background:linear-gradient(135deg,var(--brand),var(--accent));border:1px solid var(--stroke);transition:all 0.3s ease;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:2rem}
Â  .playlist-cover:hover{transform:scale(1.05);box-shadow:0 4px 12px rgba(29,185,84,0.3)}
Â  .album-title,.playlist-title{margin:8px 2px 0;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-size:.92rem}
Â  .album-meta,.playlist-meta{margin:0;color:var(--muted);font-size:.78rem}
Â  .muted{color:var(--muted)}
Â  .section-title{margin:6px 2px 12px;font-size:1.1rem;font-weight:800;letter-spacing:.2px;position:relative}
Â  .section-title::before{content:'';position:absolute;bottom:-4px;left:0;width:30px;height:2px;background:var(--brand);border-radius:2px}
Â  .inputs{display:grid;grid-template-columns:1fr 1fr;gap:10px}
Â  input[type="text"],input[type="email"],input[type="password"],select,textarea{width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--stroke);background:#101010;color:#fff;transition:all 0.3s ease}
Â  input:focus,select:focus,textarea:focus{outline:none;border-color:var(--brand);box-shadow:0 0 0 2px rgba(29,185,84,0.2)}
Â  input[type="file"]{width:100%;padding:10px;border-radius:10px;border:1px dashed var(--stroke);background:#0f0f0f;color:var(--muted)}
Â  .stack{display:grid;gap:10px}
Â  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
Â  .pill{padding:6px 10px;border-radius:999px;background:#ffffff10;border:1px solid var(--stroke);font-size:.8rem;color:#fff}
Â  .music-controls{display:flex;align-items:center;gap:12px;margin-bottom:12px;flex-wrap:wrap}
Â  .control-btn{background:var(--panel);border:1px solid var(--stroke);color:var(--muted);padding:8px 12px;border-radius:20px;cursor:pointer;font-size:12px;transition:all 0.3s ease;display:flex;align-items:center;gap:6px}
Â  .control-btn:hover{background:var(--brand);color:white;transform:scale(1.05)}
Â  .control-btn.active{background:var(--brand);color:white}
Â  .favorite-btn{background:none;border:none;color:var(--muted);cursor:pointer;font-size:18px;transition:all 0.3s ease;padding:4px;border-radius:50%}
Â  .favorite-btn:hover{color:#ff4444;transform:scale(1.2)}
Â  .favorite-btn.active{color:#ff4444}
Â  .download-btn{background:var(--success);border:none!important;outline:none!important;box-shadow:none!important;color:white;padding:6px 10px;border-radius:15px;cursor:pointer;font-size:11px;transition:all 0.3s ease;display:flex;align-items:center;gap:4px}
Â  .download-btn:hover{background:#45a049;transform:scale(1.05)}
Â  .download-btn.downloaded{background:var(--muted);cursor:default}
Â  .download-btn:focus{border:none!important;outline:none!important;box-shadow:none!important}
Â  .delete-song-btn{background:var(--error);border:none;color:white;padding:6px 10px;border-radius:15px;cursor:pointer;font-size:11px;transition:all 0.3s ease;display:flex;align-items:center;gap:4px}
Â  .delete-song-btn:hover{background:#cc0000;transform:scale(1.05)}
Â  .playlist-btn{background:var(--accent);border:none!important;outline:none!important;box-shadow:none!important;color:white;padding:6px 10px;border-radius:15px;cursor:pointer;font-size:11px;transition:all 0.3s ease;display:flex;align-items:center;gap:4px}
Â  .playlist-btn:hover{background:#e55722;transform:scale(1.05)}
Â  .playlist-btn:focus{border:none!important;outline:none!important;box-shadow:none!important}
Â  .download-progress{width:100%;height:4px;background:var(--stroke);border-radius:2px;overflow:hidden;margin-top:4px}
Â  .download-progress-bar{height:100%;background:var(--success);transition:width 0.3s ease;border-radius:2px}
Â  #albumView,#favoritesView,#downloadsView,#playlistsView,#playlistView,#searchView{display:none}
Â  .album-hero,.playlist-hero{display:flex;gap:14px;align-items:center;margin-bottom:20px}
Â  .album-hero img,.playlist-hero img{width:96px;height:96px;border-radius:12px;border:1px solid var(--stroke);object-fit:cover;background:#0b0b0b}
Â  .album-hero .info,.playlist-hero .info{min-width:0;flex:1}
Â  .album-hero .title,.playlist-hero .title{font-size:1.2rem;font-weight:900}
Â  .album-hero .meta,.playlist-hero .meta{color:var(--muted);font-size:.9rem}
Â  .playlist-hero img{background:linear-gradient(135deg,var(--brand),var(--accent));display:flex;align-items:center;justify-content:center;font-size:3rem}
Â  .song-plain-list{margin-top:8px}
Â  .song-plain-item{padding:12px 8px;border-bottom:1px solid #1f1f1f;display:flex;align-items:center;gap:12px;transition:all 0.3s ease;border-radius:8px;margin-bottom:2px;cursor:pointer;position:relative}
Â  .song-plain-item:last-child{border-bottom:none}
Â  .song-plain-item:hover{background:var(--panel);transform:translateX(4px)}
Â  .song-plain-item .idx{min-width:20px;text-align:right;color:var(--muted)}
Â  .song-plain-item .title{flex:1;font-weight:600}
Â  .song-plain-item .actions{display:flex;gap:6px;align-items:center;flex-wrap:wrap}
Â  .song-plain-item .more{font-size:18px;color:var(--muted);cursor:pointer;padding:6px;border-radius:50%;transition:all 0.3s ease}
Â  .song-plain-item .more:hover{background:#ffffff14;transform:scale(1.2)}
Â  .backline{display:flex;align-items:center;gap:10px;margin-bottom:20px}
Â  .back-btn{background:transparent;border:1px solid #ffffff22;color:#fff;width:36px;height:36px;border-radius:10px;font-size:18px;display:grid;place-items:center;cursor:pointer;transition:all 0.3s ease}
Â  .back-btn:hover{background:#ffffff14;transform:scale(1.1)}
Â  .player{position:fixed;left:0;right:0;bottom:55px;background:linear-gradient(135deg,#181818,#1f1f1f);border-top:1px solid var(--stroke);padding:8px 12px;z-index:20;display:none;height:60px;cursor:pointer;transition:all 0.3s ease}
Â  .player.show{display:flex;align-items:center;gap:12px}
Â  .player:hover{background:linear-gradient(135deg,#222,#2a2a2a)}
Â  .np{display:flex;align-items:center;gap:8px;min-width:0;flex:1;padding:4px;border-radius:8px;transition:all 0.3s ease}
Â  .np img{width:44px;height:44px;border-radius:8px;border:1px solid var(--stroke);object-fit:cover;background:#0b0b0b}
Â  .np .titles{min-width:0;flex:1}
Â  .np .titles .t{font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-size:.9rem;line-height:1.2}
Â  .np .titles .a{color:var(--muted);font-size:.75rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;line-height:1.1;margin-top:2px}
Â  .player-controls{display:flex;align-items:center;gap:8px}
Â  .player-controls .circle{width:36px;height:36px;border-radius:50%;display:grid;place-items:center;border:1px solid var(--stroke);background:linear-gradient(135deg,#222,#333);font-size:16px;font-weight:900;cursor:pointer;transition:all 0.3s ease}
Â  .player-controls .circle:hover{transform:scale(1.1);background:var(--brand)}
Â  .player-controls .sm{width:32px;height:32px;font-size:14px}
Â  .player-seek{display:flex;align-items:center;gap:6px;min-width:120px}
Â  .player-seek input[type="range"]{width:100px;height:4px}
Â  .player-seek .time{font-size:.7rem;color:var(--muted);min-width:32px;text-align:center}
Â  .vol{display:flex;align-items:center;gap:6px;min-width:80px}
Â  .vol span{font-size:.7rem;color:var(--muted)}
Â  .vol input[type="range"]{width:60px;height:4px}
Â  .tag{padding:4px 8px;border:1px solid var(--stroke);border-radius:8px;font-size:.8rem;color:var(--muted)}
Â  .search-songs-list{display:flex;flex-direction:column;gap:8px}
Â  .search-song-item{display:flex;align-items:center;gap:12px;padding:8px 12px;border-radius:8px;cursor:pointer;transition:all 0.3s ease}
Â  .search-song-item:hover{background:var(--panel);transform:translateX(4px)}
Â  .search-song-cover{width:48px;height:48px;border-radius:8px;object-fit:cover;background:#0b0b0b;border:1px solid var(--stroke)}
Â  .search-song-info{flex:1;min-width:0}
Â  .search-song-title{font-weight:600;font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:2px}
Â  .search-song-artist{color:var(--muted);font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
Â  .search-song-actions{display:flex;gap:8px;align-items:center}
Â  .search-song-play{background:var(--brand);border:none;color:white;width:32px;height:32px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:14px;transition:all 0.3s ease}
Â  .search-song-play:hover{background:var(--brand-hover);transform:scale(1.1)}
Â  .no-results{text-align:center;color:var(--muted);padding:40px 20px;font-size:16px}
Â  #bottomBar{position:fixed;bottom:0;left:0;width:100%;height:55px;background:linear-gradient(135deg,var(--panel2),#252525);border-top:1px solid var(--stroke);display:grid;grid-template-columns:1fr 1fr 1fr 1fr;place-items:center;padding:4px 12px 2px;z-index:40}
Â  #bottomBar button{background:transparent;border:none;color:var(--muted);cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:2px;font-size:9px;font-weight:500;text-transform:uppercase;letter-spacing:0.3px;user-select:none;transition:all 0.3s ease;padding:6px;border-radius:8px;position:relative}
Â  #bottomBar button.active,#bottomBar button:hover{color:var(--brand);transform:translateY(-2px)}
Â  #bottomBar .icon{width:22px;height:22px;stroke:currentColor;stroke-width:2;fill:none}
Â  #bottomBar .label{font-size:9px;font-weight:600;margin-top:1px}
Â  .soundwave{width:80px;height:30px;display:flex;align-items:center;gap:3px}
Â  .bar{width:4px;height:12px;background:linear-gradient(to top,var(--brand),var(--accent));border-radius:2px;animation:wave 1.2s infinite ease-in-out;animation-fill-mode:both}
Â  .bar:nth-child(1){animation-delay:-1.1s}
Â  .bar:nth-child(2){animation-delay:-0.9s}
Â  .bar:nth-child(3){animation-delay:-0.7s}
Â  .bar:nth-child(4){animation-delay:-0.5s}
Â  .bar:nth-child(5){animation-delay:-0.3s}
Â  .status-indicator{position:fixed;top:80px;right:20px;z-index:100}
Â  .error-msg{background:linear-gradient(135deg,var(--error),#cc0000);color:white;padding:12px 16px;border-radius:8px;font-size:12px;font-weight:600}
Â  .success-msg{background:linear-gradient(135deg,var(--success),#2e7d32);color:white;padding:12px 16px;border-radius:8px;font-size:12px;font-weight:600}
Â  .warning-msg{background:linear-gradient(135deg,var(--warning),#f57f17);color:black;padding:12px 16px;border-radius:8px;font-size:12px;font-weight:600}
Â  #npOverlay{position:fixed;inset:0;background:rgba(0,0,0,0.9);backdrop-filter:blur(20px);display:none;align-items:center;justify-content:center;z-index:40;animation:fadeIn 0.4s ease;transition:opacity 0.3s ease}
Â  #npCard{background:linear-gradient(135deg,#111,#222);border:1px solid var(--stroke);border-radius:18px;width:min(420px,90vw);padding:20px;display:grid;gap:12px;justify-items:center;animation:slideUp 0.4s ease}
Â  #npCard img{width:min(320px,80vw);height:min(320px,80vw);border-radius:14px;object-fit:cover;border:1px solid var(--stroke);background:#0b0b0b;transition:all 0.5s ease;cursor:pointer;touch-action:manipulation}
Â  #npCard img:hover{transform:scale(1.02)}
Â  #npCard .t{font-size:1.1rem;font-weight:900;text-align:center}
Â  #npCard .a{color:var(--muted);text-align:center;font-size:.9rem}
Â  .controls{display:flex;flex-direction:column;gap:10px}
Â  .controls .buttons{display:flex;align-items:center;justify-content:center;gap:18px}
Â  .controls .buttons .circle{width:64px;height:64px;border-radius:50%;display:grid;place-items:center;border:1px solid var(--stroke);background:linear-gradient(135deg,#222,#333);font-size:26px;font-weight:900;cursor:pointer;transition:all 0.3s ease}
Â  .controls .buttons .circle:hover{transform:scale(1.1)}
Â  .controls .buttons .sm{width:52px;height:52px;font-size:22px}
Â  .controls .seek{display:flex;align-items:center;gap:10px}
Â  .controls input[type="range"]{width:100%}
Â  .playlist-modal{position:fixed;inset:0;background:rgba(0,0,0,0.8);display:none;align-items:center;justify-content:center;z-index:50;animation:fadeIn 0.3s ease}
Â  .playlist-modal-content{background:var(--panel);border-radius:16px;padding:20px;width:min(400px,90vw);max-height:80vh;overflow-y:auto}
Â  .playlist-grid{display:grid;gap:8px;margin-top:12px;max-height:300px;overflow-y:auto}
Â  .playlist-item{display:flex;align-items:center;gap:12px;padding:8px;border-radius:8px;cursor:pointer;transition:all 0.3s ease}
Â  .playlist-item:hover{background:var(--panel2)}
Â  .playlist-item img{width:40px;height:40px;border-radius:6px;background:linear-gradient(135deg,var(--brand),var(--accent));display:flex;align-items:center;justify-content:center;color:white;font-size:16px}
Â  .playlist-item .info{flex:1}
Â  .playlist-item .name{font-weight:600;font-size:14px}
Â  .playlist-item .count{color:var(--muted);font-size:12px}
Â  @media (max-width:600px){
Â  Â  .player{padding:6px 8px;height:56px}
Â  Â  .np img{width:40px;height:40px}
Â  Â  .np .titles .t{font-size:.8rem}
Â  Â  .np .titles .a{font-size:.7rem}
Â  Â  .player-controls .circle{width:32px;height:32px;font-size:14px}
Â  Â  .player-controls .sm{width:28px;height:28px;font-size:12px}
Â  Â  .player-seek{min-width:100px}
Â  Â  .player-seek input[type="range"]{width:80px}
Â  Â  .vol{min-width:60px}
Â  Â  .vol input[type="range"]{width:40px}
Â  Â  .player-seek .time{font-size:.65rem;min-width:28px}
Â  Â  .vol span{font-size:.65rem}
Â  Â  .inputs{grid-template-columns:1fr}
Â  Â  .controls .buttons .circle{width:58px;height:58px;font-size:24px}
Â  Â  .controls .buttons .sm{width:48px;height:48px;font-size:18px}
Â  Â  .song-plain-item .actions{flex-direction:column;gap:4px}
Â  Â  .grid.playlists{grid-template-columns:repeat(auto-fill,minmax(80px,1fr))}
Â  Â  #bottomBar{height:50px;padding:3px 10px 2px}
Â  Â  #bottomBar .icon{width:20px;height:20px}
Â  Â  #bottomBar .label{font-size:8px}
Â  Â  #bottomBar button{padding:5px;gap:1px}
Â  Â  #npCard{width:min(380px,95vw);padding:16px;gap:10px}
Â  Â  #npCard img{width:min(280px,75vw);height:min(280px,75vw)}
Â  Â  #npCard .t{font-size:1rem}
Â  Â  #npCard .a{font-size:.85rem}
Â  }
Â  @media (max-width:400px){
Â  Â  .player{flex-wrap:wrap;height:auto;padding:6px}
Â  Â  .np{order:1;width:100%;margin-bottom:4px}
Â  Â  .player-controls{order:2}
Â  Â  .player-seek{order:3;flex:1}
Â  Â  .vol{order:4}
Â  Â  #bottomBar{height:48px;padding:2px 8px 1px}
Â  Â  #bottomBar .icon{width:18px;height:18px}
Â  Â  #bottomBar .label{font-size:7px}
Â  Â  #bottomBar button{padding:4px;gap:1px}
Â  Â  #npCard{width:min(350px,98vw);padding:14px;gap:8px}
Â  Â  #npCard img{width:min(250px,72vw);height:min(250px,72vw)}
Â  Â  #npCard .t{font-size:.95rem}
Â  Â  #npCard .a{font-size:.8rem}
Â  Â  .controls .buttons .circle{width:52px;height:52px;font-size:22px}
Â  Â  .controls .buttons .sm{width:42px;height:42px;font-size:16px}
Â  }
</style>
</head>

<body>
<div id="loadingScreen" class="loading">
Â  <div class="spinner"></div>
Â  <div class="text">Cargando KLMZ MUSIC...</div>
</div>
<div id="gestureHint" class="gesture-hint"></div>
<header>
Â  <div class="row">
Â  Â  <div class="brand">
Â  Â  Â  <span class="logo">ğŸ”¥</span>Â 
Â  Â  Â  KLMZ MUSIC
Â  Â  </div>
Â  Â  <div class="tools">
Â  Â  Â  <span class="muted" id="albumsTitle">Tu mÃºsica</span>
Â  Â  Â  <button class="icon-btn" id="btn-login" title="Admin" onclick="showLogin()">ğŸ”‘</button>
Â  Â  Â  <button class="btn ghost" id="btn-logout" style="display:none" onclick="logout()">Salir</button>
Â  Â  </div>
Â  </div>
</header>
<div class="container">
Â  <div class="row muted" style="margin-bottom:20px;">
Â  Â  <span class="tag">CatÃ¡logo pÃºblico</span>
Â  Â  <span id="adminTag" class="tag" style="display:none">Admin</span>
Â  Â  <span id="userTag" class="tag" style="display:none">Usuario</span>
Â  Â  <span id="offlineTag" class="tag" style="display:none;background:var(--success)">Offline</span>
Â  </div>
Â  <div id="musicControls" class="music-controls" style="display:none;">
Â  Â  <button class="control-btn" id="shuffleBtn" onclick="toggleShuffle()" title="Aleatorio">
Â  Â  Â  <span>ğŸ”€</span> Shuffle
Â  Â  </button>
Â  Â  <button class="control-btn" id="repeatBtn" onclick="toggleRepeat()" title="Repetir">
Â  Â  Â  <span>ğŸ”</span> Repeat
Â  Â  </button>
Â  Â  <button class="control-btn" onclick="showFavorites()" title="Favoritos">
Â  Â  Â  <span>â¤ï¸</span> Favoritos
Â  Â  </button>
Â  Â  <button class="control-btn" onclick="showDownloads()" title="Descargas">
Â  Â  Â  <span>â¬‡</span>
Â  Â  </button>
Â  </div>
Â  <div id="searchView" style="display:none;">
Â  Â  <div class="backline">
Â  Â  Â  <button class="back-btn" onclick="closeSearchView()" title="Volver">â†</button>
Â  Â  Â  <span class="muted">Volver</span>
Â  Â  </div>
Â  Â  <div class="section-title">ğŸ” Buscar MÃºsica</div>
Â  Â  <div style="margin-bottom:20px;">
Â  Â  Â  <input type="text" id="searchInput" placeholder="Buscar canciones, Ã¡lbumes..." style="width:100%;margin-bottom:12px;" oninput="searchSongs(this.value)">
Â  Â  </div>
Â  	<div id="searchResults" class="search-songs-list"></div>
Â  	<div id="noSearchResults" class="no-results" style="display:none;">
Â  Â  Â  <div style="font-size:48px;margin-bottom:16px">ğŸ”</div>
Â  Â  Â  <div>Escribe algo para buscar mÃºsica</div>
Â  Â  </div>
Â  </div>
Â  <div id="favoritesView" style="display:none;">
Â  Â  <div class="backline">
Â  Â  Â  <button class="back-btn" onclick="closeFavoritesView()" title="Volver">â†</button>
Â  Â  Â  <span class="muted">Volver</span>
Â  Â  </div>
Â  Â  <div class="section-title">â¤ï¸ Mis Favoritos</div>
Â  Â  <div id="favoritesList" class="search-songs-list"></div>
Â  	<div id="emptyFavorites" class="no-results" style="display:none;">
Â  Â  Â  <div style="font-size:48px;margin-bottom:16px">â¤ï¸</div>
Â  Â  Â  <div>No tienes favoritos aÃºn</div>
Â  Â  </div>
Â  </div>
Â  <div id="downloadsView" style="display:none;">
Â  Â  <div class="backline">
Â  Â  Â  <button class="back-btn" onclick="closeDownloadsView()" title="Volver">â†</button>
Â  Â  Â  <span class="muted">Volver</span>
Â  Â  </div>
Â  Â  <div class="section-title">â¬‡ MÃºsica Offline</div>
Â  Â  <div id="downloadsList" class="search-songs-list"></div>
Â  	<div id="emptyDownloads" class="no-results" style="display:none;">
Â  Â  Â  <div style="font-size:48px;margin-bottom:16px">â¬‡</div>
Â  Â  Â  <div>No tienes mÃºsica offline</div>
Â  Â  </div>
Â  </div>
Â  <div id="playlistsView" style="display:none;">
Â  Â  <div class="backline">
Â  Â  Â  <button class="back-btn" onclick="closePlaylistsView()" title="Volver">â†</button>
Â  Â  Â  <span class="muted">Volver</span>
Â  Â  </div>
Â  Â  <div class="row" style="align-items:center;justify-content:space-between;margin-bottom:12px">
Â  Â  Â  <div class="section-title" style="margin:0">ğŸ“± Mis Playlists</div>
Â  Â  Â  <button class="btn small" onclick="createNewPlaylist()">+ Nueva</button>
Â  Â  </div>
Â  	<div id="playlistsGrid" class="grid playlists"></div>
Â  	<div id="emptyPlaylists" class="no-results" style="display:none;">
Â  Â  Â  <div style="font-size:48px;margin-bottom:16px">ğŸ“±</div>
Â  Â  Â  <div>No tienes playlists aÃºn</div>
Â  Â  Â  <button class="btn" onclick="createNewPlaylist()" style="margin-top:16px">Crear mi primera playlist</button>
Â  Â  </div>
Â  </div>
Â  <div id="playlistView" class="card stack">
Â  Â  <div class="backline">
Â  Â  Â  <button class="back-btn" onclick="closePlaylistView()" title="Volver">â†</button>
Â  Â  Â  <span class="muted">Volver</span>
Â  Â  </div>
Â  Â  <div class="playlist-hero">
Â  Â  Â  <div id="pvCover">ğŸ“±</div>
Â  Â  Â  <div class="info">
Â  Â  Â  Â  <div id="pvTitle" class="title">â€”</div>
Â  Â  Â  Â  <div id="pvMeta" class="meta">â€”</div>
Â  Â  Â  Â  <div class="row" style="margin-top:8px;gap:8px">
Â  Â  Â  Â  Â  <button class="btn small" id="pvPlayBtn" onclick="playPlaylist()">â–¶ Reproducir</button>
Â  Â  Â  Â  Â  <button class="btn small ghost" id="pvDeleteBtn" onclick="deletePlaylist()">ğŸ—‘ï¸ Eliminar</button>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>
Â  Â  <div id="pvSongs" class="song-plain-list"></div>
Â  </div>

Â  Â  <div id="adminPanel" class="card stack" style="display:none">
Â  Â  <div class="section-title">ğŸ› ï¸ Panel de AdministraciÃ³n</div>
Â  Â  <div class="inputs">
Â  Â  Â  <div class="stack">
Â  Â  Â  Â  <div class="pill">â• Crear nuevo Ã¡lbum</div>
Â  Â  Â  Â  <input id="albumTitle" type="text" placeholder="TÃ­tulo del Ã¡lbum" />
Â  Â  Â  Â  <input id="albumArtist" type="text" placeholder="Artista del Ã¡lbum" />
Â  Â  Â  Â  <input id="albumCover" type="file" accept="image/*" />
Â  Â  Â  Â  <button class="btn" onclick="uploadAlbum()">âœ¨ Subir Ãlbum</button>
Â  Â  Â  </div>
Â  Â  Â  <div class="stack">
Â  Â  Â  Â  <div class="pill">ğŸµ Agregar canciones a Ã¡lbum</div>
Â  Â  Â  Â  <select id="albumSelect"></select>
Â  Â  Â  Â  <input id="songTitle" type="text" placeholder="TÃ­tulo de la canciÃ³n (opcional si subes 1)" />
Â  Â  Â  Â  <input id="songFiles" type="file" accept="audio/*" multiple />
Â  Â  Â  Â  <button class="btn" onclick="uploadSong()">ğŸ“¤ Subir Canciones</button>
Â  Â  Â  </div>
Â  Â  Â  <div class="stack">
Â  Â  Â  Â  <div class="pill">âœï¸ Editar informaciÃ³n de Ã¡lbum</div>
Â  Â  Â  Â  <select id="editInfoAlbumSelect"></select>
Â  Â  Â  Â  <div class="row" style="gap:5px">
Â  Â  Â  Â  Â  <input id="editAlbumTitle" type="text" placeholder="Nuevo tÃ­tulo" />
Â  Â  Â  Â  Â  <input id="editAlbumArtist" type="text" placeholder="Nuevo artista" />
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <input id="editAlbumCover" type="file" accept="image/*" />
Â  Â  Â  Â  <div class="row" style="gap:5px">
Â  Â  Â  Â  Â  <button class="btn" onclick="editAlbumInfo()">ğŸ’¾ Actualizar Info</button>
Â  Â  Â  Â  Â  <button class="btn warning" onclick="editAlbumCoverOnly()">ğŸ–¼ï¸ Solo Portada</button>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â  <div class="stack">
Â  Â  Â  Â  <div class="pill">ğŸ—‘ï¸ Eliminar canciones individuales</div>
Â  Â  Â  Â  <select id="deleteSongAlbumSelect" onchange="loadSongsForDeletion()">
Â  Â  Â  Â  Â  <option value="">Selecciona un Ã¡lbum</option>
Â  Â  Â  Â  </select>
Â  Â  Â  Â  <select id="deleteSongSelect" style="display:none">
Â  Â  Â  Â  Â  <option value="">Selecciona una canciÃ³n</option>
Â  Â  Â  Â  </select>
Â  Â  Â  Â  <button class="btn danger" onclick="deleteSong()" id="deleteSongBtn" style="display:none">ğŸ—‘ï¸ Eliminar CanciÃ³n</button>
Â  Â  Â  </div>
Â  	  <div class="stack">
Â  Â  Â  Â  <div class="pill">ğŸ’¥ Eliminar Ã¡lbumes completos</div>
Â  Â  Â  Â  <select id="deleteAlbumSelect"></select>
Â  Â  Â  Â  <button class="btn danger" onclick="deleteAlbum()">ğŸ’€ Eliminar Ãlbum Completo</button>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>

Â  <div id="homeContent">
Â  Â  <div class="row" style="align-items:center;justify-content:space-between;margin-bottom:12px">
Â  Â  Â  <div class="section-title" style="margin:0">Albums</div>
Â  Â  Â  <select id="albumSort" onchange="sortAlbums(this.value)" style="display:none;background:var(--panel);border:1px solid var(--stroke);color:var(--text);padding:6px 10px;border-radius:8px;font-size:0.9rem;">
Â  Â  Â  Â  <option value="date">Por fecha</option>
Â  Â  Â  Â  <option value="title">Por tÃ­tulo</option>
Â  Â  Â  Â  <option value="artist">Por artista</option>
Â  Â  Â  </select>
Â  Â  </div>
Â  	<div id="albumsGrid" class="grid albums"></div>
Â  	<div id="emptyAlbums" class="muted" style="display:none">No hay Ã¡lbumes todavÃ­a.</div>
Â  </div>
Â  <div id="albumView" class="card stack">
Â  Â  <div class="backline">
Â  Â  Â  <button class="back-btn" onclick="closeAlbumView()" title="Volver">â†</button>
Â  Â  Â  <span class="muted">Volver</span>
Â  Â  </div>
Â  Â  <div class="album-hero">
Â  Â  Â  <img id="avCover" alt="cover">
Â  Â  Â  <div class="info">
Â  Â  Â  Â  <div id="avTitle" class="title">â€”</div>
Â  Â  Â  Â  <div id="avMeta" class="meta">â€”</div>
Â  Â  Â  </div>
Â  Â  </div>
Â  	<div id="avSongs" class="song-plain-list"></div>
Â  </div>
</div>
<div class="player" id="player" onclick="openNowPlaying()">
Â  <div class="np">
Â  Â  <img id="npCover" alt="cover">
Â  Â  <div class="titles">
Â  Â  Â  <div id="npTitle" class="t">Cargando...</div>
Â  Â  Â  <div id="npAlbum" class="a">â€”</div>
Â  Â  </div>
Â  </div>
Â  <div class="player-controls">
Â  Â  <button class="circle sm" onclick="event.stopPropagation(); prevTrack()">â®</button>
Â  	<button class="circle" id="playBtn" onclick="event.stopPropagation(); togglePlay()">â–¶</button>
Â  	<button class="circle sm" onclick="event.stopPropagation(); nextTrack()">â­</button>
Â  </div>
Â  <div class="player-seek">
Â  	<span id="curTime" class="time">0:00</span>
Â  	<input id="seek" type="range" min="0" max="100" value="0" oninput="seekAudio(this.value)" onclick="event.stopPropagation()" />
Â  	<span id="durTime" class="time">0:00</span>
Â  </div>
Â  <div class="vol">
Â  	<span>Vol</span>
Â  	<input id="vol" type="range" min="0" max="1" step="0.01" value="1" oninput="setVolume(this.value)" onclick="event.stopPropagation()" />
Â  </div>
Â  <div class="soundwave" id="soundwave" style="display:none">
Â  	<div class="bar"></div><div class="bar"></div><div class="bar"></div>
Â  </div>
Â  <audio id="audio" preload="none" crossorigin="anonymous"></audio>
</div>
<div id="npOverlay" onclick="closeNowPlaying()">
Â  <div id="npCard" onclick="event.stopPropagation()">
Â  	<img id="npBigCover" alt="cover">
Â  	<div class="t" id="npBigTitle">â€”</div>
Â  	<div class="a" id="npBigAlbum">â€”</div>
Â  Â Â 
Â  	<div class="row" style="margin:16px 0">
Â  Â  Â  <button class="favorite-btn" id="npFavoriteBtn" onclick="toggleCurrentFavorite()" title="Favorito">ğŸ¤</button>
Â  Â  Â  <button class="download-btn" id="npDownloadBtn" onclick="downloadCurrentSong()" title="Descargar">â¬‡</button>
Â  Â  </div>
Â  Â Â 
Â  	<div class="soundwave" style="margin:20px 0;">
Â  Â  Â  <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
Â  Â  </div>
Â  Â Â 
Â  	<div class="controls" style="width:100%;max-width:520px">
Â  Â  Â  <div class="buttons">
Â  Â  Â  Â  <button class="circle sm" onclick="prevTrack()">â®</button>
Â  Â  Â  Â  <button class="circle" onclick="togglePlay()" id="playBtnBig">â–¶</button>
Â  Â  Â  Â  <button class="circle sm" onclick="nextTrack()">â­</button>
Â  Â  Â  </div>
Â  Â  Â  <div class="seek">
Â  Â  Â  Â  <span id="curTimeBig" class="muted">0:00</span>
Â  Â  Â  Â  <input id="seekBig" type="range" min="0" max="100" value="0" oninput="seekAudio(this.value)" />
Â  Â  Â  Â  <span id="durTimeBig" class="muted">0:00</span>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>
</div>
<div id="bottomBar">
Â  <button id="btn-home" title="Inicio" onclick="goHome()" class="active">
Â  Â  <svg class="icon" viewBox="0 0 24 24"><path d="M3 11L12 2l9 9v9a2 2 0 0 1-2 2h-4a2 2 0 0 1-2-2v-5H9v5a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2v-9z"/></svg>
Â  Â  <span class="label">Inicio</span>
Â  </button>
Â  <button id="btn-search" title="Buscar" onclick="showSearch()">
Â  Â  <svg class="icon" viewBox="0 0 24 24"><circle cx="11" cy="11" r="7"/><line x1="16.5" y1="16.5" x2="21" y2="21"/></svg>
Â  Â  <span class="label">Buscar</span>
Â  </button>
Â  <button id="btn-playlists" title="Playlists" onclick="showPlaylists()">
Â  Â  <svg class="icon" viewBox="0 0 24 24"><path d="M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01"/></svg>
Â  Â  <span class="label">Playlists</span>
Â  </button>
Â  <button id="btn-account" title="Cuenta" onclick="showAccount()">
Â  Â  <svg class="icon" viewBox="0 0 24 24"><circle cx="12" cy="7" r="4"/><path d="M5.5 21a7.5 7.5 0 0 1 13 0"/></svg>
Â  	<span class="label">Cuenta</span>
Â  </button>
</div>
<div id="playlistModal" class="playlist-modal">
Â  <div class="playlist-modal-content">
Â  	<div class="section-title">Agregar a Playlist</div>
Â  	<div class="playlist-grid" id="playlistModalGrid"></div>
Â  	<div class="row" style="margin-top:16px;gap:8px">
Â  Â  Â  <button class="btn small" onclick="createPlaylistFromModal()">+ Nueva Playlist</button>
Â  Â  Â  <button class="btn small ghost" onclick="closePlaylistModal()">Cancelar</button>
Â  Â  </div>
Â  </div>
</div>
<div id="loginModal" class="card" style="display:none;position:fixed;inset:0;margin:auto;max-width:420px;height:max-content;z-index:50">
Â  <div class="stack">
Â  	<div class="section-title">Iniciar sesiÃ³n</div>
Â  	<input id="email" type="email" placeholder="Email" />
Â  	<input id="password" type="password" placeholder="ContraseÃ±a" />
Â  	<div class="row">
Â  Â  Â  <button class="btn" onclick="login()">Entrar</button>
Â  Â  Â  <button class="btn ghost" onclick="hideLogin()">Cancelar</button>
Â  	</div>
Â  	<small class="muted">Crea una cuenta o inicia sesiÃ³n para gestionar playlists.</small>
Â  </div>
</div>

<script>
const SUPABASE_URL = "https://nqbldvpnqhngdtalvzov.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5xYmxkdnBucWhuZ2R0YWx2em92Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUyMjY0NjUsImV4cCI6MjA3MDgwMjQ2NX0.Zzg5D219sW7bhvl0_R5ypX9MF6nRzBSDIeo2Lvebab0";
const ADMIN_EMAIL = "klmzr@gmail.com";
const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

let isAdmin = false, isLoggedIn = false, currentUser = null;
let albums = [], userPlaylists = [], publicPlaylists = [];
let songsByAlbum = {}, songsByPlaylist = {}, flatSongs = [];
let queue = [], qIndex = -1, currentAlbum = null, currentPlaylist = null;

// Utility Functions
function setActiveNav(activeButton) {
Â  document.querySelectorAll('#bottomBar button').forEach(btn => btn.classList.remove('active'));
Â  const targetBtn = document.getElementById(`btn-${activeButton}`);
Â  if (targetBtn) targetBtn.classList.add('active');
}

function showError(msg) {
Â  const errorEl = document.createElement('div');
Â  errorEl.className = 'error-msg';
Â  errorEl.textContent = msg;
Â  errorEl.style.position = 'fixed';
Â  errorEl.style.top = '20px';
Â  errorEl.style.right = '20px';
Â  errorEl.style.zIndex = '9999';
Â  document.body.appendChild(errorEl);
Â  setTimeout(() => errorEl.remove(), 4000);
}

function showSuccess(msg) {
Â  const successEl = document.createElement('div');
Â  successEl.className = 'success-msg';
Â  successEl.textContent = msg;
Â  successEl.style.position = 'fixed';
Â  successEl.style.top = '20px';
Â  successEl.style.right = '20px';
Â  successEl.style.zIndex = '9999';
Â  document.body.appendChild(successEl);
Â  setTimeout(() => successEl.remove(), 3000);
}

function updateAdminSelects() {
Â  const adminSel = document.getElementById("albumSelect");
Â  const delSel = document.getElementById("deleteAlbumSelect");
Â  const editSel = document.getElementById("editInfoAlbumSelect");

Â  if (adminSel) {
Â  Â  adminSel.innerHTML = '<option value="">Selecciona un Ã¡lbum</option>';
Â  Â  albums.forEach(album => {
Â  Â  Â  const option = document.createElement("option");
Â  Â  Â  option.value = album.id;
Â  Â  Â  option.textContent = `${album.title} - ${album.artist || 'Sin artista'}`;
Â  Â  Â  adminSel.appendChild(option);
Â  Â  });
Â  }
Â Â 
Â  if (delSel) {
Â  Â  delSel.innerHTML = '<option value="">Selecciona un Ã¡lbum</option>';
Â  Â  albums.forEach(album => {
Â  Â  Â  const option = document.createElement("option");
Â  Â  Â  option.value = album.id;
Â  Â  Â  option.textContent = `${album.title} - ${album.artist || 'Sin artista'}`;
Â  Â  Â  delSel.appendChild(option);
Â  Â  });
Â  }
Â Â 
Â  if (editSel) {
Â  Â  editSel.innerHTML = '<option value="">Selecciona un Ã¡lbum para editar</option>';
Â  Â  albums.forEach(album => {
Â  Â  Â  const option = document.createElement("option");
Â  Â  Â  option.value = album.id;
Â  Â  Â  option.textContent = `${album.title} - ${album.artist || 'Sin artista'}`;
Â  Â  Â  editSel.appendChild(option);
Â  Â  });
Â  }
}

// NUEVA FUNCIÃ“N: Editar informaciÃ³n completa del Ã¡lbum
async function editAlbumInfo() {
Â  if (!isAdmin) return alert("No autorizado");
Â  const albumId = document.getElementById("editInfoAlbumSelect").value;
Â  const newTitle = document.getElementById("editAlbumTitle").value.trim();
Â  const newArtist = document.getElementById("editAlbumArtist").value.trim();
Â Â 
Â  if (!albumId) {
Â  Â  showError("Selecciona un Ã¡lbum para editar");
Â  Â  return;
Â  }
Â Â 
Â  if (!newTitle && !newArtist) {
Â  Â  showError("Ingresa al menos un tÃ­tulo o artista nuevo");
Â  Â  return;
Â  }
Â Â 
Â  try {
Â  Â  const updateData = {};
Â  Â  if (newTitle) updateData.title = newTitle;
Â  Â  if (newArtist) updateData.artist = newArtist;
Â  Â Â 
Â  Â  const { error } = await sb.from("albums").update(updateData).eq("id", albumId);
Â  	if (error) {
Â  Â  Â  showError("Error actualizando Ã¡lbum: " + error.message);
Â  Â  Â  return;
Â  Â  }
Â  Â Â 
Â  Â  showSuccess("InformaciÃ³n del Ã¡lbum actualizada correctamente");
Â  Â  document.getElementById("editAlbumTitle").value = "";
Â  Â  document.getElementById("editAlbumArtist").value = "";
Â  Â  await refreshCatalog();
Â  } catch (error) {
Â  Â  console.error('Error en editAlbumInfo:', error);
Â  Â  showError('Error actualizando informaciÃ³n del Ã¡lbum');
Â  }
}

// NUEVA FUNCIÃ“N: Editar solo portada del Ã¡lbum
async function editAlbumCoverOnly() {
Â  if (!isAdmin) return alert("No autorizado");
Â  const albumId = document.getElementById("editInfoAlbumSelect").value;
Â  const file = document.getElementById("editAlbumCover").files[0];
Â Â 
Â  if (!albumId) {
Â  Â  showError("Selecciona un Ã¡lbum");
Â  Â  return;
Â  }
Â Â 
Â  if (!file) {
Â  Â  showError("Selecciona una nueva imagen de portada");
Â  Â  return;
Â  }
Â Â 
Â  try {
Â  Â  const path = `${Date.now()}-${safeName(file.name)}`;
Â  Â  const { error: upErr } = await sb.storage.from("covers").upload(path, file);
Â  	if (upErr) {
Â  Â  Â  showError("Error subiendo portada: " + upErr.message);
Â  Â  Â  return;
Â  Â  }
Â  Â Â 
Â  Â  const { data: pub } = sb.storage.from("covers").getPublicUrl(path);
Â  Â  const cover_url = pub.publicUrl;
Â  Â Â 
Â  Â  const { error } = await sb.from("albums").update({ cover_url }).eq("id", albumId);
Â  	if (error) {
Â  Â  Â  showError("Error actualizando portada: " + error.message);
Â  Â  Â  return;
Â  Â  }
Â  Â Â 
Â  Â  showSuccess("Portada del Ã¡lbum actualizada correctamente");
Â  Â  document.getElementById("editAlbumCover").value = "";
Â  Â  await refreshCatalog();
Â  } catch (error) {
Â  Â  console.error('Error en editAlbumCoverOnly:', error);
Â  Â  showError('Error actualizando portada');
Â  }
}

// Data Loading Functions
async function refreshCatalog() {
Â  console.log('ğŸ”„ Cargando Ã¡lbumes...');
Â Â 
Â  try {
Â  Â  const { data: alb, error: e1 } = await sb
Â  Â  Â  .from("albums")
Â  Â  Â  .select("*")
Â  Â  Â  .order("created_at", {ascending: false});
Â  Â Â 
Â  	if (e1) {Â 
Â  Â  Â  console.error('âŒ Error cargando Ã¡lbumes:', e1);Â 
Â  Â  Â  showError('Error cargando Ã¡lbumes: ' + e1.message);Â 
Â  Â  Â  return;Â 
Â  Â  }
Â  Â Â 
Â  	albums = alb || [];
Â  	console.log('âœ… Ãlbumes cargados:', albums.length);
Â  Â Â 
Â  	const emptyAlbums = document.getElementById("emptyAlbums");
Â  	if (emptyAlbums) {
Â  Â  Â  emptyAlbums.style.display = albums.length ? "none" : "block";
Â  Â  }
Â  Â Â 
Â  	songsByAlbum = {};
Â  	flatSongs = [];
Â  Â Â 
Â  	for (const album of albums) {
Â  Â  Â  try {
Â  Â  Â  Â  const { data: ss, error: e2 } = await sb
Â  Â  Â  Â  Â  .from("songs")
Â  Â  Â  Â  Â  .select("*")
Â  Â  Â  Â  Â  .eq("album_id", album.id)
Â  Â  Â  Â  Â  .order("created_at", {ascending: true});
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (e2) {Â 
Â  Â  Â  Â  Â  console.error('âŒ Error cargando canciones para Ã¡lbum:', album.title, e2);Â 
Â  Â  Â  Â  Â  continue;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  songsByAlbum[album.id] = ss || [];
Â  Â  Â  Â Â 
Â  Â  Â  Â  for (const song of (ss || [])) {
Â  Â  Â  Â  Â  flatSongs.push({
Â  Â  Â  Â  Â  	...song,Â 
Â  Â  Â  Â  Â  	album_title: album.title,Â 
Â  Â  Â  Â  Â  	cover_url: album.cover_url
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  } catch (error) {
Â  Â  Â  Â  console.error('âŒ Error procesando Ã¡lbum:', album.title, error);
Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  	renderAlbums();
Â  	updateAdminSelects();
Â  Â Â 
Â  } catch (error) {
Â  Â  console.error('âŒ Error en refreshCatalog:', error);
Â  Â  showError('Error cargando catÃ¡logo');
Â  }
}

function renderAlbums(list = albums) {
Â  console.log('ğŸ¨ Renderizando Ã¡lbumes:', list.length);
Â Â 
Â  const albumsGrid = document.getElementById("albumsGrid");
Â  const emptyAlbums = document.getElementById("emptyAlbums");
Â Â 
Â  if (!albumsGrid) return;
Â Â 
Â  albumsGrid.innerHTML = "";
Â Â 
Â  if (list.length === 0) {
Â  Â  if (emptyAlbums) emptyAlbums.style.display = 'block';
Â  Â  return;
Â  }
Â Â 
Â  if (emptyAlbums) emptyAlbums.style.display = 'none';
Â Â 
Â  list.forEach((album, index) => {
Â  	const count = (songsByAlbum[album.id]?.length || 0);
Â  	const card = document.createElement("div");
Â  	card.className = "album-card";
Â  Â Â 
Â  	card.innerHTML = `
Â  Â  Â  <img class="album-cover" src="${album.cover_url || ''}" alt="${album.title}" onerror="this.style.background='var(--panel)'; this.innerHTML='ğŸµ';">
Â  Â  Â  <div class="album-title">${album.title}</div>
Â  Â  Â  <div class="album-meta">${album.artist || 'Sin artista'} â€¢ ${count} ${count === 1 ? 'canciÃ³n' : 'canciones'}</div>
Â  Â  `;
Â  Â Â 
Â  	card.onclick = () => openAlbum(album);
Â  	albumsGrid.appendChild(card);
Â  });
}

function openAlbum(album) {
Â  console.log('ğŸµ Abriendo Ã¡lbum:', album.title);
Â  currentAlbum = album;
Â  const songs = songsByAlbum[album.id] || [];
Â Â 
Â  const avCover = document.getElementById("avCover");
Â  const avTitle = document.getElementById("avTitle");
Â  const avMeta = document.getElementById("avMeta");
Â  const avSongs = document.getElementById("avSongs");
Â  const albumView = document.getElementById("albumView");
Â Â 
Â  if (avCover) avCover.src = album.cover_url || "";
Â  if (avTitle) avTitle.textContent = album.title;
Â  if (avMeta) avMeta.textContent = `${album.artist || 'Sin artista'} â€¢ ${songs.length} ${songs.length === 1 ? 'canciÃ³n' : 'canciones'}`;
Â Â 
Â  if (avSongs) {
Â  Â  avSongs.innerHTML = "";
Â  Â Â 
Â  	if (!songs.length) {
Â  Â  Â  avSongs.innerHTML = `<div class="muted" style="padding:12px 0">Este Ã¡lbum no tiene canciones todavÃ­a.</div>`;
Â  	} else {
Â  Â  Â  songs.forEach((song, idx) => {
Â  Â  Â  Â  const row = document.createElement("div");
Â  Â  Â  Â  row.className = "song-plain-item";
Â  Â  Â  Â Â 
Â  Â  Â  Â  row.innerHTML = `
Â  Â  Â  Â  Â  <div class="idx">${idx + 1}</div>
Â  Â  Â  Â  Â  <div class="title">${song.title}</div>
Â  Â  Â  Â  Â  <div class="actions">
Â  Â  Â  Â  Â  Â  <button class="favorite-btn" onclick="event.stopPropagation(); toggleFavorite('${song.id}')" title="Favorito">ğŸ¤</button>
Â  Â  Â  Â  Â  Â  <button class="download-btn" onclick="event.stopPropagation(); downloadSong('${song.id}')" title="Descargar">â¬‡</button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `;
Â  Â  Â  Â Â 
Â  Â  Â  Â  row.onclick = () => {
Â  Â  Â  Â  Â  queue = songs.map(s => ({
Â  Â  Â  Â  Â  	...s,Â 
Â  Â  Â  Â  Â  	album_title: album.title,Â 
Â  Â  Â  Â  Â  	cover_url: album.cover_url
Â  Â  Â  Â  Â  }));
Â  Â  Â  Â  Â  qIndex = -1;
Â  Â  Â  Â  Â  startQueueAt(idx);
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  avSongs.appendChild(row);
Â  Â  Â  });
Â  Â  }
Â  }
Â Â 
Â  if (albumView) {
Â  Â  albumView.style.display = "block";
Â  Â  albumView.scrollIntoView({behavior: "smooth", block: "start"});
Â  }
}

function closeAlbumView() {
Â  const albumView = document.getElementById("albumView");
Â  if (albumView) albumView.style.display = "none";
Â  currentAlbum = null;
}

// Player Functions
function startQueueAt(idx) {Â 
Â  if (!queue.length) return;Â 
Â  qIndex = idx;Â 
Â  playTrack(queue[qIndex]);Â 
}

function playTrack(song) {
Â  console.log('ğŸµ Reproduciendo:', song.title);
Â Â 
Â  if (!song.song_url) {
Â  Â  showError(`Error: No hay URL de audio para "${song.title}"`);
Â  Â  return;
Â  }
Â Â 
Â  const audioEl = document.getElementById("audio");
Â  const npTitle = document.getElementById("npTitle");
Â  const npAlbum = document.getElementById("npAlbum");
Â  const npCover = document.getElementById("npCover");
Â  const npBigTitle = document.getElementById("npBigTitle");
Â  const npBigAlbum = document.getElementById("npBigAlbum");
Â  const npBigCover = document.getElementById("npBigCover");
Â  const playerElement = document.getElementById("player");
Â  const playBtn = document.getElementById("playBtn");
Â  const playBtnBig = document.getElementById("playBtnBig");
Â Â 
Â  audioEl.pause();
Â  audioEl.currentTime = 0;
Â  audioEl.src = song.song_url;
Â Â 
Â  if (npTitle) npTitle.textContent = song.title;
Â  if (npAlbum) npAlbum.textContent = song.album_title || "â€”";
Â  if (npCover) npCover.src = song.cover_url || "";
Â  if (npBigTitle) npBigTitle.textContent = song.title;
Â  if (npBigAlbum) npBigAlbum.textContent = song.album_title || "â€”";
Â  if (npBigCover) npBigCover.src = song.cover_url || "";
Â Â 
Â  if (playerElement) {
Â  Â  playerElement.classList.add('show');
Â  Â  document.body.style.paddingBottom = '120px';
Â  }
Â Â 
Â  audioEl.play().then(() => {
Â  	if (playBtn) playBtn.textContent = "â¸";
Â  	if (playBtnBig) playBtnBig.textContent = "â¸";
Â  }).catch(error => {
Â  Â  console.error('Error reproduciendo:', error);
Â  Â  showError(`Error reproduciendo "${song.title}"`);
Â  });
}

function togglePlay() {
Â  const audioEl = document.getElementById("audio");
Â  const playBtn = document.getElementById("playBtn");
Â  const playBtnBig = document.getElementById("playBtnBig");
Â Â 
Â  if (audioEl.paused) {Â 
Â  Â  audioEl.play().then(() => {
Â  Â  Â  if (playBtn) playBtn.textContent = "â¸";
Â  Â  Â  if (playBtnBig) playBtnBig.textContent = "â¸";
Â  Â  });
Â  } else {Â 
Â  Â  audioEl.pause();Â 
Â  	if (playBtn) playBtn.textContent = "â–¶";
Â  	if (playBtnBig) playBtnBig.textContent = "â–¶";
Â  }
}

function nextTrack() {Â 
Â  if (!queue.length) return;Â 
Â  qIndex = (qIndex + 1) % queue.length;Â 
Â  playTrack(queue[qIndex]);Â 
}

function prevTrack() {Â 
Â  if (!queue.length) return;Â 
Â  qIndex = (qIndex - 1 + queue.length) % queue.length;Â 
Â  playTrack(queue[qIndex]);Â 
}

function setVolume(v) {Â 
Â  const audioEl = document.getElementById("audio");
Â  audioEl.volume = v;Â 
}

function seekAudio(percent) {Â 
Â  const audioEl = document.getElementById("audio");
Â  if (!audioEl.duration || isNaN(audioEl.duration)) return;Â 
Â  audioEl.currentTime = (percent / 100) * audioEl.duration;Â 
}

function fmt(t) {Â 
Â  if (!isFinite(t)) return "0:00";Â 
Â  const m = Math.floor(t / 60);
Â  const s = Math.floor(t % 60);Â 
Â  return `${m}:${s.toString().padStart(2, "0")}`;Â 
}

function openNowPlaying() {
Â  const npOverlay = document.getElementById("npOverlay");
Â  if (npOverlay) npOverlay.style.display = "flex";
}

function closeNowPlaying() {Â 
Â  const npOverlay = document.getElementById("npOverlay");
Â  if (npOverlay) npOverlay.style.display = "none";Â 
}

// Navigation Functions
function hideAllViews() {
Â  document.getElementById('homeContent').style.display = 'none';
Â  document.getElementById('searchView').style.display = 'none';
Â  document.getElementById('favoritesView').style.display = 'none';
Â  document.getElementById('downloadsView').style.display = 'none';
Â  document.getElementById('playlistsView').style.display = 'none';
Â  document.getElementById('albumView').style.display = 'none';
Â  document.getElementById('playlistView').style.display = 'none';
Â  const adminPanel = document.getElementById('adminPanel');
Â  if (adminPanel) adminPanel.style.display = 'none';
}

function goHome() {
Â  console.log('ğŸ  Volviendo al inicio');
Â  hideAllViews();
Â  document.getElementById('homeContent').style.display = 'block';
Â  setActiveNav('home');
Â  window.scrollTo({top: 0, behavior: 'smooth'});
}

function showSearch() {
Â  console.log('ğŸ” Mostrando bÃºsqueda');
Â  hideAllViews();
Â  document.getElementById('searchView').style.display = 'block';
Â  const noResults = document.getElementById('noSearchResults');
Â  if (noResults) noResults.style.display = 'block';
Â  setActiveNav('search');
}

function closeSearchView() {
Â  console.log('Cerrando bÃºsqueda');
Â  goHome();
}

function showPlaylists() {
Â  console.log('ğŸ“± Mostrando playlists');
Â  if (!isLoggedIn) {
Â  Â  showLogin();
Â  Â  showError('Inicia sesiÃ³n para gestionar playlists');
Â  Â  return;
Â  }
Â  hideAllViews();
Â  document.getElementById('playlistsView').style.display = 'block';
Â  const emptyPlaylists = document.getElementById('emptyPlaylists');
Â  if (emptyPlaylists) emptyPlaylists.style.display = 'block';
Â  setActiveNav('playlists');
}

function closePlaylistsView() {
Â  console.log('Cerrando playlists');
Â  goHome();
}

function showAccount() {
Â  if(isAdmin) {
Â  Â  alert('Cuenta Admin: ' + ADMIN_EMAIL + '\n\nFuncionalidades:\nâ€¢ Crear Ã¡lbumes\nâ€¢ Subir canciones\nâ€¢ Editar informaciÃ³n completa\nâ€¢ Eliminar Ã¡lbumes\nâ€¢ Gestionar playlists');
Â  } else if (isLoggedIn) {
Â  Â  alert('InformaciÃ³n de Cuenta\n\nUsuario: ' + currentUser.email + '\n\nFuncionalidades:\nâ€¢ Crear playlists\nâ€¢ Gestionar tu mÃºsica');
Â  } else {
Â  	showLogin();
Â  }
Â  setActiveNav('account');
}

// Auth Functions
function showLogin() {Â 
Â  const modal = document.getElementById("loginModal");
Â  if (modal) modal.style.display = "block";Â 
}

function hideLogin() {Â 
Â  const modal = document.getElementById("loginModal");
Â  if (modal) modal.style.display = "none";Â 
}

async function login() {
Â  const emailEl = document.getElementById("email");
Â  const passwordEl = document.getElementById("password");
Â Â 
Â  if (!emailEl || !passwordEl) {
Â  Â  showError('Error: elementos de login no encontrados');
Â  Â  return;
Â  }

Â  const email = emailEl.value.trim();
Â  const password = passwordEl.value;
Â Â 
Â  if (!email || !password) {
Â  Â  showError('Ingresa email y contraseÃ±a');
Â  Â  return;
Â  }
Â Â 
Â  try {
Â  Â  let result = await sb.auth.signInWithPassword({ email, password });
Â  Â Â 
Â  Â  if (result.error) {
Â  Â  Â  result = await sb.auth.signUp({ email, password });
Â  Â  Â  if (result.error) {
Â  Â  Â  Â  showError("Error: " + result.error.message);
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  showSuccess('Cuenta creada! Revisa tu email si es necesario.');
Â  Â  }
Â  Â Â 
Â  Â  currentUser = result.data.user;
Â  Â  isLoggedIn = !!currentUser;
Â  Â  isAdmin = (email.toLowerCase() === ADMIN_EMAIL.toLowerCase());
Â  Â Â 
Â  Â  const btnLogin = document.getElementById("btn-login");
Â  Â  const btnLogout = document.getElementById("btn-logout");
Â  Â  const adminPanel = document.getElementById("adminPanel");
Â  Â  const adminTag = document.getElementById("adminTag");
Â  Â  const userTag = document.getElementById("userTag");
Â  Â Â 
Â  	if (btnLogin) btnLogin.style.display = "none";
Â  	if (btnLogout) btnLogout.style.display = "inline-flex";
Â  Â Â 
Â  	if (isAdmin && adminPanel && adminTag) {
Â  Â  Â  adminPanel.style.display = "block";
Â  Â  Â  adminTag.style.display = "inline-block";
Â  Â  }
Â  Â Â 
Â  	if (isLoggedIn && userTag) {
Â  Â  Â  userTag.style.display = "inline-block";
Â  Â  }
Â  Â Â 
Â  	hideLogin();
Â  	await refreshCatalog();
Â  Â Â 
Â  } catch (error) {
Â  Â  console.error('Error en login:', error);
Â  Â  showError('Error de conexiÃ³n');
Â  }
}

async function logout() {
Â  try {
Â  Â  await sb.auth.signOut();
Â  Â  currentUser = null;
Â  Â  isLoggedIn = false;
Â  Â  isAdmin = false;
Â  Â Â 
Â  Â  const adminPanel = document.getElementById("adminPanel");
Â  Â  const adminTag = document.getElementById("adminTag");
Â  Â  const userTag = document.getElementById("userTag");
Â  Â  const btnLogin = document.getElementById("btn-login");
Â  Â  const btnLogout = document.getElementById("btn-logout");
Â  Â Â 
Â  	if (adminPanel) adminPanel.style.display = "none";
Â  	if (adminTag) adminTag.style.display = "none";
Â  	if (userTag) userTag.style.display = "none";
Â  	if (btnLogin) btnLogin.style.display = "inline-flex";
Â  	if (btnLogout) btnLogout.style.display = "none";
Â  Â Â 
Â  } catch (error) {
Â  Â  console.error('Error en logout:', error);
Â  }
}

// Admin Functions
function safeName(name) {Â 
Â  return name.replace(/[^a-zA-Z0-9_\-.]+/g, "-");Â 
}

async function uploadAlbum() {
Â  if (!isAdmin) return alert("No autorizado");
Â  const title = document.getElementById("albumTitle").value.trim();
Â  const artist = document.getElementById("albumArtist").value.trim();
Â  const file = document.getElementById("albumCover").files[0];
Â Â 
Â  if (!title || !artist || !file) return alert("Completa tÃ­tulo, artista y portada");
Â Â 
Â  try {
Â  Â  const path = `${Date.now()}-${safeName(file.name)}`;
Â  Â  const { error: upErr } = await sb.storage.from("covers").upload(path, file);
Â  	if (upErr) return alert("Error subiendo portada: " + upErr.message);
Â  Â Â 
Â  Â  const { data: pub } = sb.storage.from("covers").getPublicUrl(path);
Â  Â  const cover_url = pub.publicUrl;
Â  Â Â 
Â  Â  const { error: insErr } = await sb.from("albums").insert([{Â 
Â  Â  Â  title,Â 
Â  Â  Â  artist,Â 
Â  Â  Â  cover_urlÂ 
Â  Â  }]);
Â  	if (insErr) return alert("Error guardando Ã¡lbum: " + insErr.message);
Â  Â Â 
Â  	document.getElementById("albumTitle").value = "";
Â  	document.getElementById("albumArtist").value = "";
Â  	document.getElementById("albumCover").value = "";
Â  	showSuccess("Ãlbum creado exitosamente");
Â  	await refreshCatalog();
Â  } catch (error) {
Â  Â  console.error('Error en uploadAlbum:', error);
Â  Â  showError('Error creando Ã¡lbum');
Â  }
}

async function uploadSong() {
Â  if (!isAdmin) return alert("No autorizado");
Â  const albumId = document.getElementById("albumSelect").value;
Â  const titleInput = document.getElementById("songTitle").value.trim();
Â  const files = document.getElementById("songFiles").files;
Â  if (!albumId || files.length === 0) return alert("Selecciona un Ã¡lbum y al menos un archivo de audio");
Â Â 
Â  try {
Â  	let ok = 0, fail = 0;
Â  	for (const file of files) {
Â  Â  Â  if (!file.type.startsWith('audio/')) {
Â  Â  Â  Â  fail++;
Â  Â  Â  Â  continue;
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  const path = `${Date.now()}-${safeName(file.name)}`;
Â  Â  Â  const { error: upErr } = await sb.storage.from("songs").upload(path, file);
Â  Â  Â  if (upErr) {Â 
Â  Â  Â  Â  fail++;Â 
Â  Â  Â  Â  continue;Â 
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  const { data: pub } = sb.storage.from("songs").getPublicUrl(path);
Â  Â  Â  const song_url = pub.publicUrl;
Â  Â  Â Â 
Â  Â  Â  const title = (files.length === 1 && titleInput) ? titleInput : file.name.replace(/\.[^/.]+$/, "");
Â  Â  Â  const { error: insErr } = await sb.from("songs").insert([{ album_id: albumId, title, song_url }]);
Â  Â  Â  if (insErr) {Â 
Â  Â  Â  Â  fail++;Â 
Â  Â  Â  } else {Â 
Â  Â  Â  Â  ok++;Â 
Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  	document.getElementById("songTitle").value = "";
Â  	document.getElementById("songFiles").value = "";
Â  	showSuccess(`Subida completa: ${ok} exitosas, ${fail} error(es)`);
Â  	await refreshCatalog();
Â  } catch (error) {
Â  Â  console.error('Error en uploadSong:', error);
Â  Â  showError('Error subiendo canciones');
Â  }
}

async function deleteAlbum() {
Â  if (!isAdmin) return alert("No autorizado");
Â  const albumId = document.getElementById("deleteAlbumSelect").value;
Â  if (!albumId) return alert("Selecciona un Ã¡lbum");
Â  if (!confirm("Â¿Eliminar Ã¡lbum y todas sus canciones?")) return;
Â Â 
Â  try {
Â  Â  const { error: delSongsErr } = await sb.from("songs").delete().eq("album_id", albumId);
Â  	if (delSongsErr) { alert("Error borrando canciones: " + delSongsErr.message); return; }
Â  Â Â 
Â  Â  const { error: delAlbErr } = await sb.from("albums").delete().eq("id", albumId);
Â  	if (delAlbErr) { alert("Error borrando Ã¡lbum: " + delAlbErr.message); return; }
Â  Â Â 
Â  	showSuccess("Ãlbum eliminado exitosamente");
Â  	if (currentAlbum?.id === albumId) closeAlbumView();
Â  	await refreshCatalog();
Â  } catch (error) {
Â  Â  console.error('Error en deleteAlbum:', error);
Â  Â  showError('Error eliminando Ã¡lbum');
Â  }
}

// Event listener para autocompletar informaciÃ³n al editar
document.addEventListener("DOMContentLoaded", () => {
Â  const editSel = document.getElementById("editInfoAlbumSelect");
Â  if (editSel) {
Â  Â  editSel.addEventListener("change", function() {
Â  Â  Â  const albumId = this.value;
Â  Â  Â  const album = albums.find(a => a.id === albumId);
Â  Â  Â  const editTitleInput = document.getElementById("editAlbumTitle");
Â  Â  Â  const editArtistInput = document.getElementById("editAlbumArtist");
Â  Â  Â Â 
Â  Â  Â  if (editTitleInput && editArtistInput && album) {
Â  Â  Â  Â  editTitleInput.value = album.title || "";
Â  Â  Â  Â  editArtistInput.value = album.artist || "";
Â  Â  Â  Â  editTitleInput.placeholder = `Actual: ${album.title}`;
Â  Â  Â  Â  editArtistInput.placeholder = `Actual: ${album.artist || 'Sin artista'}`;
Â  Â  Â  }
Â  Â  });
Â  }
});

// Event Listeners
document.getElementById("audio").addEventListener("timeupdate", () => {
Â  const audioEl = document.getElementById("audio");
Â  const seekEl = document.getElementById("seek");
Â  const curTime = document.getElementById("curTime");
Â  const durTime = document.getElementById("durTime");
Â  const seekBig = document.getElementById("seekBig");
Â  const curTimeBig = document.getElementById("curTimeBig");
Â  const durTimeBig = document.getElementById("durTimeBig");
Â Â 
Â  if (!audioEl.duration) return;
Â  const p = (audioEl.currentTime / audioEl.duration) * 100;
Â Â 
Â  if (seekEl) seekEl.value = p;
Â  if (curTime) curTime.textContent = fmt(audioEl.currentTime);
Â  if (durTime) durTime.textContent = fmt(audioEl.duration);
Â  if (seekBig) seekBig.value = p;
Â  if (curTimeBig) curTimeBig.textContent = fmt(audioEl.currentTime);
Â  if (durTimeBig) durTimeBig.textContent = fmt(audioEl.duration);
});

document.getElementById("audio").addEventListener("ended", () => nextTrack());

// Placeholder functions
function toggleFavorite(songId) { console.log('Toggle favorite:', songId); }
function downloadSong(songId) { console.log('Download song:', songId); }
function searchSongs(value) { console.log('Search:', value); }
function createNewPlaylist() { console.log('Create playlist'); }
function showFavorites() { console.log('Show favorites'); }
function showDownloads() { console.log('Show downloads'); }
function toggleShuffle() { console.log('Toggle shuffle'); }
function toggleRepeat() { console.log('Toggle repeat'); }
function toggleCurrentFavorite() { console.log('Toggle current favorite'); }
function downloadCurrentSong() { console.log('Download current song'); }
function createPlaylistFromModal() { console.log('Create playlist from modal'); }
function closePlaylistModal() { console.log('Close playlist modal'); }
function playPlaylist() { console.log('Play playlist'); }
function deletePlaylist() { console.log('Delete playlist'); }
function loadSongsForDeletion() { console.log('Load songs for deletion'); }
function deleteSong() { console.log('Delete song'); }
function sortAlbums(value) { console.log('Sort albums:', value); }
function closePlaylistView() { console.log('Close playlist view'); }
function closeFavoritesView() { goHome(); }
function closeDownloadsView() { goHome(); }

// Hide loading screen
setTimeout(() => {
Â  const loadingScreen = document.getElementById('loadingScreen');
Â  if (loadingScreen) {
Â  Â  loadingScreen.style.display = 'none';
Â  }
}, 1500);

// Initialization
(async () => {
Â  console.log('ğŸš€ Inicializando KLMZ MUSIC...');
Â Â 
Â  try {
Â  Â  const { data } = await sb.auth.getSession();
Â  Â Â 
Â  Â  if (data?.session?.user?.email) {
Â  Â  Â  const email = data.session.user.email;
Â  Â  Â  currentUser = data.session.user;
Â  Â  Â  isLoggedIn = true;
Â  Â  Â  isAdmin = (email.toLowerCase() === ADMIN_EMAIL.toLowerCase());
Â  Â  Â Â 
Â  Â  Â  const btnLogin = document.getElementById("btn-login");
Â  Â  Â  const btnLogout = document.getElementById("btn-logout");
Â  Â  Â  const adminPanel = document.getElementById("adminPanel");
Â  Â  Â  const adminTag = document.getElementById("adminTag");
Â  Â  Â  const userTag = document.getElementById("userTag");
Â  Â  Â Â 
Â  Â  Â  if (btnLogin) btnLogin.style.display = "none";
Â  Â  	if (btnLogout) btnLogout.style.display = "inline-flex";
Â  Â  Â Â 
Â  Â  Â  if (isAdmin && adminPanel && adminTag) {
Â  Â  Â  Â  adminPanel.style.display = "block";
Â  Â  Â  Â  adminTag.style.display = "inline-block";
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  if (isLoggedIn && userTag) {
Â  Â  Â  Â  userTag.style.display = "inline-block";
Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  	await refreshCatalog();
Â  	console.log('âœ… AplicaciÃ³n inicializada correctamente');
Â  Â Â 
Â  } catch (error) {
Â  Â  console.error('âŒ Error en inicializaciÃ³n:', error);
Â  Â  showError('Error inicializando aplicaciÃ³n');
Â  }
})();

</script>

</body>
</html>
