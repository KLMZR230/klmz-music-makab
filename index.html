<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KLMZ MUSIC</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body class="bg-neutral-900 text-white flex flex-col min-h-screen">

  <!-- HEADER -->
  <header class="bg-black p-4 flex justify-between items-center shadow-md">
    <h1 class="text-2xl font-bold text-green-500">‚ô´ KLMZ MUSIC</h1>
    <!-- Icono admin oculto -->
    <button id="admin-icon" onclick="showLogin()" class="hidden text-gray-400 hover:text-green-500 text-xl">üîë</button>
  </header>

  <!-- CONTENIDO -->
  <main class="flex-1 p-6">
    <h2 class="text-xl mb-4 font-semibold">√Ålbumes</h2>
    <div id="albums" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4"></div>
  </main>

  <!-- REPRODUCTOR -->
  <footer id="player" class="hidden bg-neutral-800 p-4 flex flex-col items-center border-t border-neutral-700">
    <p id="now-playing" class="mb-2">Nada reproduci√©ndose</p>
    <audio id="audio-player" controls class="w-full max-w-xl"></audio>
  </footer>

  <!-- MODAL LOGIN -->
  <div id="login-modal" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center">
    <div class="bg-neutral-800 p-6 rounded-xl w-80">
      <h2 class="text-lg font-semibold mb-4">Acceso Admin</h2>
      <input id="email" type="email" placeholder="Correo" class="w-full p-2 mb-2 bg-neutral-700 rounded">
      <input id="password" type="password" placeholder="Contrase√±a" class="w-full p-2 mb-4 bg-neutral-700 rounded">
      <button onclick="login()" class="w-full bg-green-500 hover:bg-green-600 text-white p-2 rounded">Entrar</button>
      <button onclick="closeLogin()" class="mt-2 w-full bg-gray-600 hover:bg-gray-700 text-white p-2 rounded">Cancelar</button>
    </div>
  </div>

  <script>
    const SUPABASE_URL = "https://nqbldvpnqhngdtalvzov.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5xYmxkdnBucWhuZ2R0YWx2em92Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUyMjY0NjUsImV4cCI6MjA3MDgwMjQ2NX0.Zzg5D219sW7bhvl0_R5ypX9MF6nRzBSDIeo2Lvebab0";
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    const albumsDiv = document.getElementById("albums");
    const audio = document.getElementById("audio-player");
    const nowPlaying = document.getElementById("now-playing");
    const player = document.getElementById("player");

    async function loadAlbums() {
      const { data, error } = await supabase.from("albums").select("*").order("created_at", { ascending: false });
      if (error) {
        console.error(error);
        return;
      }
      albumsDiv.innerHTML = "";
      for (let album of data) {
        const cover = album.cover_url || "https://via.placeholder.com/300x300?text=No+Cover";
        const albumDiv = document.createElement("div");
        albumDiv.className = "bg-neutral-800 rounded-lg p-2 shadow hover:scale-105 transition cursor-pointer";
        albumDiv.innerHTML = `
          <img src="${cover}" class="w-full h-32 object-cover rounded mb-2">
          <p class="font-semibold truncate">${album.title}</p>
        `;
        albumDiv.onclick = () => loadSongs(album.id, album.title);
        albumsDiv.appendChild(albumDiv);
      }
    }

    async function loadSongs(albumId, albumTitle) {
      const { data, error } = await supabase.from("songs").select("*").eq("album_id", albumId);
      if (error) {
        console.error(error);
        return;
      }
      albumsDiv.innerHTML = `<h3 class="col-span-full text-lg font-bold mb-4">${albumTitle}</h3>`;
      data.forEach(song => {
        const songDiv = document.createElement("div");
        songDiv.className = "bg-neutral-700 rounded p-2 cursor-pointer hover:bg-neutral-600";
        songDiv.textContent = song.title;
        songDiv.onclick = () => playSong(song);
        albumsDiv.appendChild(songDiv);
      });
    }

    function playSong(song) {
      audio.src = song.song_url;
      audio.play();
      nowPlaying.textContent = "‚ñ∂ " + song.title;
      player.classList.remove("hidden");
    }

    // ADMIN LOGIN
    function showLogin() {
      document.getElementById("login-modal").classList.remove("hidden");
    }
    function closeLogin() {
      document.getElementById("login-modal").classList.add("hidden");
    }
    async function login() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      const { data, error } = await supabase.auth.signInWithPassword({ email, password });
      if (error) {
        alert("Error: " + error.message);
      } else {
        alert("Bienvenido Admin");
        closeLogin();
        checkAdmin();
      }
    }

    // Mostrar icono admin solo para tu correo
    async function checkAdmin() {
      const { data: { user } } = await supabase.auth.getUser();
      if (user && user.email === "klmzr@gmail.com") {
        document.getElementById("admin-icon").classList.remove("hidden");
      }
    }

    loadAlbums();
    checkAdmin();
  </script>
</body>
</html>
